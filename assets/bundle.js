(function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var u=typeof require=="function"&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return r(i?i:t)},c,c.exports,t,e,i,n)}return i[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)r(n[o]);return r})({1:[function(t,e,i){e.exports={meta:{level:1,name:"level1"},goal:{timer:{second:20},items:[{color:"red",type:"ruby",amount:5}]},player:{ship:{accelerator:200,brake:-10,speedLimit:200},hook:{launchSpeed:250,reachLimit:250}},map:{nodes:{A:[0,0],B:[400,0],C:[800,-350],D:[800,350],E:[1500,-350],F:[1500,350],G:[1900,0],H:[2300,0]},paths:{A:["B"],B:["C","D"],C:["E","F"],D:["F","E"],E:["G"],F:["G"],G:["H"],H:[]},switchs:{},start:["A"],end:["H"],ores:[{size:1.5,weight:.5,value:1,color:"red",type:"ruby",at:{x:400,y:-120}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:700,y:-400}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:770,y:220}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:620,y:370}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:1100,y:410}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:1220,y:250}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:88,y:70}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:842,y:-172}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:1195,y:-234}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:1407,y:-466}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:1602,y:-142}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:1948,y:-122}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:2184,y:98}},{size:1.2,weight:.5,value:1,color:"red",type:"ruby",at:{x:1725,y:288}}],sentinels:[]}}},{}],2:[function(t,e,i){var n=t("util/");var r=Array.prototype.slice;var s=Object.prototype.hasOwnProperty;var o=e.exports=f;o.AssertionError=function y(t){this.name="AssertionError";this.actual=t.actual;this.expected=t.expected;this.operator=t.operator;if(t.message){this.message=t.message;this.generatedMessage=false}else{this.message=h(this);this.generatedMessage=true}var e=t.stackStartFunction||c;if(Error.captureStackTrace){Error.captureStackTrace(this,e)}else{var i=new Error;if(i.stack){var n=i.stack;var r=e.name;var s=n.indexOf("\n"+r);if(s>=0){var o=n.indexOf("\n",s+1);n=n.substring(o+1)}this.stack=n}}};n.inherits(o.AssertionError,Error);function a(t,e){if(n.isUndefined(e)){return""+e}if(n.isNumber(e)&&!isFinite(e)){return e.toString()}if(n.isFunction(e)||n.isRegExp(e)){return e.toString()}return e}function u(t,e){if(n.isString(t)){return t.length<e?t:t.slice(0,e)}else{return t}}function h(t){return u(JSON.stringify(t.actual,a),128)+" "+t.operator+" "+u(JSON.stringify(t.expected,a),128)}function c(t,e,i,n,r){throw new o.AssertionError({message:i,actual:t,expected:e,operator:n,stackStartFunction:r})}o.fail=c;function f(t,e){if(!t)c(t,true,e,"==",o.ok)}o.ok=f;o.equal=function m(t,e,i){if(t!=e)c(t,e,i,"==",o.equal)};o.notEqual=function w(t,e,i){if(t==e){c(t,e,i,"!=",o.notEqual)}};o.deepEqual=function b(t,e,i){if(!l(t,e)){c(t,e,i,"deepEqual",o.deepEqual)}};function l(t,e){if(t===e){return true}else if(n.isBuffer(t)&&n.isBuffer(e)){if(t.length!=e.length)return false;for(var i=0;i<t.length;i++){if(t[i]!==e[i])return false}return true}else if(n.isDate(t)&&n.isDate(e)){return t.getTime()===e.getTime()}else if(n.isRegExp(t)&&n.isRegExp(e)){return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase}else if(!n.isObject(t)&&!n.isObject(e)){return t==e}else{return p(t,e)}}function d(t){return Object.prototype.toString.call(t)=="[object Arguments]"}function p(t,e){if(n.isNullOrUndefined(t)||n.isNullOrUndefined(e))return false;if(t.prototype!==e.prototype)return false;if(n.isPrimitive(t)||n.isPrimitive(e)){return t===e}var i=d(t),s=d(e);if(i&&!s||!i&&s)return false;if(i){t=r.call(t);e=r.call(e);return l(t,e)}var o=_(t),a=_(e),u,h;if(o.length!=a.length)return false;o.sort();a.sort();for(h=o.length-1;h>=0;h--){if(o[h]!=a[h])return false}for(h=o.length-1;h>=0;h--){u=o[h];if(!l(t[u],e[u]))return false}return true}o.notDeepEqual=function x(t,e,i){if(l(t,e)){c(t,e,i,"notDeepEqual",o.notDeepEqual)}};o.strictEqual=function E(t,e,i){if(t!==e){c(t,e,i,"===",o.strictEqual)}};o.notStrictEqual=function M(t,e,i){if(t===e){c(t,e,i,"!==",o.notStrictEqual)}};function g(t,e){if(!t||!e){return false}if(Object.prototype.toString.call(e)=="[object RegExp]"){return e.test(t)}else if(t instanceof e){return true}else if(e.call({},t)===true){return true}return false}function v(t,e,i,r){var s;if(n.isString(i)){r=i;i=null}try{e()}catch(o){s=o}r=(i&&i.name?" ("+i.name+").":".")+(r?" "+r:".");if(t&&!s){c(s,i,"Missing expected exception"+r)}if(!t&&g(s,i)){c(s,i,"Got unwanted exception"+r)}if(t&&s&&i&&!g(s,i)||!t&&s){throw s}}o.throws=function(t,e,i){v.apply(this,[true].concat(r.call(arguments)))};o.doesNotThrow=function(t,e){v.apply(this,[false].concat(r.call(arguments)))};o.ifError=function(t){if(t){throw t}};var _=Object.keys||function(t){var e=[];for(var i in t){if(s.call(t,i))e.push(i)}return e}},{"util/":90}],3:[function(t,e,i){function n(){var t=[].slice.call(arguments);function e(e,i){Object.keys(i).forEach(function(n){if(!~t.indexOf(n))e[n]=i[n]})}return function i(){var t=[].slice.call(arguments),i=0,n={};for(;i<t.length;i++){e(n,t[i])}return n}}e.exports=r;function r(t,e,i){var r=n("name","message","stack","constructor","toJSON"),s=r(e||{});this.message=t||"Unspecified AssertionError";this.showDiff=false;for(var o in s){this[o]=s[o]}i=i||arguments.callee;if(i&&Error.captureStackTrace){Error.captureStackTrace(this,i)}else{try{throw new Error}catch(a){this.stack=a.stack}}}r.prototype=Object.create(Error.prototype);r.prototype.name="AssertionError";r.prototype.constructor=r;r.prototype.toJSON=function(t){var e=n("constructor","toJSON","stack"),i=e({name:this.name},this);if(false!==t&&this.stack){i.stack=this.stack}return i}},{}],4:[function(t,e,i){"use strict";i.byteLength=c;i.toByteArray=f;i.fromByteArray=p;var n=[];var r=[];var s=typeof Uint8Array!=="undefined"?Uint8Array:Array;var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var a=0,u=o.length;a<u;++a){n[a]=o[a];r[o.charCodeAt(a)]=a}r["-".charCodeAt(0)]=62;r["_".charCodeAt(0)]=63;function h(t){var e=t.length;if(e%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return t[e-2]==="="?2:t[e-1]==="="?1:0}function c(t){return t.length*3/4-h(t)}function f(t){var e,i,n,o,a,u;var c=t.length;a=h(t);u=new s(c*3/4-a);n=a>0?c-4:c;var f=0;for(e=0,i=0;e<n;e+=4,i+=3){o=r[t.charCodeAt(e)]<<18|r[t.charCodeAt(e+1)]<<12|r[t.charCodeAt(e+2)]<<6|r[t.charCodeAt(e+3)];u[f++]=o>>16&255;u[f++]=o>>8&255;u[f++]=o&255}if(a===2){o=r[t.charCodeAt(e)]<<2|r[t.charCodeAt(e+1)]>>4;u[f++]=o&255}else if(a===1){o=r[t.charCodeAt(e)]<<10|r[t.charCodeAt(e+1)]<<4|r[t.charCodeAt(e+2)]>>2;u[f++]=o>>8&255;u[f++]=o&255}return u}function l(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[t&63]}function d(t,e,i){var n;var r=[];for(var s=e;s<i;s+=3){n=(t[s]<<16)+(t[s+1]<<8)+t[s+2];r.push(l(n))}return r.join("")}function p(t){var e;var i=t.length;var r=i%3;var s="";var o=[];var a=16383;for(var u=0,h=i-r;u<h;u+=a){o.push(d(t,u,u+a>h?h:u+a))}if(r===1){e=t[i-1];s+=n[e>>2];s+=n[e<<4&63];s+="=="}else if(r===2){e=(t[i-2]<<8)+t[i-1];s+=n[e>>10];s+=n[e>>4&63];s+=n[e<<2&63];s+="="}o.push(s);return o.join("")}},{}],5:[function(t,e,i){},{}],6:[function(t,e,i){(function(e){"use strict";var n=t("base64-js");var r=t("ieee754");var s=t("isarray");i.Buffer=h;i.SlowBuffer=m;i.INSPECT_MAX_BYTES=50;h.TYPED_ARRAY_SUPPORT=e.TYPED_ARRAY_SUPPORT!==undefined?e.TYPED_ARRAY_SUPPORT:o();i.kMaxLength=a();function o(){try{var t=new Uint8Array(1);t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return t.foo()===42&&typeof t.subarray==="function"&&t.subarray(1,1).byteLength===0}catch(e){return false}}function a(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function u(t,e){if(a()<e){throw new RangeError("Invalid typed array length")}if(h.TYPED_ARRAY_SUPPORT){t=new Uint8Array(e);t.__proto__=h.prototype}else{if(t===null){t=new h(e)}t.length=e}return t}function h(t,e,i){if(!h.TYPED_ARRAY_SUPPORT&&!(this instanceof h)){return new h(t,e,i)}if(typeof t==="number"){if(typeof e==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return d(this,t)}return c(this,t,e,i)}h.poolSize=8192;h._augment=function(t){t.__proto__=h.prototype;return t};function c(t,e,i,n){if(typeof e==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&e instanceof ArrayBuffer){return v(t,e,i,n)}if(typeof e==="string"){return p(t,e,i)}return _(t,e)}h.from=function(t,e,i){return c(null,t,e,i)};if(h.TYPED_ARRAY_SUPPORT){h.prototype.__proto__=Uint8Array.prototype;h.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&h[Symbol.species]===h){Object.defineProperty(h,Symbol.species,{value:null,configurable:true})}}function f(t){if(typeof t!=="number"){throw new TypeError('"size" argument must be a number')}else if(t<0){throw new RangeError('"size" argument must not be negative')}}function l(t,e,i,n){f(e);if(e<=0){return u(t,e)}if(i!==undefined){return typeof n==="string"?u(t,e).fill(i,n):u(t,e).fill(i)}return u(t,e)}h.alloc=function(t,e,i){return l(null,t,e,i)};function d(t,e){f(e);t=u(t,e<0?0:y(e)|0);if(!h.TYPED_ARRAY_SUPPORT){for(var i=0;i<e;++i){t[i]=0}}return t}h.allocUnsafe=function(t){return d(null,t)};h.allocUnsafeSlow=function(t){return d(null,t)};function p(t,e,i){if(typeof i!=="string"||i===""){i="utf8"}if(!h.isEncoding(i)){throw new TypeError('"encoding" must be a valid string encoding')}var n=w(e,i)|0;t=u(t,n);var r=t.write(e,i);if(r!==n){t=t.slice(0,r)}return t}function g(t,e){var i=e.length<0?0:y(e.length)|0;t=u(t,i);for(var n=0;n<i;n+=1){t[n]=e[n]&255}return t}function v(t,e,i,n){e.byteLength;if(i<0||e.byteLength<i){throw new RangeError("'offset' is out of bounds")}if(e.byteLength<i+(n||0)){throw new RangeError("'length' is out of bounds")}if(i===undefined&&n===undefined){e=new Uint8Array(e)}else if(n===undefined){e=new Uint8Array(e,i)}else{e=new Uint8Array(e,i,n)}if(h.TYPED_ARRAY_SUPPORT){t=e;t.__proto__=h.prototype}else{t=g(t,e)}return t}function _(t,e){if(h.isBuffer(e)){var i=y(e.length)|0;t=u(t,i);if(t.length===0){return t}e.copy(t,0,0,i);return t}if(e){if(typeof ArrayBuffer!=="undefined"&&e.buffer instanceof ArrayBuffer||"length"in e){if(typeof e.length!=="number"||et(e.length)){return u(t,0)}return g(t,e)}if(e.type==="Buffer"&&s(e.data)){return g(t,e.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function y(t){if(t>=a()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+a().toString(16)+" bytes")}return t|0}function m(t){if(+t!=t){t=0}return h.alloc(+t)}h.isBuffer=function it(t){return!!(t!=null&&t._isBuffer)};h.compare=function nt(t,e){if(!h.isBuffer(t)||!h.isBuffer(e)){throw new TypeError("Arguments must be Buffers")}if(t===e)return 0;var i=t.length;var n=e.length;for(var r=0,s=Math.min(i,n);r<s;++r){if(t[r]!==e[r]){i=t[r];n=e[r];break}}if(i<n)return-1;if(n<i)return 1;return 0};h.isEncoding=function rt(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};h.concat=function st(t,e){if(!s(t)){throw new TypeError('"list" argument must be an Array of Buffers')}if(t.length===0){return h.alloc(0)}var i;if(e===undefined){e=0;for(i=0;i<t.length;++i){e+=t[i].length}}var n=h.allocUnsafe(e);var r=0;for(i=0;i<t.length;++i){var o=t[i];if(!h.isBuffer(o)){throw new TypeError('"list" argument must be an Array of Buffers')}o.copy(n,r);r+=o.length}return n};function w(t,e){if(h.isBuffer(t)){return t.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer)){return t.byteLength}if(typeof t!=="string"){t=""+t}var i=t.length;if(i===0)return 0;var n=false;for(;;){switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case undefined:return J(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return i*2;case"hex":return i>>>1;case"base64":return Q(t).length;default:if(n)return J(t).length;e=(""+e).toLowerCase();n=true}}}h.byteLength=w;function b(t,e,i){var n=false;if(e===undefined||e<0){e=0}if(e>this.length){return""}if(i===undefined||i>this.length){i=this.length}if(i<=0){return""}i>>>=0;e>>>=0;if(i<=e){return""}if(!t)t="utf8";while(true){switch(t){case"hex":return N(this,e,i);case"utf8":case"utf-8":return R(this,e,i);case"ascii":return I(this,e,i);case"latin1":case"binary":return z(this,e,i);case"base64":return O(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase();n=true}}}h.prototype._isBuffer=true;function x(t,e,i){var n=t[e];t[e]=t[i];t[i]=n}h.prototype.swap16=function ot(){var t=this.length;if(t%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var e=0;e<t;e+=2){x(this,e,e+1)}return this};h.prototype.swap32=function at(){var t=this.length;if(t%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var e=0;e<t;e+=4){x(this,e,e+3);x(this,e+1,e+2)}return this};h.prototype.swap64=function ut(){var t=this.length;if(t%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var e=0;e<t;e+=8){x(this,e,e+7);x(this,e+1,e+6);x(this,e+2,e+5);x(this,e+3,e+4)}return this};h.prototype.toString=function ht(){var t=this.length|0;if(t===0)return"";if(arguments.length===0)return R(this,0,t);return b.apply(this,arguments)};h.prototype.equals=function ct(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(this===t)return true;return h.compare(this,t)===0};h.prototype.inspect=function ft(){var t="";var e=i.INSPECT_MAX_BYTES;if(this.length>0){t=this.toString("hex",0,e).match(/.{2}/g).join(" ");if(this.length>e)t+=" ... "}return"<Buffer "+t+">"};h.prototype.compare=function lt(t,e,i,n,r){if(!h.isBuffer(t)){throw new TypeError("Argument must be a Buffer")}if(e===undefined){e=0}if(i===undefined){i=t?t.length:0}if(n===undefined){n=0}if(r===undefined){r=this.length}if(e<0||i>t.length||n<0||r>this.length){throw new RangeError("out of range index")}if(n>=r&&e>=i){return 0}if(n>=r){return-1}if(e>=i){return 1}e>>>=0;i>>>=0;n>>>=0;r>>>=0;if(this===t)return 0;var s=r-n;var o=i-e;var a=Math.min(s,o);var u=this.slice(n,r);var c=t.slice(e,i);for(var f=0;f<a;++f){if(u[f]!==c[f]){s=u[f];o=c[f];break}}if(s<o)return-1;if(o<s)return 1;return 0};function E(t,e,i,n,r){if(t.length===0)return-1;if(typeof i==="string"){n=i;i=0}else if(i>2147483647){i=2147483647}else if(i<-2147483648){i=-2147483648}i=+i;if(isNaN(i)){i=r?0:t.length-1}if(i<0)i=t.length+i;if(i>=t.length){if(r)return-1;else i=t.length-1}else if(i<0){if(r)i=0;else return-1}if(typeof e==="string"){e=h.from(e,n)}if(h.isBuffer(e)){if(e.length===0){return-1}return M(t,e,i,n,r)}else if(typeof e==="number"){e=e&255;if(h.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(r){return Uint8Array.prototype.indexOf.call(t,e,i)}else{return Uint8Array.prototype.lastIndexOf.call(t,e,i)}}return M(t,[e],i,n,r)}throw new TypeError("val must be string, number or Buffer")}function M(t,e,i,n,r){var s=1;var o=t.length;var a=e.length;if(n!==undefined){n=String(n).toLowerCase();if(n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le"){if(t.length<2||e.length<2){return-1}s=2;o/=2;a/=2;i/=2}}function u(t,e){if(s===1){return t[e]}else{return t.readUInt16BE(e*s)}}var h;if(r){var c=-1;for(h=i;h<o;h++){if(u(t,h)===u(e,c===-1?0:h-c)){if(c===-1)c=h;if(h-c+1===a)return c*s}else{if(c!==-1)h-=h-c;c=-1}}}else{if(i+a>o)i=o-a;for(h=i;h>=0;h--){var f=true;for(var l=0;l<a;l++){if(u(t,h+l)!==u(e,l)){f=false;break}}if(f)return h}}return-1}h.prototype.includes=function dt(t,e,i){return this.indexOf(t,e,i)!==-1};h.prototype.indexOf=function pt(t,e,i){return E(this,t,e,i,true)};h.prototype.lastIndexOf=function gt(t,e,i){return E(this,t,e,i,false)};function D(t,e,i,n){i=Number(i)||0;var r=t.length-i;if(!n){n=r}else{n=Number(n);if(n>r){n=r}}var s=e.length;if(s%2!==0)throw new TypeError("Invalid hex string");if(n>s/2){n=s/2}for(var o=0;o<n;++o){var a=parseInt(e.substr(o*2,2),16);if(isNaN(a))return o;t[i+o]=a}return o}function T(t,e,i,n){return tt(J(e,t.length-i),t,i,n)}function S(t,e,i,n){return tt(Z(e),t,i,n)}function C(t,e,i,n){return S(t,e,i,n)}function A(t,e,i,n){return tt(Q(e),t,i,n)}function j(t,e,i,n){return tt($(e,t.length-i),t,i,n)}h.prototype.write=function vt(t,e,i,n){if(e===undefined){n="utf8";i=this.length;e=0}else if(i===undefined&&typeof e==="string"){n=e;i=this.length;e=0}else if(isFinite(e)){e=e|0;if(isFinite(i)){i=i|0;if(n===undefined)n="utf8"}else{n=i;i=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var r=this.length-e;if(i===undefined||i>r)i=r;if(t.length>0&&(i<0||e<0)||e>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!n)n="utf8";var s=false;for(;;){switch(n){case"hex":return D(this,t,e,i);case"utf8":case"utf-8":return T(this,t,e,i);case"ascii":return S(this,t,e,i);case"latin1":case"binary":return C(this,t,e,i);case"base64":return A(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,e,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase();s=true}}};h.prototype.toJSON=function _t(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function O(t,e,i){if(e===0&&i===t.length){return n.fromByteArray(t)}else{return n.fromByteArray(t.slice(e,i))}}function R(t,e,i){i=Math.min(t.length,i);var n=[];var r=e;while(r<i){var s=t[r];var o=null;var a=s>239?4:s>223?3:s>191?2:1;if(r+a<=i){var u,h,c,f;switch(a){case 1:if(s<128){o=s}break;case 2:u=t[r+1];if((u&192)===128){f=(s&31)<<6|u&63;if(f>127){o=f}}break;case 3:u=t[r+1];h=t[r+2];if((u&192)===128&&(h&192)===128){f=(s&15)<<12|(u&63)<<6|h&63;if(f>2047&&(f<55296||f>57343)){o=f}}break;case 4:u=t[r+1];h=t[r+2];c=t[r+3];if((u&192)===128&&(h&192)===128&&(c&192)===128){f=(s&15)<<18|(u&63)<<12|(h&63)<<6|c&63;if(f>65535&&f<1114112){o=f}}}}if(o===null){o=65533;a=1}else if(o>65535){o-=65536;n.push(o>>>10&1023|55296);o=56320|o&1023}n.push(o);r+=a}return k(n)}var P=4096;function k(t){var e=t.length;if(e<=P){return String.fromCharCode.apply(String,t)}var i="";var n=0;while(n<e){i+=String.fromCharCode.apply(String,t.slice(n,n+=P))}return i}function I(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r){n+=String.fromCharCode(t[r]&127)}return n}function z(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r){n+=String.fromCharCode(t[r])}return n}function N(t,e,i){var n=t.length;if(!e||e<0)e=0;if(!i||i<0||i>n)i=n;var r="";for(var s=e;s<i;++s){r+=K(t[s])}return r}function L(t,e,i){var n=t.slice(e,i);var r="";for(var s=0;s<n.length;s+=2){r+=String.fromCharCode(n[s]+n[s+1]*256)}return r}h.prototype.slice=function yt(t,e){var i=this.length;t=~~t;e=e===undefined?i:~~e;if(t<0){t+=i;if(t<0)t=0}else if(t>i){t=i}if(e<0){e+=i;if(e<0)e=0}else if(e>i){e=i}if(e<t)e=t;var n;if(h.TYPED_ARRAY_SUPPORT){n=this.subarray(t,e);n.__proto__=h.prototype}else{var r=e-t;n=new h(r,undefined);for(var s=0;s<r;++s){n[s]=this[s+t]}}return n};function F(t,e,i){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}h.prototype.readUIntLE=function mt(t,e,i){t=t|0;e=e|0;if(!i)F(t,e,this.length);var n=this[t];var r=1;var s=0;while(++s<e&&(r*=256)){n+=this[t+s]*r}return n};h.prototype.readUIntBE=function wt(t,e,i){t=t|0;e=e|0;if(!i){F(t,e,this.length)}var n=this[t+--e];var r=1;while(e>0&&(r*=256)){n+=this[t+--e]*r}return n};h.prototype.readUInt8=function bt(t,e){if(!e)F(t,1,this.length);return this[t]};h.prototype.readUInt16LE=function xt(t,e){if(!e)F(t,2,this.length);return this[t]|this[t+1]<<8};h.prototype.readUInt16BE=function Et(t,e){if(!e)F(t,2,this.length);return this[t]<<8|this[t+1]};h.prototype.readUInt32LE=function Mt(t,e){if(!e)F(t,4,this.length);return(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};h.prototype.readUInt32BE=function Dt(t,e){if(!e)F(t,4,this.length);return this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};h.prototype.readIntLE=function Tt(t,e,i){t=t|0;e=e|0;if(!i)F(t,e,this.length);var n=this[t];var r=1;var s=0;while(++s<e&&(r*=256)){n+=this[t+s]*r}r*=128;if(n>=r)n-=Math.pow(2,8*e);return n};h.prototype.readIntBE=function St(t,e,i){t=t|0;e=e|0;if(!i)F(t,e,this.length);var n=e;var r=1;var s=this[t+--n];while(n>0&&(r*=256)){s+=this[t+--n]*r}r*=128;if(s>=r)s-=Math.pow(2,8*e);return s};h.prototype.readInt8=function Ct(t,e){if(!e)F(t,1,this.length);if(!(this[t]&128))return this[t];return(255-this[t]+1)*-1};h.prototype.readInt16LE=function At(t,e){if(!e)F(t,2,this.length);var i=this[t]|this[t+1]<<8;return i&32768?i|4294901760:i};h.prototype.readInt16BE=function jt(t,e){if(!e)F(t,2,this.length);var i=this[t+1]|this[t]<<8;return i&32768?i|4294901760:i};h.prototype.readInt32LE=function Ot(t,e){if(!e)F(t,4,this.length);return this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};h.prototype.readInt32BE=function Rt(t,e){if(!e)F(t,4,this.length);return this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};h.prototype.readFloatLE=function Pt(t,e){if(!e)F(t,4,this.length);return r.read(this,t,true,23,4)};h.prototype.readFloatBE=function kt(t,e){if(!e)F(t,4,this.length);return r.read(this,t,false,23,4)};h.prototype.readDoubleLE=function It(t,e){if(!e)F(t,8,this.length);return r.read(this,t,true,52,8)};h.prototype.readDoubleBE=function zt(t,e){if(!e)F(t,8,this.length);return r.read(this,t,false,52,8)};function B(t,e,i,n,r,s){if(!h.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<s)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}h.prototype.writeUIntLE=function Nt(t,e,i,n){t=+t;e=e|0;i=i|0;if(!n){var r=Math.pow(2,8*i)-1;B(this,t,e,i,r,0)}var s=1;var o=0;this[e]=t&255;while(++o<i&&(s*=256)){this[e+o]=t/s&255}return e+i};h.prototype.writeUIntBE=function Lt(t,e,i,n){t=+t;e=e|0;i=i|0;if(!n){var r=Math.pow(2,8*i)-1;B(this,t,e,i,r,0)}var s=i-1;var o=1;this[e+s]=t&255;while(--s>=0&&(o*=256)){this[e+s]=t/o&255}return e+i};h.prototype.writeUInt8=function Ft(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,1,255,0);if(!h.TYPED_ARRAY_SUPPORT)t=Math.floor(t);this[e]=t&255;return e+1};function q(t,e,i,n){if(e<0)e=65535+e+1;for(var r=0,s=Math.min(t.length-i,2);r<s;++r){t[i+r]=(e&255<<8*(n?r:1-r))>>>(n?r:1-r)*8}}h.prototype.writeUInt16LE=function Bt(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,2,65535,0);if(h.TYPED_ARRAY_SUPPORT){this[e]=t&255;this[e+1]=t>>>8}else{q(this,t,e,true)}return e+2};h.prototype.writeUInt16BE=function qt(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,2,65535,0);if(h.TYPED_ARRAY_SUPPORT){this[e]=t>>>8;this[e+1]=t&255}else{q(this,t,e,false)}return e+2};function U(t,e,i,n){if(e<0)e=4294967295+e+1;for(var r=0,s=Math.min(t.length-i,4);r<s;++r){t[i+r]=e>>>(n?r:3-r)*8&255}}h.prototype.writeUInt32LE=function Ut(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,4,4294967295,0);if(h.TYPED_ARRAY_SUPPORT){this[e+3]=t>>>24;this[e+2]=t>>>16;this[e+1]=t>>>8;this[e]=t&255}else{U(this,t,e,true)}return e+4};h.prototype.writeUInt32BE=function Gt(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,4,4294967295,0);if(h.TYPED_ARRAY_SUPPORT){this[e]=t>>>24;this[e+1]=t>>>16;this[e+2]=t>>>8;this[e+3]=t&255}else{U(this,t,e,false)}return e+4};h.prototype.writeIntLE=function Ht(t,e,i,n){t=+t;e=e|0;if(!n){var r=Math.pow(2,8*i-1);B(this,t,e,i,r-1,-r)}var s=0;var o=1;var a=0;this[e]=t&255;while(++s<i&&(o*=256)){if(t<0&&a===0&&this[e+s-1]!==0){a=1}this[e+s]=(t/o>>0)-a&255}return e+i};h.prototype.writeIntBE=function Vt(t,e,i,n){t=+t;e=e|0;if(!n){var r=Math.pow(2,8*i-1);B(this,t,e,i,r-1,-r)}var s=i-1;var o=1;var a=0;this[e+s]=t&255;while(--s>=0&&(o*=256)){if(t<0&&a===0&&this[e+s+1]!==0){a=1}this[e+s]=(t/o>>0)-a&255}return e+i};h.prototype.writeInt8=function Yt(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,1,127,-128);if(!h.TYPED_ARRAY_SUPPORT)t=Math.floor(t);if(t<0)t=255+t+1;this[e]=t&255;return e+1};h.prototype.writeInt16LE=function Xt(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,2,32767,-32768);if(h.TYPED_ARRAY_SUPPORT){this[e]=t&255;this[e+1]=t>>>8}else{q(this,t,e,true)}return e+2};h.prototype.writeInt16BE=function Wt(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,2,32767,-32768);if(h.TYPED_ARRAY_SUPPORT){this[e]=t>>>8;this[e+1]=t&255}else{q(this,t,e,false)}return e+2};h.prototype.writeInt32LE=function Kt(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,4,2147483647,-2147483648);if(h.TYPED_ARRAY_SUPPORT){this[e]=t&255;this[e+1]=t>>>8;this[e+2]=t>>>16;this[e+3]=t>>>24}else{U(this,t,e,true)}return e+4};h.prototype.writeInt32BE=function Jt(t,e,i){t=+t;e=e|0;if(!i)B(this,t,e,4,2147483647,-2147483648);if(t<0)t=4294967295+t+1;if(h.TYPED_ARRAY_SUPPORT){this[e]=t>>>24;this[e+1]=t>>>16;this[e+2]=t>>>8;this[e+3]=t&255}else{U(this,t,e,false)}return e+4};function G(t,e,i,n,r,s){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function H(t,e,i,n,s){if(!s){G(t,e,i,4,3.4028234663852886e38,-3.4028234663852886e38)}r.write(t,e,i,n,23,4);return i+4}h.prototype.writeFloatLE=function Zt(t,e,i){return H(this,t,e,true,i)};h.prototype.writeFloatBE=function $t(t,e,i){return H(this,t,e,false,i)};function V(t,e,i,n,s){if(!s){G(t,e,i,8,1.7976931348623157e308,-1.7976931348623157e308)}r.write(t,e,i,n,52,8);return i+8}h.prototype.writeDoubleLE=function Qt(t,e,i){return V(this,t,e,true,i)};h.prototype.writeDoubleBE=function te(t,e,i){return V(this,t,e,false,i)};h.prototype.copy=function ee(t,e,i,n){if(!i)i=0;if(!n&&n!==0)n=this.length;if(e>=t.length)e=t.length;if(!e)e=0;if(n>0&&n<i)n=i;if(n===i)return 0;if(t.length===0||this.length===0)return 0;if(e<0){throw new RangeError("targetStart out of bounds")}if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");if(n>this.length)n=this.length;if(t.length-e<n-i){n=t.length-e+i}var r=n-i;var s;if(this===t&&i<e&&e<n){for(s=r-1;s>=0;--s){t[s+e]=this[s+i]}}else if(r<1e3||!h.TYPED_ARRAY_SUPPORT){for(s=0;s<r;++s){t[s+e]=this[s+i]}}else{Uint8Array.prototype.set.call(t,this.subarray(i,i+r),e)}return r};h.prototype.fill=function ie(t,e,i,n){if(typeof t==="string"){if(typeof e==="string"){n=e;e=0;i=this.length}else if(typeof i==="string"){n=i;i=this.length}if(t.length===1){var r=t.charCodeAt(0);if(r<256){t=r}}if(n!==undefined&&typeof n!=="string"){throw new TypeError("encoding must be a string")}if(typeof n==="string"&&!h.isEncoding(n)){throw new TypeError("Unknown encoding: "+n)}}else if(typeof t==="number"){t=t&255}if(e<0||this.length<e||this.length<i){throw new RangeError("Out of range index")}if(i<=e){return this}e=e>>>0;i=i===undefined?this.length:i>>>0;if(!t)t=0;var s;if(typeof t==="number"){for(s=e;s<i;++s){this[s]=t}}else{var o=h.isBuffer(t)?t:J(new h(t,n).toString());var a=o.length;for(s=0;s<i-e;++s){this[s+e]=o[s%a]}}return this};var Y=/[^+\/0-9A-Za-z-_]/g;function X(t){t=W(t).replace(Y,"");if(t.length<2)return"";while(t.length%4!==0){t=t+"="}return t}function W(t){if(t.trim)return t.trim();return t.replace(/^\s+|\s+$/g,"")}function K(t){if(t<16)return"0"+t.toString(16);return t.toString(16)}function J(t,e){e=e||Infinity;var i;var n=t.length;var r=null;var s=[];for(var o=0;o<n;++o){i=t.charCodeAt(o);if(i>55295&&i<57344){if(!r){if(i>56319){if((e-=3)>-1)s.push(239,191,189);continue}else if(o+1===n){if((e-=3)>-1)s.push(239,191,189);continue}r=i;continue}if(i<56320){if((e-=3)>-1)s.push(239,191,189);r=i;continue}i=(r-55296<<10|i-56320)+65536}else if(r){if((e-=3)>-1)s.push(239,191,189)}r=null;if(i<128){if((e-=1)<0)break;s.push(i)}else if(i<2048){if((e-=2)<0)break;s.push(i>>6|192,i&63|128)}else if(i<65536){if((e-=3)<0)break;s.push(i>>12|224,i>>6&63|128,i&63|128)}else if(i<1114112){if((e-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else{throw new Error("Invalid code point")}}return s}function Z(t){var e=[];for(var i=0;i<t.length;++i){e.push(t.charCodeAt(i)&255)}return e}function $(t,e){var i,n,r;var s=[];for(var o=0;o<t.length;++o){if((e-=2)<0)break;i=t.charCodeAt(o);n=i>>8;r=i%256;s.push(r);s.push(n)}return s}function Q(t){return n.toByteArray(X(t))}function tt(t,e,i,n){for(var r=0;r<n;++r){if(r+i>=e.length||r>=t.length)break;e[r+i]=t[r]}return r}function et(t){return t!==t}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":4,ieee754:82,isarray:83}],7:[function(t,e,i){e.exports=t("./lib/chai")},{"./lib/chai":8}],8:[function(t,e,i){var n=[],i=e.exports={};i.version="3.5.0";i.AssertionError=t("assertion-error");var r=t("./chai/utils");i.use=function(t){if(!~n.indexOf(t)){t(this,r);n.push(t)}return this};i.util=r;var s=t("./chai/config");i.config=s;var o=t("./chai/assertion");i.use(o);var a=t("./chai/core/assertions");i.use(a);var u=t("./chai/interface/expect");i.use(u);var h=t("./chai/interface/should");i.use(h);var c=t("./chai/interface/assert");i.use(c)},{"./chai/assertion":9,"./chai/config":10,"./chai/core/assertions":11,"./chai/interface/assert":12,"./chai/interface/expect":13,"./chai/interface/should":14,"./chai/utils":28,"assertion-error":3}],9:[function(t,e,i){var n=t("./config");e.exports=function(t,e){var i=t.AssertionError,r=e.flag;t.Assertion=s;function s(t,e,i){r(this,"ssfi",i||arguments.callee);r(this,"object",t);r(this,"message",e)}Object.defineProperty(s,"includeStack",{get:function(){console.warn("Assertion.includeStack is deprecated, use chai.config.includeStack instead.");return n.includeStack},set:function(t){console.warn("Assertion.includeStack is deprecated, use chai.config.includeStack instead.");n.includeStack=t}});Object.defineProperty(s,"showDiff",{get:function(){console.warn("Assertion.showDiff is deprecated, use chai.config.showDiff instead.");return n.showDiff},set:function(t){console.warn("Assertion.showDiff is deprecated, use chai.config.showDiff instead.");n.showDiff=t}});s.addProperty=function(t,i){e.addProperty(this.prototype,t,i)};s.addMethod=function(t,i){e.addMethod(this.prototype,t,i)};s.addChainableMethod=function(t,i,n){e.addChainableMethod(this.prototype,t,i,n)};s.overwriteProperty=function(t,i){e.overwriteProperty(this.prototype,t,i)};s.overwriteMethod=function(t,i){e.overwriteMethod(this.prototype,t,i)};s.overwriteChainableMethod=function(t,i,n){e.overwriteChainableMethod(this.prototype,t,i,n)};s.prototype.assert=function(t,s,o,a,u,h){var c=e.test(this,arguments);if(true!==h)h=false;if(true!==n.showDiff)h=false;if(!c){var s=e.getMessage(this,arguments),f=e.getActual(this,arguments);throw new i(s,{actual:f,expected:a,showDiff:h},n.includeStack?this.assert:r(this,"ssfi"))}};Object.defineProperty(s.prototype,"_obj",{get:function(){return r(this,"object")},set:function(t){r(this,"object",t)}})}},{"./config":10}],10:[function(t,e,i){e.exports={includeStack:false,showDiff:true,truncateThreshold:40}},{}],11:[function(t,e,i){e.exports=function(t,e){var i=t.Assertion,n=Object.prototype.toString,r=e.flag;["to","be","been","is","and","has","have","with","that","which","at","of","same"].forEach(function(t){i.addProperty(t,function(){return this})});i.addProperty("not",function(){r(this,"negate",true)});i.addProperty("deep",function(){r(this,"deep",true)});i.addProperty("any",function(){r(this,"any",true);r(this,"all",false)});i.addProperty("all",function(){r(this,"all",true);r(this,"any",false)});function s(t,i){if(i)r(this,"message",i);t=t.toLowerCase();var n=r(this,"object"),s=~["a","e","i","o","u"].indexOf(t.charAt(0))?"an ":"a ";

this.assert(t===e.type(n),"expected #{this} to be "+s+t,"expected #{this} not to be "+s+t)}i.addChainableMethod("an",s);i.addChainableMethod("a",s);function o(){r(this,"contains",true)}function a(t,n){e.expectTypes(this,["array","object","string"]);if(n)r(this,"message",n);var s=r(this,"object");var o=false;if(e.type(s)==="array"&&e.type(t)==="object"){for(var a in s){if(e.eql(s[a],t)){o=true;break}}}else if(e.type(t)==="object"){if(!r(this,"negate")){for(var u in t)new i(s).property(u,t[u]);return}var h={};for(var u in t)h[u]=s[u];o=e.eql(h,t)}else{o=s!=undefined&&~s.indexOf(t)}this.assert(o,"expected #{this} to include "+e.inspect(t),"expected #{this} to not include "+e.inspect(t))}i.addChainableMethod("include",a,o);i.addChainableMethod("contain",a,o);i.addChainableMethod("contains",a,o);i.addChainableMethod("includes",a,o);i.addProperty("ok",function(){this.assert(r(this,"object"),"expected #{this} to be truthy","expected #{this} to be falsy")});i.addProperty("true",function(){this.assert(true===r(this,"object"),"expected #{this} to be true","expected #{this} to be false",this.negate?false:true)});i.addProperty("false",function(){this.assert(false===r(this,"object"),"expected #{this} to be false","expected #{this} to be true",this.negate?true:false)});i.addProperty("null",function(){this.assert(null===r(this,"object"),"expected #{this} to be null","expected #{this} not to be null")});i.addProperty("undefined",function(){this.assert(undefined===r(this,"object"),"expected #{this} to be undefined","expected #{this} not to be undefined")});i.addProperty("NaN",function(){this.assert(isNaN(r(this,"object")),"expected #{this} to be NaN","expected #{this} not to be NaN")});i.addProperty("exist",function(){this.assert(null!=r(this,"object"),"expected #{this} to exist","expected #{this} to not exist")});i.addProperty("empty",function(){var t=r(this,"object"),e=t;if(Array.isArray(t)||"string"===typeof object){e=t.length}else if(typeof t==="object"){e=Object.keys(t).length}this.assert(!e,"expected #{this} to be empty","expected #{this} not to be empty")});function u(){var t=r(this,"object"),e=Object.prototype.toString.call(t);this.assert("[object Arguments]"===e,"expected #{this} to be arguments but got "+e,"expected #{this} to not be arguments")}i.addProperty("arguments",u);i.addProperty("Arguments",u);function h(t,e){if(e)r(this,"message",e);var i=r(this,"object");if(r(this,"deep")){return this.eql(t)}else{this.assert(t===i,"expected #{this} to equal #{exp}","expected #{this} to not equal #{exp}",t,this._obj,true)}}i.addMethod("equal",h);i.addMethod("equals",h);i.addMethod("eq",h);function c(t,i){if(i)r(this,"message",i);this.assert(e.eql(t,r(this,"object")),"expected #{this} to deeply equal #{exp}","expected #{this} to not deeply equal #{exp}",t,this._obj,true)}i.addMethod("eql",c);i.addMethod("eqls",c);function f(t,e){if(e)r(this,"message",e);var n=r(this,"object");if(r(this,"doLength")){new i(n,e).to.have.property("length");var s=n.length;this.assert(s>t,"expected #{this} to have a length above #{exp} but got #{act}","expected #{this} to not have a length above #{exp}",t,s)}else{this.assert(n>t,"expected #{this} to be above "+t,"expected #{this} to be at most "+t)}}i.addMethod("above",f);i.addMethod("gt",f);i.addMethod("greaterThan",f);function l(t,e){if(e)r(this,"message",e);var n=r(this,"object");if(r(this,"doLength")){new i(n,e).to.have.property("length");var s=n.length;this.assert(s>=t,"expected #{this} to have a length at least #{exp} but got #{act}","expected #{this} to have a length below #{exp}",t,s)}else{this.assert(n>=t,"expected #{this} to be at least "+t,"expected #{this} to be below "+t)}}i.addMethod("least",l);i.addMethod("gte",l);function d(t,e){if(e)r(this,"message",e);var n=r(this,"object");if(r(this,"doLength")){new i(n,e).to.have.property("length");var s=n.length;this.assert(s<t,"expected #{this} to have a length below #{exp} but got #{act}","expected #{this} to not have a length below #{exp}",t,s)}else{this.assert(n<t,"expected #{this} to be below "+t,"expected #{this} to be at least "+t)}}i.addMethod("below",d);i.addMethod("lt",d);i.addMethod("lessThan",d);function p(t,e){if(e)r(this,"message",e);var n=r(this,"object");if(r(this,"doLength")){new i(n,e).to.have.property("length");var s=n.length;this.assert(s<=t,"expected #{this} to have a length at most #{exp} but got #{act}","expected #{this} to have a length above #{exp}",t,s)}else{this.assert(n<=t,"expected #{this} to be at most "+t,"expected #{this} to be above "+t)}}i.addMethod("most",p);i.addMethod("lte",p);i.addMethod("within",function(t,e,n){if(n)r(this,"message",n);var s=r(this,"object"),o=t+".."+e;if(r(this,"doLength")){new i(s,n).to.have.property("length");var a=s.length;this.assert(a>=t&&a<=e,"expected #{this} to have a length within "+o,"expected #{this} to not have a length within "+o)}else{this.assert(s>=t&&s<=e,"expected #{this} to be within "+o,"expected #{this} to not be within "+o)}});function g(t,i){if(i)r(this,"message",i);var n=e.getName(t);this.assert(r(this,"object")instanceof t,"expected #{this} to be an instance of "+n,"expected #{this} to not be an instance of "+n)}i.addMethod("instanceof",g);i.addMethod("instanceOf",g);i.addMethod("property",function(t,i,n){if(n)r(this,"message",n);var s=!!r(this,"deep"),o=s?"deep property ":"property ",a=r(this,"negate"),u=r(this,"object"),h=s?e.getPathInfo(t,u):null,c=s?h.exists:e.hasProperty(t,u),f=s?h.value:u[t];if(a&&arguments.length>1){if(undefined===f){n=n!=null?n+": ":"";throw new Error(n+e.inspect(u)+" has no "+o+e.inspect(t))}}else{this.assert(c,"expected #{this} to have a "+o+e.inspect(t),"expected #{this} to not have "+o+e.inspect(t))}if(arguments.length>1){this.assert(i===f,"expected #{this} to have a "+o+e.inspect(t)+" of #{exp}, but got #{act}","expected #{this} to not have a "+o+e.inspect(t)+" of #{act}",i,f)}r(this,"object",f)});function v(t,i){if(i)r(this,"message",i);var n=r(this,"object");this.assert(n.hasOwnProperty(t),"expected #{this} to have own property "+e.inspect(t),"expected #{this} to not have own property "+e.inspect(t))}i.addMethod("ownProperty",v);i.addMethod("haveOwnProperty",v);function _(t,i,n){if(typeof i==="string"){n=i;i=null}if(n)r(this,"message",n);var s=r(this,"object");var o=Object.getOwnPropertyDescriptor(Object(s),t);if(o&&i){this.assert(e.eql(i,o),"expected the own property descriptor for "+e.inspect(t)+" on #{this} to match "+e.inspect(i)+", got "+e.inspect(o),"expected the own property descriptor for "+e.inspect(t)+" on #{this} to not match "+e.inspect(i),i,o,true)}else{this.assert(o,"expected #{this} to have an own property descriptor for "+e.inspect(t),"expected #{this} to not have an own property descriptor for "+e.inspect(t))}r(this,"object",o)}i.addMethod("ownPropertyDescriptor",_);i.addMethod("haveOwnPropertyDescriptor",_);function y(){r(this,"doLength",true)}function m(t,e){if(e)r(this,"message",e);var n=r(this,"object");new i(n,e).to.have.property("length");var s=n.length;this.assert(s==t,"expected #{this} to have a length of #{exp} but got #{act}","expected #{this} to not have a length of #{act}",t,s)}i.addChainableMethod("length",m,y);i.addMethod("lengthOf",m);function w(t,e){if(e)r(this,"message",e);var i=r(this,"object");this.assert(t.exec(i),"expected #{this} to match "+t,"expected #{this} not to match "+t)}i.addMethod("match",w);i.addMethod("matches",w);i.addMethod("string",function(t,n){if(n)r(this,"message",n);var s=r(this,"object");new i(s,n).is.a("string");this.assert(~s.indexOf(t),"expected #{this} to contain "+e.inspect(t),"expected #{this} to not contain "+e.inspect(t))});function b(t){var i=r(this,"object"),n,s=true,o="keys must be given single argument of Array|Object|String, or multiple String arguments";switch(e.type(t)){case"array":if(arguments.length>1)throw new Error(o);break;case"object":if(arguments.length>1)throw new Error(o);t=Object.keys(t);break;default:t=Array.prototype.slice.call(arguments)}if(!t.length)throw new Error("keys required");var a=Object.keys(i),u=t,h=t.length,c=r(this,"any"),f=r(this,"all");if(!c&&!f){f=true}if(c){var l=u.filter(function(t){return~a.indexOf(t)});s=l.length>0}if(f){s=t.every(function(t){return~a.indexOf(t)});if(!r(this,"negate")&&!r(this,"contains")){s=s&&t.length==a.length}}if(h>1){t=t.map(function(t){return e.inspect(t)});var d=t.pop();if(f){n=t.join(", ")+", and "+d}if(c){n=t.join(", ")+", or "+d}}else{n=e.inspect(t[0])}n=(h>1?"keys ":"key ")+n;n=(r(this,"contains")?"contain ":"have ")+n;this.assert(s,"expected #{this} to "+n,"expected #{this} to not "+n,u.slice(0).sort(),a.sort(),true)}i.addMethod("keys",b);i.addMethod("key",b);function x(t,n,s){if(s)r(this,"message",s);var o=r(this,"object");new i(o,s).is.a("function");var a=false,u=null,h=null,c=null;if(arguments.length===0){n=null;t=null}else if(t&&(t instanceof RegExp||"string"===typeof t)){n=t;t=null}else if(t&&t instanceof Error){u=t;t=null;n=null}else if(typeof t==="function"){h=t.prototype.name;if(!h||h==="Error"&&t!==Error){h=t.name||(new t).name}}else{t=null}try{o()}catch(f){if(u){this.assert(f===u,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp}",u instanceof Error?u.toString():u,f instanceof Error?f.toString():f);r(this,"object",f);return this}if(t){this.assert(f instanceof t,"expected #{this} to throw #{exp} but #{act} was thrown","expected #{this} to not throw #{exp} but #{act} was thrown",h,f instanceof Error?f.toString():f);if(!n){r(this,"object",f);return this}}var l="error"===e.type(f)&&"message"in f?f.message:""+f;if(l!=null&&n&&n instanceof RegExp){this.assert(n.exec(l),"expected #{this} to throw error matching #{exp} but got #{act}","expected #{this} to throw error not matching #{exp}",n,l);r(this,"object",f);return this}else if(l!=null&&n&&"string"===typeof n){this.assert(~l.indexOf(n),"expected #{this} to throw error including #{exp} but got #{act}","expected #{this} to throw error not including #{act}",n,l);r(this,"object",f);return this}else{a=true;c=f}}var d="",p=h!==null?h:u?"#{exp}":"an error";if(a){d=" but #{act} was thrown"}this.assert(a===true,"expected #{this} to throw "+p+d,"expected #{this} to not throw "+p+d,u instanceof Error?u.toString():u,c instanceof Error?c.toString():c);r(this,"object",c)}i.addMethod("throw",x);i.addMethod("throws",x);i.addMethod("Throw",x);function E(t,i){if(i)r(this,"message",i);var n=r(this,"object"),s=r(this,"itself"),o="function"===e.type(n)&&!s?n.prototype[t]:n[t];this.assert("function"===typeof o,"expected #{this} to respond to "+e.inspect(t),"expected #{this} to not respond to "+e.inspect(t))}i.addMethod("respondTo",E);i.addMethod("respondsTo",E);i.addProperty("itself",function(){r(this,"itself",true)});function M(t,i){if(i)r(this,"message",i);var n=r(this,"object");var s=t(n);this.assert(s,"expected #{this} to satisfy "+e.objDisplay(t),"expected #{this} to not satisfy"+e.objDisplay(t),this.negate?false:true,s)}i.addMethod("satisfy",M);i.addMethod("satisfies",M);function D(t,n,s){if(s)r(this,"message",s);var o=r(this,"object");new i(o,s).is.a("number");if(e.type(t)!=="number"||e.type(n)!=="number"){throw new Error("the arguments to closeTo or approximately must be numbers")}this.assert(Math.abs(o-t)<=n,"expected #{this} to be close to "+t+" +/- "+n,"expected #{this} not to be close to "+t+" +/- "+n)}i.addMethod("closeTo",D);i.addMethod("approximately",D);function T(t,e,i){return t.every(function(t){if(!i)return e.indexOf(t)!==-1;return e.some(function(e){return i(t,e)})})}i.addMethod("members",function(t,n){if(n)r(this,"message",n);var s=r(this,"object");new i(s).to.be.an("array");new i(t).to.be.an("array");var o=r(this,"deep")?e.eql:undefined;if(r(this,"contains")){return this.assert(T(t,s,o),"expected #{this} to be a superset of #{act}","expected #{this} to not be a superset of #{act}",s,t)}this.assert(T(s,t,o)&&T(t,s,o),"expected #{this} to have the same members as #{act}","expected #{this} to not have the same members as #{act}",s,t)});function S(t,e){if(e)r(this,"message",e);var n=r(this,"object");new i(t).to.be.an("array");this.assert(t.indexOf(n)>-1,"expected #{this} to be one of #{exp}","expected #{this} to not be one of #{exp}",t,n)}i.addMethod("oneOf",S);function C(t,e,n){if(n)r(this,"message",n);var s=r(this,"object");new i(t,n).to.have.property(e);new i(s).is.a("function");var o=t[e];s();this.assert(o!==t[e],"expected ."+e+" to change","expected ."+e+" to not change")}i.addChainableMethod("change",C);i.addChainableMethod("changes",C);function A(t,e,n){if(n)r(this,"message",n);var s=r(this,"object");new i(t,n).to.have.property(e);new i(s).is.a("function");var o=t[e];s();this.assert(t[e]-o>0,"expected ."+e+" to increase","expected ."+e+" to not increase")}i.addChainableMethod("increase",A);i.addChainableMethod("increases",A);function j(t,e,n){if(n)r(this,"message",n);var s=r(this,"object");new i(t,n).to.have.property(e);new i(s).is.a("function");var o=t[e];s();this.assert(t[e]-o<0,"expected ."+e+" to decrease","expected ."+e+" to not decrease")}i.addChainableMethod("decrease",j);i.addChainableMethod("decreases",j);i.addProperty("extensible",function(){var t=r(this,"object");var e;try{e=Object.isExtensible(t)}catch(i){if(i instanceof TypeError)e=false;else throw i}this.assert(e,"expected #{this} to be extensible","expected #{this} to not be extensible")});i.addProperty("sealed",function(){var t=r(this,"object");var e;try{e=Object.isSealed(t)}catch(i){if(i instanceof TypeError)e=true;else throw i}this.assert(e,"expected #{this} to be sealed","expected #{this} to not be sealed")});i.addProperty("frozen",function(){var t=r(this,"object");var e;try{e=Object.isFrozen(t)}catch(i){if(i instanceof TypeError)e=true;else throw i}this.assert(e,"expected #{this} to be frozen","expected #{this} to not be frozen")})}},{}],12:[function(t,e,i){e.exports=function(t,e){var i=t.Assertion,n=e.flag;var r=t.assert=function(e,n){var r=new i(null,null,t.assert);r.assert(e,n,"[ negation message unavailable ]")};r.fail=function(e,i,n,s){n=n||"assert.fail()";throw new t.AssertionError(n,{actual:e,expected:i,operator:s},r.fail)};r.isOk=function(t,e){new i(t,e).is.ok};r.isNotOk=function(t,e){new i(t,e).is.not.ok};r.equal=function(t,e,s){var o=new i(t,s,r.equal);o.assert(e==n(o,"object"),"expected #{this} to equal #{exp}","expected #{this} to not equal #{act}",e,t)};r.notEqual=function(t,e,s){var o=new i(t,s,r.notEqual);o.assert(e!=n(o,"object"),"expected #{this} to not equal #{exp}","expected #{this} to equal #{act}",e,t)};r.strictEqual=function(t,e,n){new i(t,n).to.equal(e)};r.notStrictEqual=function(t,e,n){new i(t,n).to.not.equal(e)};r.deepEqual=function(t,e,n){new i(t,n).to.eql(e)};r.notDeepEqual=function(t,e,n){new i(t,n).to.not.eql(e)};r.isAbove=function(t,e,n){new i(t,n).to.be.above(e)};r.isAtLeast=function(t,e,n){new i(t,n).to.be.least(e)};r.isBelow=function(t,e,n){new i(t,n).to.be.below(e)};r.isAtMost=function(t,e,n){new i(t,n).to.be.most(e)};r.isTrue=function(t,e){new i(t,e).is["true"]};r.isNotTrue=function(t,e){new i(t,e).to.not.equal(true)};r.isFalse=function(t,e){new i(t,e).is["false"]};r.isNotFalse=function(t,e){new i(t,e).to.not.equal(false)};r.isNull=function(t,e){new i(t,e).to.equal(null)};r.isNotNull=function(t,e){new i(t,e).to.not.equal(null)};r.isNaN=function(t,e){new i(t,e).to.be.NaN};r.isNotNaN=function(t,e){new i(t,e).not.to.be.NaN};r.isUndefined=function(t,e){new i(t,e).to.equal(undefined)};r.isDefined=function(t,e){new i(t,e).to.not.equal(undefined)};r.isFunction=function(t,e){new i(t,e).to.be.a("function")};r.isNotFunction=function(t,e){new i(t,e).to.not.be.a("function")};r.isObject=function(t,e){new i(t,e).to.be.a("object")};r.isNotObject=function(t,e){new i(t,e).to.not.be.a("object")};r.isArray=function(t,e){new i(t,e).to.be.an("array")};r.isNotArray=function(t,e){new i(t,e).to.not.be.an("array")};r.isString=function(t,e){new i(t,e).to.be.a("string")};r.isNotString=function(t,e){new i(t,e).to.not.be.a("string")};r.isNumber=function(t,e){new i(t,e).to.be.a("number")};r.isNotNumber=function(t,e){new i(t,e).to.not.be.a("number")};r.isBoolean=function(t,e){new i(t,e).to.be.a("boolean")};r.isNotBoolean=function(t,e){new i(t,e).to.not.be.a("boolean")};r.typeOf=function(t,e,n){new i(t,n).to.be.a(e)};r.notTypeOf=function(t,e,n){new i(t,n).to.not.be.a(e)};r.instanceOf=function(t,e,n){new i(t,n).to.be.instanceOf(e)};r.notInstanceOf=function(t,e,n){new i(t,n).to.not.be.instanceOf(e)};r.include=function(t,e,n){new i(t,n,r.include).include(e)};r.notInclude=function(t,e,n){new i(t,n,r.notInclude).not.include(e)};r.match=function(t,e,n){new i(t,n).to.match(e)};r.notMatch=function(t,e,n){new i(t,n).to.not.match(e)};r.property=function(t,e,n){new i(t,n).to.have.property(e)};r.notProperty=function(t,e,n){new i(t,n).to.not.have.property(e)};r.deepProperty=function(t,e,n){new i(t,n).to.have.deep.property(e)};r.notDeepProperty=function(t,e,n){new i(t,n).to.not.have.deep.property(e)};r.propertyVal=function(t,e,n,r){new i(t,r).to.have.property(e,n)};r.propertyNotVal=function(t,e,n,r){new i(t,r).to.not.have.property(e,n)};r.deepPropertyVal=function(t,e,n,r){new i(t,r).to.have.deep.property(e,n)};r.deepPropertyNotVal=function(t,e,n,r){new i(t,r).to.not.have.deep.property(e,n)};r.lengthOf=function(t,e,n){new i(t,n).to.have.length(e)};r.throws=function(t,e,r,s){if("string"===typeof e||e instanceof RegExp){r=e;e=null}var o=new i(t,s).to.throw(e,r);return n(o,"object")};r.doesNotThrow=function(t,e,n){if("string"===typeof e){n=e;e=null}new i(t,n).to.not.Throw(e)};r.operator=function(t,r,s,o){var a;switch(r){case"==":a=t==s;break;case"===":a=t===s;break;case">":a=t>s;break;case">=":a=t>=s;break;case"<":a=t<s;break;case"<=":a=t<=s;break;case"!=":a=t!=s;break;case"!==":a=t!==s;break;default:throw new Error('Invalid operator "'+r+'"')}var u=new i(a,o);u.assert(true===n(u,"object"),"expected "+e.inspect(t)+" to be "+r+" "+e.inspect(s),"expected "+e.inspect(t)+" to not be "+r+" "+e.inspect(s))};r.closeTo=function(t,e,n,r){new i(t,r).to.be.closeTo(e,n)};r.approximately=function(t,e,n,r){new i(t,r).to.be.approximately(e,n)};r.sameMembers=function(t,e,n){new i(t,n).to.have.same.members(e)};r.sameDeepMembers=function(t,e,n){new i(t,n).to.have.same.deep.members(e)};r.includeMembers=function(t,e,n){new i(t,n).to.include.members(e)};r.includeDeepMembers=function(t,e,n){new i(t,n).to.include.deep.members(e)};r.oneOf=function(t,e,n){new i(t,n).to.be.oneOf(e)};r.changes=function(t,e,n){new i(t).to.change(e,n)};r.doesNotChange=function(t,e,n){new i(t).to.not.change(e,n)};r.increases=function(t,e,n){new i(t).to.increase(e,n)};r.doesNotIncrease=function(t,e,n){new i(t).to.not.increase(e,n)};r.decreases=function(t,e,n){new i(t).to.decrease(e,n)};r.doesNotDecrease=function(t,e,n){new i(t).to.not.decrease(e,n)};r.ifError=function(t){if(t){throw t}};r.isExtensible=function(t,e){new i(t,e).to.be.extensible};r.isNotExtensible=function(t,e){new i(t,e).to.not.be.extensible};r.isSealed=function(t,e){new i(t,e).to.be.sealed};r.isNotSealed=function(t,e){new i(t,e).to.not.be.sealed};r.isFrozen=function(t,e){new i(t,e).to.be.frozen};r.isNotFrozen=function(t,e){new i(t,e).to.not.be.frozen};(function s(t,e){r[e]=r[t];return s})("isOk","ok")("isNotOk","notOk")("throws","throw")("throws","Throw")("isExtensible","extensible")("isNotExtensible","notExtensible")("isSealed","sealed")("isNotSealed","notSealed")("isFrozen","frozen")("isNotFrozen","notFrozen")}},{}],13:[function(t,e,i){e.exports=function(t,e){t.expect=function(e,i){return new t.Assertion(e,i)};t.expect.fail=function(e,i,n,r){n=n||"expect.fail()";throw new t.AssertionError(n,{actual:e,expected:i,operator:r},t.expect.fail)}}},{}],14:[function(t,e,i){e.exports=function(t,e){var i=t.Assertion;function n(){function e(){if(this instanceof String||this instanceof Number||this instanceof Boolean){return new i(this.valueOf(),null,e)}return new i(this,null,e)}function n(t){Object.defineProperty(this,"should",{value:t,enumerable:true,configurable:true,writable:true})}Object.defineProperty(Object.prototype,"should",{set:n,get:e,configurable:true});var r={};r.fail=function(e,i,n,s){n=n||"should.fail()";throw new t.AssertionError(n,{actual:e,expected:i,operator:s},r.fail)};r.equal=function(t,e,n){new i(t,n).to.equal(e)};r.Throw=function(t,e,n,r){new i(t,r).to.Throw(e,n)};r.exist=function(t,e){new i(t,e).to.exist};r.not={};r.not.equal=function(t,e,n){new i(t,n).to.not.equal(e)};r.not.Throw=function(t,e,n,r){new i(t,r).to.not.Throw(e,n)};r.not.exist=function(t,e){new i(t,e).to.not.exist};r["throw"]=r["Throw"];r.not["throw"]=r.not["Throw"];return r}t.should=n;t.Should=n}},{}],15:[function(t,e,i){var n=t("./transferFlags");var r=t("./flag");var s=t("../config");var o="__proto__"in Object;var a=/^(?:length|name|arguments|caller)$/;var u=Function.prototype.call,h=Function.prototype.apply;e.exports=function(t,e,i,c){if(typeof c!=="function"){c=function(){}}var f={method:i,chainingBehavior:c};if(!t.__methods){t.__methods={}}t.__methods[e]=f;Object.defineProperty(t,e,{get:function(){f.chainingBehavior.call(this);var e=function l(){var t=r(this,"ssfi");if(t&&s.includeStack===false)r(this,"ssfi",l);var e=f.method.apply(this,arguments);return e===undefined?this:e};if(o){var i=e.__proto__=Object.create(this);i.call=u;i.apply=h}else{var c=Object.getOwnPropertyNames(t);c.forEach(function(i){if(!a.test(i)){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,n)}})}n(this,e);return e},configurable:true})}},{"../config":10,"./flag":19,"./transferFlags":35}],16:[function(t,e,i){var n=t("../config");var r=t("./flag");e.exports=function(t,e,i){t[e]=function(){var s=r(this,"ssfi");if(s&&n.includeStack===false)r(this,"ssfi",t[e]);var o=i.apply(this,arguments);return o===undefined?this:o}}},{"../config":10,"./flag":19}],17:[function(t,e,i){var n=t("../config");var r=t("./flag");e.exports=function(t,e,i){Object.defineProperty(t,e,{get:function s(){var t=r(this,"ssfi");if(t&&n.includeStack===false)r(this,"ssfi",s);var e=i.call(this);return e===undefined?this:e},configurable:true})}},{"../config":10,"./flag":19}],18:[function(t,e,i){var n=t("assertion-error");var r=t("./flag");var s=t("type-detect");e.exports=function(t,e){var t=r(t,"object");e=e.map(function(t){return t.toLowerCase()});e.sort();var i=e.map(function(t,i){var n=~["a","e","i","o","u"].indexOf(t.charAt(0))?"an":"a";var r=e.length>1&&i===e.length-1?"or ":"";return r+n+" "+t}).join(", ");if(!e.some(function(e){return s(t)===e})){throw new n("object tested must be "+i+", but "+s(t)+" given")}}},{"./flag":19,"assertion-error":3,"type-detect":85}],19:[function(t,e,i){e.exports=function(t,e,i){var n=t.__flags||(t.__flags=Object.create(null));if(arguments.length===3){n[e]=i}else{return n[e]}}},{}],20:[function(t,e,i){e.exports=function(t,e){return e.length>4?e[4]:t._obj}},{}],21:[function(t,e,i){e.exports=function n(t){var e=[];for(var i in t){e.push(i)}return e}},{}],22:[function(t,e,i){var n=t("./flag"),r=t("./getActual"),s=t("./inspect"),o=t("./objDisplay");e.exports=function(t,e){var i=n(t,"negate"),s=n(t,"object"),a=e[3],u=r(t,e),h=i?e[2]:e[1],c=n(t,"message");if(typeof h==="function")h=h();h=h||"";h=h.replace(/#\{this\}/g,function(){return o(s)}).replace(/#\{act\}/g,function(){return o(u)}).replace(/#\{exp\}/g,function(){return o(a)});return c?c+": "+h:h}},{"./flag":19,"./getActual":20,"./inspect":29,"./objDisplay":30}],23:[function(t,e,i){e.exports=function(t){if(t.name)return t.name;var e=/^\s?function ([^(]*)\(/.exec(t);return e&&e[1]?e[1]:""}},{}],24:[function(t,e,i){var n=t("./hasProperty");e.exports=function o(t,e){var i=r(t),o=i[i.length-1];var a={parent:i.length>1?s(i,e,i.length-1):e,name:o.p||o.i,value:s(i,e)};a.exists=n(a.name,a.parent);return a};function r(t){var e=t.replace(/([^\\])\[/g,"$1.["),i=e.match(/(\\\.|[^.]+?)+/g);return i.map(function(t){var e=/^\[(\d+)\]$/,i=e.exec(t);if(i)return{i:parseFloat(i[1])};else return{p:t.replace(/\\([.\[\]])/g,"$1")}})}function s(t,e,i){var n=e,r;i=i===undefined?t.length:i;for(var s=0,o=i;s<o;s++){var a=t[s];if(n){if("undefined"!==typeof a.p)n=n[a.p];else if("undefined"!==typeof a.i)n=n[a.i];if(s==o-1)r=n}else{r=undefined}}return r}},{"./hasProperty":27}],25:[function(t,e,i){var n=t("./getPathInfo");e.exports=function(t,e){var i=n(t,e);return i.value}},{"./getPathInfo":24}],26:[function(t,e,i){e.exports=function n(t){var e=Object.getOwnPropertyNames(t);function i(t){if(e.indexOf(t)===-1){e.push(t)}}var n=Object.getPrototypeOf(t);while(n!==null){Object.getOwnPropertyNames(n).forEach(i);n=Object.getPrototypeOf(n)}return e}},{}],27:[function(t,e,i){var n=t("type-detect");var r={number:Number,string:String};e.exports=function s(t,e){var i=n(e);if(i==="null"||i==="undefined")return false;if(r[i]&&typeof e!=="object")e=new r[i](e);return t in e}},{"type-detect":85}],28:[function(t,e,i){var i=e.exports={};i.test=t("./test");i.type=t("type-detect");i.expectTypes=t("./expectTypes");i.getMessage=t("./getMessage");i.getActual=t("./getActual");i.inspect=t("./inspect");i.objDisplay=t("./objDisplay");i.flag=t("./flag");i.transferFlags=t("./transferFlags");i.eql=t("deep-eql");i.getPathValue=t("./getPathValue");i.getPathInfo=t("./getPathInfo");i.hasProperty=t("./hasProperty");i.getName=t("./getName");i.addProperty=t("./addProperty");i.addMethod=t("./addMethod");i.overwriteProperty=t("./overwriteProperty");i.overwriteMethod=t("./overwriteMethod");i.addChainableMethod=t("./addChainableMethod");i.overwriteChainableMethod=t("./overwriteChainableMethod")},{"./addChainableMethod":15,"./addMethod":16,"./addProperty":17,"./expectTypes":18,"./flag":19,"./getActual":20,"./getMessage":22,"./getName":23,"./getPathInfo":24,"./getPathValue":25,"./hasProperty":27,"./inspect":29,"./objDisplay":30,"./overwriteChainableMethod":31,"./overwriteMethod":32,"./overwriteProperty":33,"./test":34,"./transferFlags":35,"deep-eql":78,"type-detect":85}],29:[function(t,e,i){var n=t("./getName");var r=t("./getProperties");var s=t("./getEnumerableProperties");e.exports=o;function o(t,e,i,n){var r={showHidden:e,seen:[],stylize:function(t){return t}};return u(r,t,typeof i==="undefined"?2:i)}var a=function(t){if(typeof HTMLElement==="object"){return t instanceof HTMLElement}else{return t&&typeof t==="object"&&t.nodeType===1&&typeof t.nodeName==="string"}};function u(t,e,o){if(e&&typeof e.inspect==="function"&&e.inspect!==i.inspect&&!(e.constructor&&e.constructor.prototype===e)){var y=e.inspect(o);if(typeof y!=="string"){y=u(t,y,o)}return y}var m=h(t,e);if(m){return m}if(a(e)){if("outerHTML"in e){return e.outerHTML}else{try{if(document.xmlVersion){var w=new XMLSerializer;return w.serializeToString(e)}else{var b="http://www.w3.org/1999/xhtml";var x=document.createElementNS(b,"_");x.appendChild(e.cloneNode(false));html=x.innerHTML.replace("><",">"+e.innerHTML+"<");x.innerHTML="";return html}}catch(E){}}}var M=s(e);var D=t.showHidden?r(e):M;if(D.length===0||_(e)&&(D.length===1&&D[0]==="stack"||D.length===2&&D[0]==="description"&&D[1]==="stack")){if(typeof e==="function"){var T=n(e);var S=T?": "+T:"";return t.stylize("[Function"+S+"]","special")}if(g(e)){return t.stylize(RegExp.prototype.toString.call(e),"regexp")}if(v(e)){return t.stylize(Date.prototype.toUTCString.call(e),"date")}if(_(e)){return c(e)}}var C="",A=false,j=["{","}"];if(p(e)){A=true;j=["[","]"]}if(typeof e==="function"){var T=n(e);var S=T?": "+T:"";C=" [Function"+S+"]"}if(g(e)){C=" "+RegExp.prototype.toString.call(e)}if(v(e)){C=" "+Date.prototype.toUTCString.call(e)}if(_(e)){return c(e)}if(D.length===0&&(!A||e.length==0)){return j[0]+C+j[1]}if(o<0){if(g(e)){return t.stylize(RegExp.prototype.toString.call(e),"regexp")}else{return t.stylize("[Object]","special")}}t.seen.push(e);var O;if(A){O=f(t,e,o,M,D)}else{O=D.map(function(i){return l(t,e,o,M,i,A)})}t.seen.pop();return d(O,C,j)}function h(t,e){switch(typeof e){case"undefined":return t.stylize("undefined","undefined");case"string":var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string");case"number":if(e===0&&1/e===-Infinity){return t.stylize("-0","number")}return t.stylize(""+e,"number");case"boolean":return t.stylize(""+e,"boolean")}if(e===null){return t.stylize("null","null")}}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,i,n,r){var s=[];for(var o=0,a=e.length;o<a;++o){if(Object.prototype.hasOwnProperty.call(e,String(o))){s.push(l(t,e,i,n,String(o),true))}else{s.push("")}}r.forEach(function(r){if(!r.match(/^\d+$/)){s.push(l(t,e,i,n,r,true))}});return s}function l(t,e,i,n,r,s){var o,a;if(e.__lookupGetter__){if(e.__lookupGetter__(r)){if(e.__lookupSetter__(r)){a=t.stylize("[Getter/Setter]","special")}else{a=t.stylize("[Getter]","special")}}else{if(e.__lookupSetter__(r)){a=t.stylize("[Setter]","special")}}}if(n.indexOf(r)<0){o="["+r+"]"}if(!a){if(t.seen.indexOf(e[r])<0){if(i===null){a=u(t,e[r],null)}else{a=u(t,e[r],i-1)}if(a.indexOf("\n")>-1){if(s){a=a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2)}else{a="\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")}}}else{a=t.stylize("[Circular]","special")}}if(typeof o==="undefined"){if(s&&r.match(/^\d+$/)){return a}o=JSON.stringify(""+r);if(o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){o=o.substr(1,o.length-2);o=t.stylize(o,"name")}else{o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");o=t.stylize(o,"string")}}return o+": "+a}function d(t,e,i){var n=0;var r=t.reduce(function(t,e){n++;if(e.indexOf("\n")>=0)n++;return t+e.length+1},0);if(r>60){return i[0]+(e===""?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]}return i[0]+e+" "+t.join(", ")+" "+i[1]}function p(t){return Array.isArray(t)||typeof t==="object"&&y(t)==="[object Array]"}function g(t){return typeof t==="object"&&y(t)==="[object RegExp]"}function v(t){return typeof t==="object"&&y(t)==="[object Date]"}function _(t){return typeof t==="object"&&y(t)==="[object Error]"}function y(t){return Object.prototype.toString.call(t)}},{"./getEnumerableProperties":21,"./getName":23,"./getProperties":26}],30:[function(t,e,i){var n=t("./inspect");var r=t("../config");e.exports=function(t){var e=n(t),i=Object.prototype.toString.call(t);if(r.truncateThreshold&&e.length>=r.truncateThreshold){if(i==="[object Function]"){return!t.name||t.name===""?"[Function]":"[Function: "+t.name+"]"}else if(i==="[object Array]"){return"[ Array("+t.length+") ]"}else if(i==="[object Object]"){var s=Object.keys(t),o=s.length>2?s.splice(0,2).join(", ")+", ...":s.join(", ");return"{ Object ("+o+") }"}else{return e}}else{return e}}},{"../config":10,"./inspect":29}],31:[function(t,e,i){e.exports=function(t,e,i,n){var r=t.__methods[e];var s=r.chainingBehavior;r.chainingBehavior=function(){var t=n(s).call(this);return t===undefined?this:t};var o=r.method;r.method=function(){var t=i(o).apply(this,arguments);return t===undefined?this:t}}},{}],32:[function(t,e,i){e.exports=function(t,e,i){var n=t[e],r=function(){return this};if(n&&"function"===typeof n)r=n;t[e]=function(){var t=i(r).apply(this,arguments);return t===undefined?this:t}}},{}],33:[function(t,e,i){e.exports=function(t,e,i){var n=Object.getOwnPropertyDescriptor(t,e),r=function(){};if(n&&"function"===typeof n.get)r=n.get;Object.defineProperty(t,e,{get:function(){var t=i(r).call(this);return t===undefined?this:t},configurable:true})}},{}],34:[function(t,e,i){var n=t("./flag");e.exports=function(t,e){var i=n(t,"negate"),r=e[0];return i?!r:r}},{"./flag":19}],35:[function(t,e,i){e.exports=function(t,e,i){var n=t.__flags||(t.__flags=Object.create(null));if(!e.__flags){e.__flags=Object.create(null)}i=arguments.length===3?i:true;for(var r in n){if(i||r!=="object"&&r!=="ssfi"&&r!="message"){e.__flags[r]=n[r]}}}},{}],36:[function(t,e,i){var n=t("../core/core.js");n.c("Draggable",{_origX:null,_origY:null,_oldX:null,_oldY:null,_dir:null,init:function(){this.requires("MouseDrag");this.bind("StartDrag",this._startDrag).bind("Dragging",this._drag)},remove:function(){this.unbind("StartDrag",this._startDrag).unbind("Dragging",this._drag)},enableDrag:function(){this.uniqueBind("Dragging",this._drag);return this;

},disableDrag:function(){this.unbind("Dragging",this._drag);return this},dragDirection:function(t){if(typeof t==="undefined"){this._dir=null}else if(""+parseInt(t,10)==t){this._dir={x:Math.cos(t/180*Math.PI),y:Math.sin(t/180*Math.PI)}}else{if(t.x===0&&t.y===0){this._dir={x:0,y:0}}else{var e=Math.sqrt(t.x*t.x+t.y*t.y);this._dir={x:t.x/e,y:t.y/e}}}return this},_startDrag:function(t){this._origX=t.realX;this._origY=t.realY;this._oldX=this._x;this._oldY=this._y},_drag:function(t){if(this._dir){if(this._dir.x!==0||this._dir.y!==0){var e=(t.realX-this._origX)*this._dir.x+(t.realY-this._origY)*this._dir.y;this.x=this._oldX+e*this._dir.x;this.y=this._oldY+e*this._dir.y}}else{this.x=this._oldX+(t.realX-this._origX);this.y=this._oldY+(t.realY-this._origY)}}});n.c("Multiway",{_speed:null,init:function(){this.requires("Motion, Keyboard");this._keyDirection={};this._activeDirections={};this._directionSpeed={};this._speed={x:150,y:150};this.bind("KeyDown",this._keydown).bind("KeyUp",this._keyup)},remove:function(){this.unbind("KeyDown",this._keydown).unbind("KeyUp",this._keyup);this.__unapplyActiveDirections()},_keydown:function(t){var e=this._keyDirection[t.key];if(e!==undefined){if(this._activeDirections[e]===0&&!this.disableControls){this.vx+=this._directionSpeed[e].x;this.vy+=this._directionSpeed[e].y}this._activeDirections[e]++}},_keyup:function(t){var e=this._keyDirection[t.key];if(e!==undefined){this._activeDirections[e]--;if(this._activeDirections[e]===0&&!this.disableControls){this.vx-=this._directionSpeed[e].x;this.vy-=this._directionSpeed[e].y}}},multiway:function(t,e){if(e){if(t.x!==undefined&&t.y!==undefined){this._speed.x=t.x;this._speed.y=t.y}else{this._speed.x=t;this._speed.y=t}}else{e=t}if(!this.disableControls){this.__unapplyActiveDirections()}this._updateKeys(e);this._updateSpeed(this._speed);if(!this.disableControls){this.__applyActiveDirections()}return this},speed:function(t){if(!this.disableControls){this.__unapplyActiveDirections()}this._updateSpeed(t);if(!this.disableControls){this.__applyActiveDirections()}return this},_updateKeys:function(t){this._keyDirection={};this._activeDirections={};for(var e in t){var i=n.keys[e]||e;var r=this._keyDirection[i]=t[e];this._activeDirections[r]=this._activeDirections[r]||0;if(this.isDown(i))this._activeDirections[r]++}},_updateSpeed:function(t){this._directionSpeed={};var e;for(var i in this._keyDirection){e=this._keyDirection[i];this._directionSpeed[e]={x:Math.round(Math.cos(e*(Math.PI/180))*1e3*t.x)/1e3,y:Math.round(Math.sin(e*(Math.PI/180))*1e3*t.y)/1e3}}},__applyActiveDirections:function(){for(var t in this._activeDirections){if(this._activeDirections[t]>0){this.vx+=this._directionSpeed[t].x;this.vy+=this._directionSpeed[t].y}}},__unapplyActiveDirections:function(){for(var t in this._activeDirections){if(this._activeDirections[t]>0){this.vx-=this._directionSpeed[t].x;this.vy-=this._directionSpeed[t].y}}},enableControl:function(){if(this.disableControls){this.__applyActiveDirections()}this.disableControls=false;return this},disableControl:function(){if(!this.disableControls){this.__unapplyActiveDirections()}this.disableControls=true;return this}});n.c("Jumper",{_jumpSpeed:300,canJump:true,init:function(){this.requires("Supportable, Motion, Keyboard");this.enableControl=this.enableControl||function(){this.disableControls=false};this.disableControl=this.disableControl||function(){this.disableControls=true}},remove:function(){this.unbind("KeyDown",this._keydown_jumper)},_keydown_jumper:function(t){if(this.disableControls)return;if(this._jumpKeys[t.key]){var e=this.ground;this.canJump=!!e;this.trigger("CheckJumping",e);if(this.canJump){this.vy=-this._jumpSpeed}}},jumper:function(t,e){if(e){this._jumpSpeed=t}else{e=t}this._jumpKeys={};for(var i=0;i<e.length;++i){var r=e[i];var s=n.keys[r]||r;this._jumpKeys[s]=true}this.uniqueBind("KeyDown",this._keydown_jumper);return this},jumpSpeed:function(t){this._jumpSpeed=t;return this}});n.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(t){this.multiway(t||this._speed,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180});return this}});n.c("Twoway",{init:function(){this.requires("Multiway, Jumper")},twoway:function(t,e){this.multiway(t||this._speed,{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180});this.jumper(e||t*2||this._jumpSpeed,[n.keys.UP_ARROW,n.keys.W,n.keys.Z]);return this}})},{"../core/core.js":41}],37:[function(t,e,i){var n=t("../core/core.js");n.extend({device:{_deviceOrientationCallback:false,_deviceMotionCallback:false,_normalizeDeviceOrientation:function(t){var e;if(window.DeviceOrientationEvent){e={tiltLR:t.gamma,tiltFB:t.beta,dir:t.alpha,motUD:null}}else if(window.OrientationEvent){e={tiltLR:t.x*90,tiltFB:t.y*-90,dir:null,motUD:t.z}}n.device._deviceOrientationCallback(e)},_normalizeDeviceMotion:function(t){var e=t.accelerationIncludingGravity,i=e.z>0?+1:-1;var r={acceleration:e,rawAcceleration:"["+Math.round(e.x)+", "+Math.round(e.y)+", "+Math.round(e.z)+"]",facingUp:i,tiltLR:Math.round(e.x/9.81*-90),tiltFB:Math.round((e.y+9.81)/9.81*90*i)};n.device._deviceMotionCallback(r)},deviceOrientation:function(t){this._deviceOrientationCallback=t;if(n.support.deviceorientation){if(window.DeviceOrientationEvent){n.addEvent(this,window,"deviceorientation",this._normalizeDeviceOrientation)}else if(window.OrientationEvent){n.addEvent(this,window,"MozOrientation",this._normalizeDeviceOrientation)}}},deviceMotion:function(t){this._deviceMotionCallback=t;if(n.support.devicemotion){if(window.DeviceMotionEvent){n.addEvent(this,window,"devicemotion",this._normalizeDeviceMotion)}}}}})},{"../core/core.js":41}],38:[function(t,e,i){var n=t("../core/core.js"),r=window.document;n.extend({over:null,mouseObjs:0,mousePos:{},lastEvent:null,touchObjs:0,selected:false,keydown:{},detectBlur:function(t){var e=t.clientX>n.stage.x&&t.clientX<n.stage.x+n.viewport.width&&(t.clientY>n.stage.y&&t.clientY<n.stage.y+n.viewport.height);if(!n.selected&&e){n.trigger("CraftyFocus")}if(n.selected&&!e){n.trigger("CraftyBlur")}n.selected=e},multitouch:function(t){if(typeof t!=="boolean")return this._touchHandler.multitouch;this._touchHandler.multitouch=t},resetKeyDown:function(){for(var t in n.keys){if(n.keydown[n.keys[t]]){this.trigger("KeyUp",{key:n.keys[t]})}}n.keydown={}},mouseDispatch:function(t){if(!n.mouseObjs)return;n.lastEvent=t;var e=-1,i=t.target?t.target:t.srcElement,r,s,o=0,a,u=n.domHelper.translate(t.clientX,t.clientY),h,c,f={},l=t.type;if(typeof t.which==="undefined"){t.mouseButton=t.button<2?n.mouseButtons.LEFT:t.button==4?n.mouseButtons.MIDDLE:n.mouseButtons.RIGHT}else{t.mouseButton=t.which<2?n.mouseButtons.LEFT:t.which==2?n.mouseButtons.MIDDLE:n.mouseButtons.RIGHT}t.realX=h=n.mousePos.x=u.x;t.realY=c=n.mousePos.y=u.y;r=n.findClosestEntityByComponent("Mouse",h,c,i);if(r){if(l==="mousedown"){r.trigger("MouseDown",t)}else if(l==="mouseup"){r.trigger("MouseUp",t)}else if(l=="dblclick"){r.trigger("DoubleClick",t)}else if(l=="click"){r.trigger("Click",t)}else if(l==="mousemove"){r.trigger("MouseMove",t);if(this.over!==r){if(this.over){this.over.trigger("MouseOut",t);this.over=null}this.over=r;r.trigger("MouseOver",t)}}else r.trigger(l,t)}else{if(l==="mousemove"&&this.over){this.over.trigger("MouseOut",t);this.over=null}if(l==="mousedown"){n.viewport.mouselook("start",t)}else if(l==="mousemove"){n.viewport.mouselook("drag",t)}else if(l=="mouseup"){n.viewport.mouselook("stop")}}if(l==="mousemove"){this.lastEvent=t}},touchDispatch:function(t){if(!n.touchObjs&&!n.mouseObjs)return;if(this._touchHandler.multitouch)switch(t.type){case"touchstart":this._touchHandler.handleStart(t);break;case"touchmove":this._touchHandler.handleMove(t);break;case"touchleave":case"touchcancel":case"touchend":this._touchHandler.handleEnd(t);break}else this._touchHandler.mimicMouse(t);if(t.target&&t.target.nodeName!=="INPUT"&&t.target.nodeName!=="TEXTAREA")if(t.preventDefault){t.preventDefault()}else{t.returnValue=false}},_touchHandler:{fingers:[],multitouch:false,handleStart:function(t){var e=t.changedTouches;for(var i=0,r=e.length;i<r;i++){var s=false,o=n.domHelper.translate(e[i].clientX,e[i].clientY),a=t.target?t.target:t.srcElement,u,h,c;e[i].realX=u=o.x;e[i].realY=h=o.y;c=this.findClosestTouchEntity(u,h,a);if(c){c.trigger("TouchStart",e[i]);s=this.fingerDownIndexByEntity(c)}var f=this.setTouch(e[i],c);if(s!==false&&s>=0){this.fingers[s]=f}else{this.fingers.push(f)}}},handleMove:function(t){var e=t.changedTouches;for(var i=0,r=e.length;i<r;i++){var s=this.fingerDownIndexById(e[i].identifier),o=n.domHelper.translate(e[i].clientX,e[i].clientY),a=t.target?t.target:t.srcElement,u,h,c;e[i].realX=u=o.x;e[i].realY=h=o.y;c=this.findClosestTouchEntity(u,h,a);if(s>=0){if(typeof this.fingers[s].entity!=="undefined")if(this.fingers[s].entity==c){this.fingers[s].entity.trigger("TouchMove",e[i])}else{if(typeof c==="object")c.trigger("TouchStart",e[i]);this.fingers[s].entity.trigger("TouchEnd")}this.fingers[s].entity=c;this.fingers[s].realX=u;this.fingers[s].realY=h}}},handleEnd:function(t){var e=t.changedTouches,i=t.type=="touchcancel"?"TouchCancel":"TouchEnd";for(var n=0,r=e.length;n<r;n++){var s=this.fingerDownIndexById(e[n].identifier);if(s>=0){if(this.fingers[s].entity)this.fingers[s].entity.trigger(i);this.fingers.splice(s,1)}}},setTouch:function(t,e){return{identifier:t.identifier,realX:t.realX,realY:t.realY,entity:e}},findClosestTouchEntity:function(t,e,i){return n.findClosestEntityByComponent("Touch",t,e,i)},fingerDownIndexById:function(t){for(var e=0,i=this.fingers.length;e<i;e++){var n=this.fingers[e].identifier;if(n==t){return e}}return-1},fingerDownIndexByEntity:function(t){for(var e=0,i=this.fingers.length;e<i;e++){var n=this.fingers[e].entity;if(n==t){return e}}return-1},mimicMouse:function(t){var e,i=n.lastEvent;if(t.type==="touchstart")e="mousedown";else if(t.type==="touchmove")e="mousemove";else if(t.type==="touchend")e="mouseup";else if(t.type==="touchcancel")e="mouseup";else if(t.type==="touchleave")e="mouseup";if(t.touches&&t.touches.length){first=t.touches[0]}else if(t.changedTouches&&t.changedTouches.length){first=t.changedTouches[0]}var s=r.createEvent("MouseEvent");s.initMouseEvent(e,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,t.relatedTarget);first.target.dispatchEvent(s);if(i!==null&&i.type=="mousedown"&&e=="mouseup"){e="click";s=r.createEvent("MouseEvent");s.initMouseEvent(e,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,t.relatedTarget);first.target.dispatchEvent(s)}}},findClosestEntityByComponent:function(t,e,i,r){var s=r?r:n.stage.elem,o,a,u,h=0,c=-1,f={};if(s.nodeName!="CANVAS"){while(typeof s.id!="string"&&s.id.indexOf("ent")==-1){s=s.parentNode}var l=n(parseInt(s.id.replace("ent",""),10));if(l.__c[t]&&l.isAt(e,i)){o=l}}if(!o){a=n.map.search({_x:e,_y:i,_w:1,_h:1},false);for(u=a.length;h<u;++h){if(!a[h].__c[t]||!a[h]._visible){continue}var d=a[h],p=false;if(f[d[0]]){continue}else f[d[0]]=true;if(d.mapArea){if(d.mapArea.containsPoint(e,i)){p=true}}else if(d.isAt(e,i))p=true;if(p&&(d._z>=c||c===-1)){if(d._z===c&&d[0]<o[0]){continue}c=d._z;o=d}}}return o},mouseWheelDispatch:function(t){t.direction=t.detail<0||t.wheelDelta>0?1:-1;n.trigger("MouseWheelScroll",t)},keyboardDispatch:function(t){var e=t,i={},r="char charCode keyCode type shiftKey ctrlKey metaKey timestamp".split(" ");for(var s=r.length;s;){var o=r[--s];i[o]=e[o]}i.which=e.charCode!==null?e.charCode:e.keyCode;i.key=e.keyCode||e.which;i.originalEvent=e;t=i;if(t.type==="keydown"){if(n.keydown[t.key]!==true){n.keydown[t.key]=true;n.trigger("KeyDown",t)}}else if(t.type==="keyup"){delete n.keydown[t.key];n.trigger("KeyUp",t)}if(n.selected&&!(t.key==8||t.key>=112&&t.key<=135)){if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true;if(e.target&&e.target.nodeName!=="INPUT"&&e.target.nodeName!=="TEXTAREA"){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}return false}}});n._preBind("Load",function(){n.addEvent(this,"keydown",n.keyboardDispatch);n.addEvent(this,"keyup",n.keyboardDispatch);n.addEvent(this,n.stage.elem,"mousedown",n.mouseDispatch);n.addEvent(this,n.stage.elem,"mouseup",n.mouseDispatch);n.addEvent(this,r.body,"mouseup",n.detectBlur);n.addEvent(this,window,"blur",n.resetKeyDown);n.addEvent(this,n.stage.elem,"mousemove",n.mouseDispatch);n.addEvent(this,n.stage.elem,"click",n.mouseDispatch);n.addEvent(this,n.stage.elem,"dblclick",n.mouseDispatch);n.addEvent(this,n.stage.elem,"touchstart",n.touchDispatch);n.addEvent(this,n.stage.elem,"touchmove",n.touchDispatch);n.addEvent(this,n.stage.elem,"touchend",n.touchDispatch);n.addEvent(this,n.stage.elem,"touchcancel",n.touchDispatch);n.addEvent(this,n.stage.elem,"touchleave",n.touchDispatch);if(n.support.prefix==="Moz")n.addEvent(this,n.stage.elem,"DOMMouseScroll",n.mouseWheelDispatch);else n.addEvent(this,n.stage.elem,"mousewheel",n.mouseWheelDispatch)});n._preBind("CraftyStop",function(){n.removeEvent(this,"keydown",n.keyboardDispatch);n.removeEvent(this,"keyup",n.keyboardDispatch);if(n.stage){n.removeEvent(this,n.stage.elem,"mousedown",n.mouseDispatch);n.removeEvent(this,n.stage.elem,"mouseup",n.mouseDispatch);n.removeEvent(this,n.stage.elem,"mousemove",n.mouseDispatch);n.removeEvent(this,n.stage.elem,"click",n.mouseDispatch);n.removeEvent(this,n.stage.elem,"dblclick",n.mouseDispatch);n.removeEvent(this,n.stage.elem,"touchstart",n.touchDispatch);n.removeEvent(this,n.stage.elem,"touchmove",n.touchDispatch);n.removeEvent(this,n.stage.elem,"touchend",n.touchDispatch);n.removeEvent(this,n.stage.elem,"touchcancel",n.touchDispatch);n.removeEvent(this,n.stage.elem,"touchleave",n.touchDispatch);if(n.support.prefix==="Moz")n.removeEvent(this,n.stage.elem,"DOMMouseScroll",n.mouseWheelDispatch);else n.removeEvent(this,n.stage.elem,"mousewheel",n.mouseWheelDispatch)}n.removeEvent(this,r.body,"mouseup",n.detectBlur);n.removeEvent(this,window,"blur",n.resetKeyDown)});n.c("Mouse",{init:function(){n.mouseObjs++;this.requires("AreaMap").bind("Remove",function(){n.mouseObjs--})}});n.c("Touch",{init:function(){n.touchObjs++;this.requires("AreaMap").bind("Remove",function(){n.touchObjs--})}});n.c("AreaMap",{init:function(){},areaMap:function(t){if(arguments.length>1){var e=Array.prototype.slice.call(arguments,0);t=new n.polygon(e)}else if(t.constructor===Array){t=new n.polygon(t.slice())}else{t=t.clone()}t.shift(this._x,this._y);this.mapArea=t;this.attach(this.mapArea);this.trigger("NewAreaMap",t);return this}});n.c("Button",{init:function(){var t=!n.mobile||n.mobile&&!n.multitouch()?"Mouse":"Touch";this.requires(t)}});n.c("MouseDrag",{_dragging:false,init:function(){this.requires("Mouse");this.bind("MouseDown",this._ondown)},remove:function(){this.unbind("MouseDown",this._ondown)},_ondown:function(t){if(t.mouseButton!==n.mouseButtons.LEFT)return;this.startDrag(t)},_ondrag:function(t){if(!this._dragging||t.realX===0||t.realY===0)return false;this.trigger("Dragging",t)},_onup:function(t){if(t.mouseButton!==n.mouseButtons.LEFT)return;this.stopDrag(t)},startDrag:function(t){if(this._dragging)return;this._dragging=true;n.addEvent(this,n.stage.elem,"mousemove",this._ondrag);n.addEvent(this,n.stage.elem,"mouseup",this._onup);this.trigger("StartDrag",t||n.lastEvent);return this},stopDrag:function(t){if(!this._dragging)return;this._dragging=false;n.removeEvent(this,n.stage.elem,"mousemove",this._ondrag);n.removeEvent(this,n.stage.elem,"mouseup",this._onup);this.trigger("StopDrag",t||n.lastEvent);return this}});n.c("Keyboard",{isDown:function(t){if(typeof t==="string"){t=n.keys[t]}return!!n.keydown[t]}})},{"../core/core.js":41}],39:[function(t,e,i){var n=t("../core/core.js");n.extend({keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,PULT_UP:29460,PULT_DOWN:29461,PULT_LEFT:4,PULT_RIGHT:5},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}})},{"../core/core.js":41}],40:[function(t,e,i){var n=function(t,e){this.timePerFrame=1e3/Crafty.timer.FPS();this.duration=t;if(typeof e==="function"){this.easing_function=e}else if(typeof e==="string"&&this.standardEasingFunctions[e]){this.easing_function=this.standardEasingFunctions[e]}else{this.easing_function=this.standardEasingFunctions.linear}this.reset()};n.prototype={duration:0,clock:0,steps:null,complete:false,paused:false,reset:function(){this.loops=1;this.clock=0;this.complete=false;this.paused=false},repeat:function(t){this.loops=t},setProgress:function(t,e){this.clock=this.duration*t;if(typeof e!=="undefined")this.loops=e},pause:function(){this.paused=true},resume:function(){this.paused=false;this.complete=false},tick:function(t){if(this.paused||this.complete)return;this.clock+=t;this.frames=Math.floor(this.clock/this.timePerFrame);while(this.clock>=this.duration&&this.complete===false){this.loops--;if(this.loops>0)this.clock-=this.duration;else this.complete=true}},time:function(){return Math.min(this.clock/this.duration,1)},value:function(){return this.easing_function(this.time())},standardEasingFunctions:{linear:function(t){return t},smoothStep:function(t){return(3-2*t)*t*t},smootherStep:function(t){return(6*t*t-15*t+10)*t*t*t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1}}};e.exports=n},{}],41:[function(t,e,i){var n=t("./version");var r=function(t){return new r.fn.init(t)};var s,o,a,u,h,c,f,l,d,p;a={};f=Array.prototype.slice;l=/\s*,\s*/;d=/\s+/;var g=function(){s=1;o=0;u={};h={};c=[]};g();r.fn=r.prototype={init:function(t){if(typeof t==="string"){var e=0,i,n,s=false,o=false,h,c,f,p,g;if(t==="*"){p=0;for(i in u){this[p]=+i;p++}this.length=p;if(p===1){return u[this[0]]}return this}if(t.indexOf(",")!==-1){o=true;h=l}else if(t.indexOf(" ")!==-1){s=true;h=d}for(i in u){if(!u.hasOwnProperty(i))continue;n=u[i];if(s||o){c=t.split(h);p=0;g=c.length;f=0;for(;p<g;p++)if(n.__c[c[p]])f++;if(s&&f===g||o&&f>0)this[e++]=+i}else if(n.__c[t])this[e++]=+i}if(e>0&&!s&&!o)this.extend(a[t]);if(c&&s)for(p=0;p<g;p++)this.extend(a[c[p]]);this.length=e;if(e===1){return u[this[e-1]]}}else{if(!t){t=0;if(!(t in u))u[t]=this}if(!(t in u)){this.length=0;return this}this[0]=t;this.length=1;if(!this.__c)this.__c={};if(!this._callbacks)r._addCallbackMethods(this);if(!u[t])u[t]=this;return u[t]}r._addCallbackMethods(this);return this},setName:function(t){var e=String(t);this._entityName=e;this.trigger("NewEntityName",e);return this},addComponent:function(t){var e,i,n=0;if(arguments.length===1&&t.indexOf(",")!==-1){e=t.split(l)}else{e=arguments}for(;n<e.length;n++){if(this.__c[e[n]]===true){continue}this.__c[e[n]]=true;i=a[e[n]];this.extend(i);if(i&&"required"in i){this.requires(i.required)}if(i&&"init"in i){i.init.call(this)}if(i&&"events"in i){var r=i.events;for(var s in r){var o=typeof r[s]==="function"?r[s]:i[r[s]];this.bind(s,o)}}}this.trigger("NewComponent",e);return this},toggleComponent:function(t){var e=0,i,n;if(arguments.length>1){i=arguments.length;for(;e<i;e++){if(this.has(arguments[e])){this.removeComponent(arguments[e])}else{this.addComponent(arguments[e])}}}else if(t.indexOf(",")!==-1){n=t.split(l);i=n.length;for(;e<i;e++){if(this.has(n[e])){this.removeComponent(n[e])}else{this.addComponent(n[e])}}}else{if(this.has(t)){this.removeComponent(t)}else{this.addComponent(t)}}return this},requires:function(t){return this.addComponent(t)},removeComponent:function(t,e){var i=a[t];this.trigger("RemoveComponent",t);if(i&&"events"in i){var n=i.events;for(var r in n){var s=typeof n[r]==="function"?n[r]:i[n[r]];this.unbind(r,s)}}if(i&&"remove"in i){i.remove.call(this,false)}if(e===false&&i){for(var o in i){delete this[o]}}delete this.__c[t];return this},getId:function(){return this[0]},has:function(t){return!!this.__c[t]},attr:function(t,e,i,n){if(arguments.length===1&&typeof arguments[0]==="string"){return this._attr_get(t)}else{return this._attr_set(t,e,i,n)}},_attr_get:function(t,e){var i,n,r;if(typeof e==="undefined"||e===null){e=this}if(t.indexOf(".")>-1){n=t.split(".");i=n.shift();r=n.join(".");return this._attr_get(n.join("."),e[i])}else{return e[t]}},_attr_set:function(){var t,e,i;if(typeof arguments[0]==="string"){t=this._set_create_object(arguments[0],arguments[1]);e=!!arguments[2];i=arguments[3]||arguments[0].indexOf(".")>-1}else{t=arguments[0];e=!!arguments[1];i=!!arguments[2]}if(!e){this.trigger("Change",t)}if(i){this._recursive_extend(t,this)}else{this.extend.call(this,t)}return this},_set_create_object:function(t,e){var i={},n,r,s;if(t.indexOf(".")>-1){n=t.split(".");r=n.shift();s=n.join(".");i[r]=this._set_create_object(s,e)}else{i[t]=e}return i},_recursive_extend:function(t,e){var i;for(i in t){if(t[i].constructor===Object){e[i]=this._recursive_extend(t[i],e[i])}else{e[i]=t[i]}}return e},toArray:function(){return f.call(this,0)},timeout:function(t,e){this.each(function(){var i=this;setTimeout(function(){t.call(i)},e)});return this},bind:function(t,e){if(this.length===1){this._bindCallback(t,e)}else{for(var i=0;i<this.length;i++){var n=u[this[i]];if(n){n._bindCallback(t,e)}}}return this},uniqueBind:function(t,e){this.unbind(t,e);this.bind(t,e)},one:function(t,e){var i=this;var n=function(r){e.call(i,r);i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){var i,n;for(i=0;i<this.length;i++){n=u[this[i]];if(n){n._unbindCallbacks(t,e)}}return this},trigger:function(t,e){if(this.length===1){this._runCallbacks(t,e)}else{for(var i=0;i<this.length;i++){var n=u[this[i]];if(n){n._runCallbacks(t,e)}}}return this},each:function(t){var e=0,i=this.length;for(;e<i;e++){if(!u[this[e]])continue;t.call(u[this[e]],e)}return this},get:function(t){var e=this.length;if(typeof t!=="undefined"){if(t>=e||t+e<0)return undefined;if(t>=0)return u[this[t]];else return u[this[t+e]]}else{var i=0,n=[];for(;i<e;i++){if(!u[this[i]])continue;n.push(u[this[i]])}return n}},clone:function(){var t=this.__c,e,i,n=r.e();for(e in t){n.addComponent(e)}for(i in this){if(i!="0"&&i!="_global"&&i!="_changed"&&typeof this[i]!="function"&&typeof this[i]!="object"){n[i]=this[i]}}return n},setter:function(t,e){return this.defineField(t,function(){},e)},defineField:function(t,e,i){r.defineField(this,t,e,i);return this},destroy:function(){this.each(function(){var t;this.trigger("Remove");for(var e in this.__c){t=a[e];if(t&&"remove"in t)t.remove.call(this,true)}this._unbindAll();delete u[this[0]]})}};r.fn.init.prototype=r.fn;r.extend=r.fn.extend=function(t){var e=this,i;if(!t)return e;for(i in t){if(e===t[i])continue;e[i]=t[i]}return e};r._callbackMethods={_bindCallback:function(t,e){var i=this._callbacks[t];if(!i){i=this._callbacks[t]=(h[t]||(h[t]={}))[this[0]]=[];i.context=this;i.depth=0}i.push(e)},_runCallbacks:function(t,e){if(!this._callbacks[t]){return}var i=this._callbacks[t];var n,r=i.length;i.depth++;for(n=0;n<r;n++){if(typeof i[n]==="undefined"){if(i.depth<=1){i.splice(n,1);n--;r--;if(i.length===0){delete this._callbacks[t];delete h[t][this[0]]}}}else{i[n].call(this,e)}}i.depth--},_unbindCallbacks:function(t,e){if(!this._callbacks[t]){return}var i=this._callbacks[t];for(var n=0;n<i.length;n++){if(!e||i[n]==e){delete i[n]}}},_unbindAll:function(){if(!this._callbacks)return;for(var t in this._callbacks){if(this._callbacks[t]){this._unbindCallbacks(t);delete h[t][this[0]]}}}};r._addCallbackMethods=function(t){t.extend(r._callbackMethods);t._callbacks={}};r._addCallbackMethods(r);r.extend({0:"global",init:function(t,e,i){if(!this._preBindDone){for(var n=0;n<this._bindOnInit.length;n++){var s=this._bindOnInit[n];r.bind(s.event,s.handler)}}r.viewport.init(t,e,i);this.trigger("Load");this.timer.init();return this},_bindOnInit:[],_preBindDone:false,_preBind:function(t,e){this._bindOnInit.push({event:t,handler:e})},getVersion:function(){return n},stop:function(t){r.trigger("CraftyStop",t);this.timer.stop();if(t){r.audio.remove();if(r.stage&&r.stage.elem.parentNode){var e=document.createElement("div");e.id=r.stage.elem.id;r.stage.elem.parentNode.replaceChild(e,r.stage.elem)}delete r.canvasLayer.context;delete r.domLayer._div;delete r.webgl.context;r._unbindAll();r._addCallbackMethods(r);this._preBindDone=false;g()}return this},pause:function(t){if(arguments.length===1?t:!this._paused){this.trigger("Pause");this._paused=true;setTimeout(function(){r.timer.stop()},0);r.keydown={}}else{this.trigger("Unpause");this._paused=false;setTimeout(function(){r.timer.init()},0)}return this},isPaused:function(){return this._paused},timer:function(){var t,e;var i="fixed",n=5,s=40;var a=0,u=0,h;var c=50,f=1e3/c;return{init:function(){if(typeof h==="undefined")h=(new Date).getTime()-f;var i=typeof window!=="undefined"&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null);if(i){t=function(){r.timer.step();if(t!==null){e=i(t)}};t()}else{t=setInterval(function(){r.timer.step()},1e3/c)}},stop:function(){r.trigger("CraftyStopTimer");if(typeof t!=="function")clearInterval(t);var i=typeof window!=="undefined"&&(window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||null);if(i)i(e);t=null},steptype:function(t,e){if(t==="variable"||t==="semifixed"){i=t;if(e)s=e}else if(t==="fixed"){i="fixed";if(e)n=e}else{throw"Invalid step type specified"}},step:function(){var t,e,c,l=0;currentTime=(new Date).getTime();if(a>0)r.trigger("MeasureWaitTime",currentTime-a);if(h+u>=currentTime){a=currentTime;return}var d=currentTime-(h+u);if(d>f*20){u+=d-f;d=f}if(i==="fixed"){l=Math.ceil(d/f);l=Math.min(l,n);e=f}else if(i==="variable"){l=1;e=d;e=Math.min(e,s)}else if(i==="semifixed"){l=Math.ceil(d/s);e=d/l}for(var p=0;p<l;p++){c=currentTime;var g={frame:o++,dt:e,gameTime:h};r.trigger("EnterFrame",g);r.trigger("ExitFrame",g);h+=e;currentTime=(new Date).getTime();r.trigger("MeasureFrameTime",currentTime-c)}if(l>0){t=currentTime;r.trigger("PreRender");r.trigger("RenderScene");r.trigger("PostRender");currentTime=(new Date).getTime();r.trigger("MeasureRenderTime",currentTime-t)}a=currentTime},FPS:function(t){if(typeof t=="undefined")return c;else{c=t;f=1e3/c;r.trigger("FPSChange",t)}},simulateFrames:function(t,e){if(typeof e==="undefined")e=f;while(t-->0){var i={frame:o++,dt:e};r.trigger("EnterFrame",i);r.trigger("ExitFrame",i)}r.trigger("PreRender");r.trigger("RenderScene");r.trigger("PostRender")}}}(),e:function(){var t=v();u[t]=null;u[t]=r(t);if(arguments.length>0){u[t].addComponent.apply(u[t],arguments)}u[t].setName("Entity #"+t);u[t].addComponent("obj");r.trigger("NewEntity",{id:t});return u[t]},c:function(t,e){a[t]=e},trigger:function(t,e){var i=h[t]||(h[t]={}),n,r;for(n in i){if(!i.hasOwnProperty(n))continue;r=i[n];if(!r||r.length===0)continue;r.context._runCallbacks(t,e)}},bind:function(t,e){this._bindCallback(t,e);return e},uniqueBind:function(t,e){this.unbind(t,e);return this.bind(t,e)},one:function(t,e){var i=this;var n=function(r){e.call(i,r);i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){this._unbindCallbacks(t,e)},frame:function(){return o},components:function(){return a},isComp:function(t){return t in a},debug:function(t){if(t==="handlers"){return h}return u},settings:function(){var t={},e={};return{register:function(t,i){e[t]=i},modify:function(i,n){if(!e[i])return;e[i].call(t[i],n);t[i]=n},get:function(e){return t[e]}}}(),defineField:function(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,configurable:false,enumerable:true})},clone:_});function v(){var t=s++;if(t in u){return v()}return t}function _(t){if(t===null||typeof t!="object")return t;var e=t.constructor();for(var i in t)e[i]=_(t[i]);return e}if(typeof define==="function"){define("crafty",[],function(){return r})}e.exports=r},{"./version":50}],42:[function(t,e,i){(function(i){var n=t("./core");var r=typeof window!=="undefined"&&window.document;(function s(){var t=n.support={},e=typeof navigator!=="undefined"&&navigator.userAgent.toLowerCase()||typeof i!=="undefined"&&i.version,s=/(webkit)[ \/]([\w.]+)/.exec(e)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(e)||/(ms)ie ([\w.]+)/.exec(e)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(e)||/(v)\d+\.(\d+)/.exec(e)||[],o=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(e);if(o)n.mobile=o[0];t.defineProperty=function(){if(!("defineProperty"in Object))return false;try{Object.defineProperty({},"x",{})}catch(t){return false}return true}();t.audio=typeof window!=="undefined"&&"canPlayType"in r.createElement("audio");t.prefix=s[1]||s[0];if(t.prefix==="moz")t.prefix="Moz";if(t.prefix==="o")t.prefix="O";if(t.prefix==="v")t.prefix="node";if(s[2]){t.versionName=s[2];t.version=+s[2].split(".")[0]}t.canvas=typeof window!=="undefined"&&"getContext"in r.createElement("canvas");if(t.canvas){var a;try{var u=r.createElement("canvas");a=u.getContext("webgl")||u.getContext("experimental-webgl");a.viewportWidth=t.canvas.width;a.viewportHeight=t.canvas.height}catch(h){}t.webgl=!!a}else{t.webgl=false}t.css3dtransform=typeof window!=="undefined"&&(typeof r.createElement("div").style.Perspective!=="undefined"||typeof r.createElement("div").style[t.prefix+"Perspective"]!=="undefined");t.deviceorientation=typeof window!=="undefined"&&(typeof window.DeviceOrientationEvent!=="undefined"||typeof window.OrientationEvent!=="undefined");t.devicemotion=typeof window!=="undefined"&&typeof window.DeviceMotionEvent!=="undefined"})();e.exports={_events:{},addEvent:function(t,e,i,n){if(arguments.length===3){n=i;i=e;e=window.document}var r=function(e){n.call(t,e)},s=t[0]||"";if(!this._events[s+e+i+n])this._events[s+e+i+n]=r;else{return}e.addEventListener(i,r,false)},removeEvent:function(t,e,i,n){if(arguments.length===3){n=i;i=e;e=window.document}var r=t[0]||"",s=this._events[r+e+i+n];if(s){e.removeEventListener(i,s,false);delete this._events[r+e+i+n]}},background:function(t){n.stage.elem.style.background=t}}}).call(this,t("_process"))},{"./core":41,_process:84}],43:[function(t,e,i){var n=t("../core/core.js");e.exports={assets:{},__paths:{audio:"",images:""},paths:function(t){if(typeof t==="undefined"){return this.__paths}else{if(t.audio)this.__paths.audio=t.audio;if(t.images)this.__paths.images=t.images}},asset:function(t,e){if(arguments.length===1){return n.assets[t]}if(!n.assets[t]){n.assets[t]=e;this.trigger("NewAsset",{key:t,value:e});return e}},image_whitelist:["jpg","jpeg","gif","png","svg"],load:function(t,e,i,r){if(Array.isArray(t)){n.log("Calling Crafty.load with an array of assets no longer works; see the docs for more details.")}t=typeof t==="string"?JSON.parse(t):t;var s=0,o=(t.audio?Object.keys(t.audio).length:0)+(t.images?Object.keys(t.images).length:0)+(t.sprites?Object.keys(t.sprites).length:0),a,u,h,c,f,l=n.support.audio,d=n.paths(),p=function(t){return t.substr(t.lastIndexOf(".")+1).toLowerCase()},g=function(t,e){return e.search("://")===-1?t=="audio"?d.audio+e:d.images+e:e},v=function(t){return n.asset(t)||null},_=function(t){return n.audio.supports(p(t))},y=function(t){return n.image_whitelist.indexOf(p(t))!=-1},m=function(t,e){t.onload=w;if(n.support.prefix==="webkit")t.src="";t.src=e};function w(){var t=this.src;if(this.removeEventListener)this.removeEventListener("canplaythrough",w,false);s++;if(i)i({loaded:s,total:o,percent:s/o*100,src:t});if(s===o&&e)e()}function b(){var t=this.src;if(r)r({loaded:s,total:o,percent:s/o*100,src:t});s++;if(s===o&&e)e();

}for(c in t){for(f in t[c]){if(!t[c].hasOwnProperty(f))continue;a=t[c][f];if(c==="audio"&&l){if(typeof a==="object"){var x=[];for(var E in a){u=g(c,a[E]);if(!v(u)&&_(a[E]))x.push(u)}h=n.audio.add(f,x).obj}else if(typeof a==="string"&&_(a)){u=g(c,a);if(!v(u))h=n.audio.add(f,u).obj}if(h&&h.addEventListener)h.addEventListener("canplaythrough",w,false)}else{f=c==="sprites"?f:a;u=g(c,f);if(y(f)){h=v(u);if(!h){h=new Image;if(c==="sprites")n.sprite(a.tile,a.tileh,u,a.map,a.paddingX,a.paddingY,a.paddingAroundBorder);n.asset(u,h)}m(h,u)}}if(h)h.onerror=b;else--o}}if(o===0)e()},removeAssets:function(t){t=typeof t==="string"?JSON.parse(t):t;var e,i,r,s,o=n.paths(),a=function(t,e){return e.search("://")===-1?t=="audio"?o.audio+e:o.images+e:e};for(r in t){for(s in t[r]){if(!t[r].hasOwnProperty(s))continue;e=t[r][s];if(r==="audio"){if(typeof e==="object"){for(var u in e){i=a(r,e[u]);if(n.asset(i))n.audio.remove(s)}}else if(typeof e==="string"){i=a(r,e);if(n.asset(i))n.audio.remove(s)}}else{s=r==="sprites"?s:e;i=a(r,s);if(n.asset(i)){if(r==="sprites")for(var h in e.map)delete n.components()[h];delete n.assets[i]}}}}}}},{"../core/core.js":41}],44:[function(t,e,i){e.exports={init:function(){this.changed=[];this.bind("Change",this._changed_attributes);this.bind("Change",this._changed_triggers)},_changed_triggers:function(t,e){var i,n;e=Crafty.extend.call({pre:""},e);for(i in t){this.trigger("Change["+e.pre+i+"]",t[i]);if(t[i].constructor===Object){this._changed_triggers(t[i],{pre:e.pre+i+"."})}}},_changed_attributes:function(t){var e;for(e in t){this.changed.push(e)}return this},is_dirty:function(t){if(arguments.length===0){return!!this.changed.length}else{return this.changed.indexOf(t)>-1}}}},{}],45:[function(t,e,i){var n=t("../core/core.js");e.exports={_scenes:{},_current:null,scene:function(t,e,i){if(arguments.length===1||typeof arguments[1]!=="function"){n.enterScene(t,arguments[1]);return}n.defineScene(t,e,i)},defineScene:function(t,e,i){if(typeof e!=="function")throw"Init function is the wrong type.";this._scenes[t]={};this._scenes[t].initialize=e;if(typeof i!=="undefined"){this._scenes[t].uninitialize=i}return},enterScene:function(t,e){if(typeof e==="function")throw"Scene data cannot be a function";n.trigger("SceneDestroy",{newScene:t});n.viewport.reset();n("2D").each(function(){if(!this.has("Persist"))this.destroy()});if(this._current!==null&&"uninitialize"in this._scenes[this._current]){this._scenes[this._current].uninitialize.call(this)}var i=this._current;this._current=t;n.trigger("SceneChange",{oldScene:i,newScene:t});if(this._scenes.hasOwnProperty(t)){this._scenes[t].initialize.call(this,e)}else{n.error('The scene "'+t+'" does not exist')}return}}},{"../core/core.js":41}],46:[function(t,e,i){var n=t("../core/core.js");try{var r=typeof window!=="undefined"&&window.localStorage||new t("node-localstorage").LocalStorage("./localStorage")}catch(s){var r=null}var o=function(t,e){var i=e;if(!r){n.error("Local storage is not accessible.  (Perhaps you are including crafty.js cross-domain?)");return false}if(arguments.length===1){try{return JSON.parse(r.getItem(t))}catch(s){return r.getItem(t)}}else{if(typeof e==="object"){i=JSON.stringify(e)}r.setItem(t,i)}};o.remove=function(t){if(!r){n.error("Local storage is not accessible.  (Perhaps you are including crafty.js cross-domain?)");return}r.removeItem(t)};e.exports=o},{"../core/core.js":41}],47:[function(t,e,i){var n=t("../core/core.js");n._systems={};n.s=function(t,e,i){if(e){if(i===false){n._systems[t]=new n.CraftySystem(t,e);n.trigger("SystemLoaded",t)}else{n._registerLazySystem(t,e)}}else{return n._systems[t]}};n._registerLazySystem=function(t,e){Object.defineProperty(n._systems,t,{get:function(){Object.defineProperty(n._systems,t,{value:new n.CraftySystem(t,e),writable:true,enumerable:true,configurable:true});n.trigger("SystemLoaded",t);return n._systems[t]},configurable:true})};n.CraftySystem=function(){systemID=1;return function(t,e){this.name=t;if(!e)return this;this._systemTemplate=e;this.extend(e);n._addCallbackMethods(this);this[0]="system"+systemID++;if(typeof this.init==="function"){this.init(t)}if("events"in e){var i=e.events;for(var r in i){var s=typeof i[r]==="function"?i[r]:e[i[r]];this.bind(r,s)}}}}();n.CraftySystem.prototype={extend:function(t){for(var e in t){if(typeof this[e]==="undefined"){this[e]=t[e]}}},bind:function(t,e){this._bindCallback(t,e);return this},trigger:function(t,e){this._runCallbacks(t,e);return this},unbind:function(t,e){this._unbindCallbacks(t,e);return this},one:function(t,e){var i=this;var n=function(r){e.call(i,r);i.unbind(t,n)};return i.bind(t,n)},uniqueBind:function(t,e){this.unbind(t,e);return this.bind(t,e)},destroy:function(){n.trigger("SystemDestroyed",this);if(typeof this.remove==="function"){this.remove()}this._unbindAll();delete n._systems[this.name]}}},{"../core/core.js":41}],48:[function(t,e,i){e.exports={init:function(){this._delays=[];this.bind("EnterFrame",function(t){var e=this._delays.length;while(--e>=0){var i=this._delays[e];if(i===false){this._delays.splice(e,1)}else{i.accumulator+=t.dt;while(i.accumulator>=i.delay&&i.repeat>=0){i.accumulator-=i.delay;i.repeat--;i.callback.call(this)}if(i.repeat<0){this._delays.splice(e,1);if(typeof i.callbackOff==="function")i.callbackOff.call(this)}}}})},delay:function(t,e,i,n){this._delays.push({accumulator:0,callback:t,callbackOff:n,delay:e,repeat:(i<0?Infinity:i)||0});return this},cancelDelay:function(t){var e=this._delays.length;while(--e>=0){var i=this._delays[e];if(i&&i.callback==t){this._delays[e]=false}}return this}}},{}],49:[function(t,e,i){e.exports={init:function(){this.tweenGroup={};this.tweenStart={};this.tweens=[];this.uniqueBind("EnterFrame",this._tweenTick)},_tweenTick:function(t){var e,i,n;for(n=this.tweens.length-1;n>=0;n--){e=this.tweens[n];e.easing.tick(t.dt);i=e.easing.value();this._doTween(e.props,i);if(e.easing.complete){this.tweens.splice(n,1);this._endTween(e.props)}}},_doTween:function(t,e){for(var i in t)this[i]=(1-e)*this.tweenStart[i]+e*t[i]},tween:function(t,e,i){var n={props:t,easing:new Crafty.easing(e,i)};for(var r in t){if(typeof this.tweenGroup[r]!=="undefined")this.cancelTween(r);this.tweenStart[r]=this[r];this.tweenGroup[r]=t}this.tweens.push(n);return this},cancelTween:function(t){if(typeof t==="string"){if(typeof this.tweenGroup[t]=="object")delete this.tweenGroup[t][t]}else if(typeof t==="object"){for(var e in t)this.cancelTween(e)}return this},pauseTweens:function(){this.tweens.map(function(t){t.easing.pause()})},resumeTweens:function(){this.tweens.map(function(t){t.easing.resume()})},_endTween:function(t){for(var e in t){delete this.tweenGroup[e]}this.trigger("TweenEnd",t)}}},{}],50:[function(t,e,i){e.exports="0.7.1"},{}],51:[function(t,e,i){var n=t("./core/core");n.easing=t("./core/animation");n.extend(t("./core/extensions"));n.extend(t("./core/loader"));n.c("Model",t("./core/model"));n.extend(t("./core/scenes"));n.storage=t("./core/storage");n.c("Delay",t("./core/time"));n.c("Tween",t("./core/tween"));t("./core/systems");t("./spatial/2d");t("./spatial/collision");t("./spatial/spatial-grid");t("./spatial/rect-manager");t("./spatial/math");t("./graphics/canvas");t("./graphics/canvas-layer");t("./graphics/color");t("./graphics/dom");t("./graphics/dom-helper");t("./graphics/dom-layer");t("./graphics/drawing");t("./graphics/gl-textures");t("./graphics/html");t("./graphics/image");t("./graphics/particles");t("./graphics/sprite-animation");t("./graphics/sprite");t("./graphics/text");t("./graphics/viewport");t("./graphics/webgl");t("./isometric/diamond-iso");t("./isometric/isometric");t("./controls/inputs");t("./controls/controls");t("./controls/device");t("./controls/keycodes");t("./sound/sound");t("./debug/debug-layer");t("./debug/logging");if(window)window.Crafty=n;e.exports=n},{"./controls/controls":36,"./controls/device":37,"./controls/inputs":38,"./controls/keycodes":39,"./core/animation":40,"./core/core":41,"./core/extensions":42,"./core/loader":43,"./core/model":44,"./core/scenes":45,"./core/storage":46,"./core/systems":47,"./core/time":48,"./core/tween":49,"./debug/debug-layer":52,"./debug/logging":53,"./graphics/canvas":55,"./graphics/canvas-layer":54,"./graphics/color":56,"./graphics/dom":59,"./graphics/dom-helper":57,"./graphics/dom-layer":58,"./graphics/drawing":60,"./graphics/gl-textures":61,"./graphics/html":62,"./graphics/image":63,"./graphics/particles":64,"./graphics/sprite":66,"./graphics/sprite-animation":65,"./graphics/text":67,"./graphics/viewport":68,"./graphics/webgl":69,"./isometric/diamond-iso":70,"./isometric/isometric":71,"./sound/sound":72,"./spatial/2d":73,"./spatial/collision":74,"./spatial/math":75,"./spatial/rect-manager":76,"./spatial/spatial-grid":77}],52:[function(t,e,i){var n=t("../core/core.js"),r=window.document;n.c("DebugCanvas",{init:function(){this.requires("2D");if(!n.DebugCanvas.context)n.DebugCanvas.init();n.DebugCanvas.add(this);this._debug={alpha:1,lineWidth:1};this.bind("RemoveComponent",this.onDebugRemove);this.bind("Remove",this.onDebugDestroy)},onDebugRemove:function(t){if(t==="DebugCanvas"){n.DebugCanvas.remove(this)}},onDebugDestroy:function(t){n.DebugCanvas.remove(this)},debugAlpha:function(t){this._debug.alpha=t;return this},debugFill:function(t){if(typeof t==="undefined")t="red";this._debug.fillStyle=t;return this},debugStroke:function(t){if(typeof t==="undefined")t="red";this._debug.strokeStyle=t;return this},debugDraw:function(t){var e=t.globalAlpha;var i=this._debug;if(i.alpha)t.globalAlpha=this._debug.alpha;if(i.strokeStyle)t.strokeStyle=i.strokeStyle;if(i.lineWidth)t.lineWidth=i.lineWidth;if(i.fillStyle)t.fillStyle=i.fillStyle;this.trigger("DebugDraw");t.globalAlpha=e}});n.c("DebugRectangle",{init:function(){this.requires("2D, DebugCanvas")},debugRectangle:function(t){this.debugRect=t;this.unbind("DebugDraw",this.drawDebugRect);this.bind("DebugDraw",this.drawDebugRect);return this},drawDebugRect:function(){var t=n.DebugCanvas.context;var e=this.debugRect;if(e===null||e===undefined)return;if(e._h&&e._w){if(this._debug.fillStyle)t.fillRect(e._x,e._y,e._w,e._h);if(this._debug.strokeStyle)t.strokeRect(e._x,e._y,e._w,e._h)}}});n.c("VisibleMBR",{init:function(){this.requires("DebugRectangle").debugFill("purple").bind("EnterFrame",this._assignRect)},_assignRect:function(){if(this._mbr)this.debugRectangle(this._mbr);else this.debugRectangle(this)}});n.c("DebugPolygon",{init:function(){this.requires("2D, DebugCanvas")},debugPolygon:function(t){this.polygon=t;this.unbind("DebugDraw",this.drawDebugPolygon);this.bind("DebugDraw",this.drawDebugPolygon);return this},drawDebugPolygon:function(){if(typeof this.polygon==="undefined")return;var t=n.DebugCanvas.context;t.beginPath();var e=this.polygon.points,i=e.length;for(var r=0;r<i;r+=2){t.lineTo(e[r],e[r+1])}t.closePath();if(this._debug.fillStyle)t.fill();if(this._debug.strokeStyle)t.stroke()}});n.c("WiredHitBox",{init:function(){this.requires("DebugPolygon").debugStroke("red").matchHitBox();this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}});n.c("SolidHitBox",{init:function(){this.requires("Collision, DebugPolygon").debugFill("orange").debugAlpha(.7).matchHitBox();this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}});n.c("WiredAreaMap",{init:function(){this.requires("DebugPolygon").debugStroke("green").matchAreaMap();this.bind("NewAreaMap",this.matchAreaMap)},matchAreaMap:function(){this.debugPolygon(this.mapArea)}});n.c("SolidAreaMap",{init:function(){this.requires("DebugPolygon").debugFill("lime").debugAlpha(.7).matchAreaMap();this.bind("NewAreaMap",this.matchAreaMap)},matchAreaMap:function(){this.debugPolygon(this.mapArea)}});n.DebugCanvas={context:null,entities:[],onetimeEntities:[],add:function(t){this.entities.push(t)},remove:function(t){var e=this.entities;for(var i=e.length-1;i>=0;i--)if(e[i]==t)e.splice(i,1)},init:function(){if(!n.DebugCanvas.context){if(!n.support.canvas){n.trigger("NoCanvas");n.stop();return}var t;t=r.createElement("canvas");t.width=n.viewport.width;t.height=n.viewport.height;t.style.position="absolute";t.style.left="0px";t.style.top="0px";t.id="debug-canvas";t.style.zIndex=1e5;n.stage.elem.appendChild(t);n.DebugCanvas.context=t.getContext("2d");n.DebugCanvas._canvas=t}n.unbind("RenderScene",n.DebugCanvas.renderScene);n.bind("RenderScene",n.DebugCanvas.renderScene)},renderScene:function(t){t=t||n.viewport.rect();var e=n.DebugCanvas.entities,i=0,r=e.length,s=n.DebugCanvas.context,o;var a=n.viewport;s.setTransform(a._scale,0,0,a._scale,Math.round(a._x*a._scale),Math.round(a._y*a._scale));s.clearRect(t._x,t._y,t._w,t._h);for(;i<r;i++){o=e[i];o.debugDraw(s)}}}},{"../core/core.js":41}],53:[function(t,e,i){var n=t("../core/core.js");n.extend({loggingEnabled:true,log:function(){if(n.loggingEnabled&&console&&console.log){console.log.apply(console,arguments)}},error:function(){if(n.loggingEnabled&&console&&console.error){console.error.apply(console,arguments)}}})},{"../core/core.js":41}],54:[function(t,e,i){var n=t("../core/core.js");n.extend({canvasLayer:{_dirtyRects:[],_changedObjs:[],layerCount:0,_dirtyViewport:false,_sort:function(t,e){return t._globalZ-e._globalZ},add:function r(t){this._changedObjs.push(t)},context:null,_canvas:null,init:function(){if(!n.support.canvas){n.trigger("NoCanvas");n.stop();return}this._dirtyRects=[];this._changedObjs=[];this.layerCount=0;var t;t=document.createElement("canvas");t.width=n.viewport.width;t.height=n.viewport.height;t.style.position="absolute";t.style.left="0px";t.style.top="0px";var e=n.canvasLayer;n.stage.elem.appendChild(t);this.context=t.getContext("2d");this._canvas=t;var i=n.viewport._scale;if(i!=1)t.scale(i,i);this._setPixelart(n._pixelartEnabled);n.uniqueBind("PixelartSet",this._setPixelart);n.uniqueBind("RenderScene",this._render);n.uniqueBind("ViewportResize",this._resize);n.bind("InvalidateViewport",function(){n.canvasLayer._dirtyViewport=true})},_render:function(){var t=n.canvasLayer,e=t._dirtyViewport,i=t._changedObjs.length,r=t.context;if(!i&&!e){return}if(e){var s=n.viewport;r.setTransform(s._scale,0,0,s._scale,Math.round(s._x*s._scale),Math.round(s._y*s._scale))}if(i/t.layerCount>.6||e){t._drawAll()}else{t._drawDirty()}t._clean()},_drawDirty:function(){var t,e,i,r,s,o,a,u=this._changedObjs,h=u.length,c=this._dirtyRects,f=n.rectManager,l=f.overlap,d=this.context,p=[],g=[];for(t=0;t<h;t++){this._createDirty(u[t])}f.mergeSet(c);h=c.length;for(t=0;t<h;++t){r=c[t];p.length=0;g.length=0;if(!r)continue;r._w=r._x+r._w;r._h=r._y+r._h;r._x=r._x>0?r._x|0:(r._x|0)-1;r._y=r._y>0?r._y|0:(r._y|0)-1;r._w-=r._x;r._h-=r._y;r._w=r._w===(r._w|0)?r._w:(r._w|0)+1;r._h=r._h===(r._h|0)?r._h:(r._h|0)+1;i=n.map.search(r,false);d.clearRect(r._x,r._y,r._w,r._h);d.save();d.beginPath();d.rect(r._x,r._y,r._w,r._h);d.clip();for(e=0,s=i.length;e<s;++e){o=i[e];if(p[o[0]]||!o._visible||!o.__c.Canvas)continue;p[o[0]]=true;g.push(o)}g.sort(this._sort);for(e=0,s=g.length;e<s;++e){o=g[e];var v=o._mbr||o;if(l(v,r))o.draw();o._changed=false}d.closePath();d.restore()}if(n.canvasLayer.debugDirty===true){d.strokeStyle="red";for(t=0,h=c.length;t<h;++t){r=c[t];d.strokeRect(r._x,r._y,r._w,r._h)}}},_drawAll:function(t){t=t||n.viewport.rect();var e=n.map.search(t),i=0,r=e.length,s=this.context,o;s.clearRect(t._x,t._y,t._w,t._h);e.sort(this._sort);for(;i<r;i++){o=e[i];if(o._visible&&o.__c.Canvas){o.draw();o._changed=false}}},debug:function(){n.log(this._changedObjs)},_clean:function(){var t,e,i,n,r=this._changedObjs;for(i=0,n=r.length;i<n;i++){e=r[i];t=e._mbr||e;if(typeof e.staleRect==="undefined")e.staleRect={};e.staleRect._x=t._x;e.staleRect._y=t._y;e.staleRect._w=t._w;e.staleRect._h=t._h;e._changed=false}r.length=0;this._dirtyRects.length=0;this._dirtyViewport=false},_createDirty:function(t){var e=t._mbr||t,i=this._dirtyRects,r=n.rectManager;if(t.staleRect){if(r.overlap(t.staleRect,e)){r.merge(t.staleRect,e,t.staleRect);i.push(t.staleRect);return}else{i.push(t.staleRect)}}t.currentRect._x=e._x;t.currentRect._y=e._y;t.currentRect._w=e._w;t.currentRect._h=e._h;i.push(t.currentRect)},_resize:function(){var t=n.canvasLayer._canvas;t.width=n.viewport.width;t.height=n.viewport.height},_setPixelart:function(t){var e=n.canvasLayer.context;e.imageSmoothingEnabled=!t;e.mozImageSmoothingEnabled=!t;e.webkitImageSmoothingEnabled=!t;e.oImageSmoothingEnabled=!t;e.msImageSmoothingEnabled=!t}}})},{"../core/core.js":41}],55:[function(t,e,i){var n=t("../core/core.js");n.c("Canvas",{init:function(){var t=n.canvasLayer;if(!t.context){t.init()}this._drawLayer=t;this._drawContext=t.context;t.layerCount++;this.currentRect={};this._changed=true;t.add(this);this.bind("Invalidate",function(e){if(this._changed===false){this._changed=true;t.add(this)}});this.bind("Remove",function(){this._drawLayer.layerCount--;this._changed=true;this._drawLayer.add(this)})},drawVars:{type:"canvas",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(t,e,i,n,r){if(!this.ready)return;if(arguments.length===4){r=n;n=i;i=e;e=t;t=this._drawContext}var s=this.drawVars.pos;s._x=this._x+(e||0);s._y=this._y+(i||0);s._w=n||this._w;s._h=r||this._h;context=t||this._drawContext;coord=this.__coord||[0,0,0,0];var o=this.drawVars.co;o.x=coord[0]+(e||0);o.y=coord[1]+(i||0);o.w=n||coord[2];o.h=r||coord[3];if(this._flipX||(this._flipY||this._rotation)){context.save()}if(this._rotation!==0){context.translate(this._origin.x+this._x,this._origin.y+this._y);s._x=-this._origin.x;s._y=-this._origin.y;context.rotate(this._rotation%360*(Math.PI/180))}if(this._flipX||this._flipY){context.scale(this._flipX?-1:1,this._flipY?-1:1);if(this._flipX){s._x=-(s._x+s._w)}if(this._flipY){s._y=-(s._y+s._h)}}var a;if(this._alpha<1){a=context.globalAlpha;context.globalAlpha=this._alpha}this.drawVars.ctx=context;this.trigger("Draw",this.drawVars);if(this._rotation!==0||(this._flipX||this._flipY)){context.restore()}if(a){context.globalAlpha=a}return this}})},{"../core/core.js":41}],56:[function(t,e,i){var n=t("../core/core.js"),r=window.document;n.extend({assignColor:function(){var t=r.createElement("div");t.style.display="none";var e=false;var i={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#00ff00",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"};function n(t){t._red=t._blue=t._green=0;return t}function s(t){var e=t.toString(16);if(e.length==1)e="0"+e;return e}function o(t,e,i){return"#"+s(t)+s(e)+s(i)}function a(t,e){var i;if(t.length===7){i=2}else if(t.length===4){i=1}else{return n(e)}e._red=parseInt(t.substr(1,i),16);e._green=parseInt(t.substr(1+i,i),16);e._blue=parseInt(t.substr(1+2*i,i),16);return e}var u=/rgba?\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,?\s*([0-9.]+)?\)/;function h(t,e){var i=u.exec(t);if(i===null||i.length!=4&&i.length!=5){return n(e)}e._red=Math.round(parseFloat(i[1]));e._green=Math.round(parseFloat(i[2]));e._blue=Math.round(parseFloat(i[3]));if(i[4]){e._strength=parseFloat(i[4])}return e}function c(n,r){if(typeof i[n]==="undefined"){if(e===false){window.document.body.appendChild(t);e=true}t.style.color=n;var s=window.getComputedStyle(t).color;h(s,r);i[n]=o(r._red,r._green,r._blue)}else{a(i[n],r)}return r}function f(t){return"rgba("+t._red+", "+t._green+", "+t._blue+", "+t._strength+")"}return function(t,e){e=e||{};t=t.trim().toLowerCase();var i=null;if(t[0]==="#"){i=a(t,e)}else if(t[0]==="r"&&t[1]==="g"&&t[2]==="b"){i=h(t,e)}else{i=c(t,e)}e._strength=e._strength||1;e._color=f(e)}}()});var s=t("fs");var o="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec4 aColor;\n\nvarying lowp vec4 vColor;\n\nuniform  vec4 uViewport;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vColor = vec4(aColor.rgb*aColor.a*aLayer.y, aColor.a*aLayer.y);\n}";var a="precision mediump float;\nvarying lowp vec4 vColor;\nvoid main(void) {\n	gl_FragColor = vColor;\n}";var u=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aColor",width:4}];n.c("Color",{_red:0,_green:0,_blue:0,_strength:1,_color:"",ready:true,init:function(){this.bind("Draw",this._drawColor);if(this.has("WebGL")){this._establishShader("Color",a,o,u)}this.trigger("Invalidate")},remove:function(){this.unbind("Draw",this._drawColor);if(this.has("DOM")){this._element.style.backgroundColor="transparent"}this.trigger("Invalidate")},_drawColor:function(t){if(!this._color){return}if(t.type==="DOM"){t.style.backgroundColor=this._color;t.style.lineHeight=0}else if(t.type==="canvas"){t.ctx.fillStyle=this._color;t.ctx.fillRect(t.pos._x,t.pos._y,t.pos._w,t.pos._h)}else if(t.type==="webgl"){t.program.writeVector("aColor",this._red/255,this._green/255,this._blue/255,this._strength)}},color:function(t){if(arguments.length===0){return this._color}else if(arguments.length>=3){this._red=arguments[0];this._green=arguments[1];this._blue=arguments[2];if(typeof arguments[3]==="number")this._strength=arguments[3]}else{n.assignColor(t,this);if(typeof arguments[1]=="number")this._strength=arguments[1]}this._color="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")";this.trigger("Invalidate");return this}})},{"../core/core.js":41,fs:5}],57:[function(t,e,i){var n=t("../core/core.js"),r=window.document;n.extend({domHelper:{innerPosition:function(t){var e=t.getBoundingClientRect(),i=e.left+(window.pageXOffset?window.pageXOffset:r.body.scrollLeft),n=e.top+(window.pageYOffset?window.pageYOffset:r.body.scrollTop),s=parseInt(this.getStyle(t,"border-left-width")||0,10)||parseInt(this.getStyle(t,"borderLeftWidth")||0,10)||0,o=parseInt(this.getStyle(t,"border-top-width")||0,10)||parseInt(this.getStyle(t,"borderTopWidth")||0,10)||0;i+=s;n+=o;return{x:i,y:n}},getStyle:function(t,e){var i;if(t.currentStyle)i=t.currentStyle[this.camelize(e)];else if(window.getComputedStyle)i=r.defaultView.getComputedStyle(t,null).getPropertyValue(this.csselize(e));return i},camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},csselize:function(t){return t.replace(/[A-Z]/g,function(t){return t?"-"+t.toLowerCase():""})},translate:function(t,e){var i=r.documentElement;var s=r.body;return{x:(t-n.stage.x+(i&&i.scrollLeft||s&&s.scrollLeft||0))/n.viewport._scale-n.viewport._x,y:(e-n.stage.y+(i&&i.scrollTop||s&&s.scrollTop||0))/n.viewport._scale-n.viewport._y}}}})},{"../core/core.js":41}],58:[function(t,e,i){var n=t("../core/core.js"),r=window.document;n.extend({domLayer:{_changedObjs:[],_dirtyViewport:false,_div:null,init:function(){this._changedObjs=[];this._dirtyViewport=false;var t=this._div=r.createElement("div");n.stage.elem.appendChild(t);t.style.position="absolute";t.style.zIndex="1";t.style.transformStyle="preserve-3d";n.uniqueBind("RenderScene",this._render);n.uniqueBind("PixelartSet",this._setPixelArt);n.uniqueBind("InvalidateViewport",function(){n.domLayer._dirtyViewport=true})},_setPixelArt:function(t){var e=n.domLayer._div.style;var i=n.domHelper.camelize;if(t){e[i("image-rendering")]="optimizeSpeed";e[i("image-rendering")]="-moz-crisp-edges";e[i("image-rendering")]="-o-crisp-edges";e[i("image-rendering")]="-webkit-optimize-contrast";e[i("-ms-interpolation-mode")]="nearest-neighbor";e[i("image-rendering")]="optimize-contrast";e[i("image-rendering")]="pixelated";e[i("image-rendering")]="crisp-edges"}else{e[i("image-rendering")]="optimizeQuality";e[i("-ms-interpolation-mode")]="bicubic";e[i("image-rendering")]="auto"}},debug:function(){n.log(this._changedObjs)},_render:function(){var t=n.domLayer;var e=t._changedObjs;if(t._dirtyViewport){t._setViewport();t._dirtyViewport=false}if(!e.length)return;var i=0,r=e.length;for(;i<r;++i){e[i].draw()._changed=false}e.length=0},add:function s(t){this._changedObjs.push(t)},_setViewport:function(){var t=n.domLayer._div.style,e=n.viewport;t.transform=t[n.support.prefix+"Transform"]="scale("+e._scale+", "+e._scale+")";t.left=Math.round(e._x*e._scale)+"px";t.top=Math.round(e._y*e._scale)+"px";t.zIndex=10}}})},{"../core/core.js":41}],59:[function(t,e,i){var n=t("../core/core.js"),r=window.document;n.c("DOM",{_element:null,_cssStyles:null,avoidCss3dTransforms:false,init:function(){var t=n.domLayer;if(!t._div){t.init()}this._drawLayer=t;this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""};this._element=r.createElement("div");t._div.appendChild(this._element);this._element.style.position="absolute";this._element.id="ent"+this[0];this.bind("Invalidate",this._invalidateDOM);this.bind("NewComponent",this._updateClass);this.bind("RemoveComponent",this._removeClass);this._invalidateDOM()},remove:function(){this.undraw();this.unbind("NewComponent",this._updateClass);this.unbind("RemoveComponent",this._removeClass);this.unbind("Invalidate",this._invalidateDOM)},getDomId:function(){return this._element.id},_removeClass:function(t){var e=0,i=this.__c,n="";for(e in i){if(e!=t){n+=" "+e}}n=n.substr(1);this._element.className=n},_updateClass:function(){var t=0,e=this.__c,i="";for(t in e){i+=" "+t}i=i.substr(1);this._element.className=i},_invalidateDOM:function(){if(!this._changed){this._changed=true;this._drawLayer.add(this)}},DOM:function(t){if(t&&t.nodeType){this.undraw();this._element=t;this._element.style.position="absolute"}return this},draw:function(){var t=this._element.style,e=this.__coord||[0,0,0,0],i={x:e[0],y:e[1],w:e[2],h:e[3]},r=n.support.prefix,s=[];if(this._cssStyles.visibility!==this._visible){this._cssStyles.visibility=this._visible;if(!this._visible){t.visibility="hidden"}else{t.visibility="visible"}}if(n.support.css3dtransform&&!this.avoidCss3dTransforms){s.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)")}else{if(this._cssStyles.left!==this._x){this._cssStyles.left=this._x;t.left=~~this._x+"px"}if(this._cssStyles.top!==this._y){this._cssStyles.top=this._y;t.top=~~this._y+"px"}}if(this._cssStyles.width!==this._w){this._cssStyles.width=this._w;t.width=~~this._w+"px"}if(this._cssStyles.height!==this._h){this._cssStyles.height=this._h;t.height=~~this._h+"px"}if(this._cssStyles.zIndex!==this._z){this._cssStyles.zIndex=this._z;t.zIndex=this._z}if(this._cssStyles.opacity!==this._alpha){this._cssStyles.opacity=this._alpha;t.opacity=this._alpha;t[r+"Opacity"]=this._alpha}if(this._mbr){var o=this._origin.x+"px "+this._origin.y+"px";t.transformOrigin=o;t[r+"TransformOrigin"]=o;if(n.support.css3dtransform)s.push("rotateZ("+this._rotation+"deg)");else s.push("rotate("+this._rotation+"deg)")}if(this._flipX){s.push("scaleX(-1)")}if(this._flipY){s.push("scaleY(-1)")}if(this._cssStyles.transform!=s.join(" ")){this._cssStyles.transform=s.join(" ");t.transform=this._cssStyles.transform;t[r+"Transform"]=this._cssStyles.transform}this.trigger("Draw",{style:t,type:"DOM",co:i});return this},undraw:function(){var t=this._element;if(t&&t.parentNode!==null){t.parentNode.removeChild(t)}return this},css:function(t,e){var i,r=this._element,s,o=r.style;if(typeof t==="object"){for(i in t){if(!t.hasOwnProperty(i))continue;s=t[i];if(typeof s==="number")s+="px";o[n.domHelper.camelize(i)]=s}}else{if(e){if(typeof e==="number")e+="px";o[n.domHelper.camelize(t)]=e}else{return n.domHelper.getStyle(r,t)}}this.trigger("Invalidate");return this}})},{"../core/core.js":41}],60:[function(t,e,i){var n=t("../core/core.js");n.extend({_pixelartEnabled:false,pixelart:function(t){n._pixelartEnabled=t;n.trigger("PixelartSet",t)}})},{"../core/core.js":41}],61:[function(t,e,i){var n=t("../core/core.js");var r=n.TextureManager=function(t,e){this.gl=t;this.webgl=e;this.max_units=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);this.bound_textures=[];this.registered_textures={};this.active=null};r.prototype={reset:function(){var t;for(var e=0;e<this.bound_textures.length;e++){t=this.bound_textures[e];t.unbind()}this.bound_textures=[];this.active=null},makeTexture:function(t,e,i){var n=this.gl,r=this.webgl;var o="texture-(r:"+i+")-"+t;if(typeof this.registered_textures[o]!=="undefined")return this.registered_textures[o];var a=new s(this,o);this.registered_textures[o]=a;this.bindTexture(a);a.setImage(e);a.setFilter(r.texture_filter);a.setRepeat(i);return a},smallest:function(){var t=Infinity;var e=null;for(var i=0;i<this.bound_textures.length;i++){var n=this.bound_textures[i];if(n.size<t){t=n.size;e=i}}return e},getAvailableUnit:function(){if(this.bound_textures.length<this.max_units){return this.bound_textures.length}else{return this.smallest()}},bindTexture:function(t){if(t.unit!==null)return;var e=this.getAvailableUnit();if(this.bound_textures[e]){this.unbindTexture(this.bound_textures[e])}this.bound_textures[e]=t;t.bind(e)},unbindTexture:function(t){t.unbind()},setActiveTexture:function(t){if(this.active===t.id)return;this.gl.activeTexture(this.gl[t.name]);this.active=t.unit}};var s=n.TextureWrapper=function(t,e){this.manager=t;this.gl=t.gl;this.glTexture=this.gl.createTexture();this.id=e;this.active=false;this.unit=null;this.powerOfTwo=false};s.prototype={bind:function(t){var e=this.gl;this.unit=t;this.name="TEXTURE"+t;this.manager.setActiveTexture(this);e.bindTexture(e.TEXTURE_2D,this.glTexture)},isActive:function(){return this.manager.active===this.unit},unbind:function(){this.unit=null;this.name=null;if(this.isActive())this.manager.active=null},setImage:function(t){if(!this.isActive())throw"Trying to set image of texture that isn't active";this.width=t.width;this.height=t.height;this.size=t.width*t.height;this.powerOfTwo=!(Math.log(t.width)/Math.LN2!=Math.floor(Math.log(t.width)/Math.LN2)||Math.log(t.height)/Math.LN2!=Math.floor(Math.log(t.height)/Math.LN2));var e=this.gl;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)},setFilter:function(t){if(!this.isActive())throw"Trying to set filter of texture that isn't active";var e=this.gl;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t)},setRepeat:function(t){if(!this.isActive())throw"Trying to set repeat property of texture that isn't active";if(t&&!this.powerOfTwo){throw"Can't create a repeating image whose dimensions aren't a power of 2 in WebGL contexts"}var e=this.gl;this.repeatMode=t?e.REPEAT:e.CLAMP_TO_EDGE;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.repeatMode);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.repeatMode)},setToProgram:function(t,e,i){if(this.unit===null)throw"Trying to use texture not set to a texture unit.";var n=this.gl;n.useProgram(t);n.uniform1i(n.getUniformLocation(t,e),this.unit);n.uniform2f(n.getUniformLocation(t,i),this.width,this.height)}}},{"../core/core.js":41}],62:[function(t,e,i){var n=t("../core/core.js");n.c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(t){this.inner=t;this._element.innerHTML=t;return this},append:function(t){this.inner+=t;this._element.innerHTML+=t;return this},prepend:function(t){this.inner=t+this.inner;this._element.innerHTML=t+this.inner;return this}})},{"../core/core.js":41}],63:[function(t,e,i){var n=t("../core/core.js");var r=t("fs");var s="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\n\nvarying mediump vec3 vTextureCoord;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n  \n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n}";

var o="varying mediump vec3 vTextureCoord;\n  \nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 base_color = texture2D(uSampler, coord);\n  gl_FragColor = vec4(base_color.rgb*base_color.a*vTextureCoord.z, base_color.a*vTextureCoord.z);\n}";var a=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2}];n.c("Image",{_repeat:"repeat",ready:false,init:function(){this.bind("Draw",this._drawImage)},remove:function(){this.unbind("Draw",this._drawImage)},image:function(t,e){this.__image=t;this._repeat=e||"no-repeat";this.img=n.asset(t);if(!this.img){this.img=new Image;n.asset(t,this.img);this.img.src=t;var i=this;this.img.onload=function(){i._onImageLoad()}}else{this._onImageLoad()}this.trigger("Invalidate");return this},_onImageLoad:function(){if(this.has("Canvas")){this._pattern=this._drawContext.createPattern(this.img,this._repeat)}else if(this.has("WebGL")){this._establishShader("image:"+this.__image,o,s,a);this.program.setTexture(this.webgl.makeTexture(this.__image,this.img,this._repeat!=="no-repeat"))}if(this._repeat==="no-repeat"){this.w=this.w||this.img.width;this.h=this.h||this.img.height}this.ready=true;this.trigger("Invalidate")},_drawImage:function(t){if(t.type==="canvas"){if(!this.ready||!this._pattern)return;var e=t.ctx;e.fillStyle=this._pattern;e.save();e.translate(t.pos._x,t.pos._y);e.fillRect(0,0,t.pos._w,t.pos._h);e.restore()}else if(t.type==="DOM"){if(this.__image){t.style.backgroundImage="url("+this.__image+")";t.style.backgroundRepeat=this._repeat}}else if(t.type==="webgl"){var i=t.pos;t.program.writeVector("aTextureCoord",0,0,0,i._h,i._w,0,i._w,i._h)}}})},{"../core/core.js":41,fs:5}],64:[function(t,e,i){var n=t("../core/core.js"),r=window.document;n.c("Particles",{init:function(){this._Particles=n.clone(this._Particles);this._Particles.parentEntity=this},particles:function(t){if(!n.support.canvas||n.deactivateParticles)return this;var e,i,s,o,a;e=r.createElement("canvas");e.width=n.viewport.width;e.height=n.viewport.height;e.style.position="absolute";e.style.left="0px";e.style.top="0px";n.stage.elem.appendChild(e);i=e.getContext("2d");this._Particles.init(t);this.bind("Remove",function(){n.stage.elem.removeChild(e)}).bind("RemoveComponent",function(t){if(t==="particles")n.stage.elem.removeChild(e)});s=this.x+n.viewport.x;o=this.y+n.viewport.y;this._Particles.position=this._Particles.vectorHelpers.create(s,o);var u={x:n.viewport.x,y:n.viewport.y};this.bind("EnterFrame",function(){s=this.x+n.viewport.x;o=this.y+n.viewport.y;this._Particles.viewportDelta={x:n.viewport.x-u.x,y:n.viewport.y-u.y};u={x:n.viewport.x,y:n.viewport.y};this._Particles.position=this._Particles.vectorHelpers.create(s,o);if(typeof n.rectManager.boundingRect=="function"){a=n.rectManager.boundingRect(this._Particles.register);if(a)i.clearRect(a._x,a._y,a._w,a._h)}else{i.clearRect(0,0,n.viewport.width,n.viewport.height)}this._Particles.update();this._Particles.render(i)});return this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:false,gravity:{x:0,y:.1},jitter:0,originOffset:{x:0,y:0},particles:[],active:true,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(t){this.position=this.vectorHelpers.create(0,0);if(typeof t=="undefined")t={};for(var e in this.presets){if(typeof t[e]!="undefined")this[e]=t[e];else this[e]=this.presets[e]}this.emissionRate=this.maxParticles/this.lifeSpan;this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount==this.maxParticles){return false}var t=new this.particle(this.vectorHelpers);this.initParticle(t);this.particles[this.particleCount]=t;this.particleCount++;return true},RANDM1TO1:function(){return Math.random()*2-1},initParticle:function(t){t.position.x=n.viewport._scale*(this.position.x+this.originOffset.x+this.positionRandom.x*this.RANDM1TO1());t.position.y=n.viewport._scale*(this.position.y+this.originOffset.y+this.positionRandom.y*this.RANDM1TO1());var e=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180);var i=this.vectorHelpers.create(Math.sin(e),-Math.cos(e));var r=this.speed+this.speedRandom*this.RANDM1TO1();t.direction=this.vectorHelpers.multiply(i,r);t.size=n.viewport._scale*(this.size+this.sizeRandom*this.RANDM1TO1());t.size=t.size<0?0:~~t.size;t.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1();t.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1();t.sharpness=t.sharpness>100?100:t.sharpness<0?0:t.sharpness;t.sizeSmall=~~(t.size/200*t.sharpness);var s=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()];var o=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1()];t.colour=s;t.deltaColour[0]=(o[0]-s[0])/t.timeToLive;t.deltaColour[1]=(o[1]-s[1])/t.timeToLive;t.deltaColour[2]=(o[2]-s[2])/t.timeToLive;t.deltaColour[3]=(o[3]-s[3])/t.timeToLive},update:function(){if(this.active&&this.emissionRate>0){var t=1/this.emissionRate;this.emitCounter++;while(this.particleCount<this.maxParticles&&this.emitCounter>t){this.addParticle();this.emitCounter-=t}this.elapsedFrames++;if(this.duration!=-1&&this.duration<this.elapsedFrames){this.stop()}}this.particleIndex=0;this.register=[];var e;while(this.particleIndex<this.particleCount){var i=this.particles[this.particleIndex];if(i.timeToLive>0){i.direction=this.vectorHelpers.add(i.direction,this.gravity);i.position=this.vectorHelpers.add(i.position,i.direction);i.position=this.vectorHelpers.add(i.position,this.viewportDelta);if(this.jitter){i.position.x+=this.jitter*this.RANDM1TO1();i.position.y+=this.jitter*this.RANDM1TO1()}i.timeToLive--;var n=i.colour[0]+=i.deltaColour[0];var r=i.colour[1]+=i.deltaColour[1];var s=i.colour[2]+=i.deltaColour[2];var o=i.colour[3]+=i.deltaColour[3];e=[];e.push("rgba("+(n>255?255:n<0?0:~~n));e.push(r>255?255:r<0?0:~~r);e.push(s>255?255:s<0?0:~~s);e.push((o>1?1:o<0?0:o.toFixed(2))+")");i.drawColour=e.join(",");if(!this.fastMode){e[3]="0)";i.drawColourEnd=e.join(",")}this.particleIndex++}else{if(this.particleIndex!=this.particleCount-1){this.particles[this.particleIndex]=this.particles[this.particleCount-1]}this.particleCount--}var a={};a._x=~~i.position.x;a._y=~~i.position.y;a._w=i.size;a._h=i.size;this.register.push(a)}},stop:function(){this.active=false;this.elapsedFrames=0;this.emitCounter=0;this.parentEntity.trigger("ParticleEnd")},render:function(t){for(var e=0,i=this.particleCount;e<i;e++){var r=this.particles[e];var s=r.size;var o=s>>1;if(r.position.x+s<0||r.position.y+s<0||r.position.x-s>n.viewport.width||r.position.y-s>n.viewport.height){continue}var a=~~r.position.x;var u=~~r.position.y;if(this.fastMode){t.fillStyle=r.drawColour}else{var h=t.createRadialGradient(a+o,u+o,r.sizeSmall,a+o,u+o,o);h.addColorStop(0,r.drawColour);h.addColorStop(.9,r.drawColourEnd);t.fillStyle=h}t.fillRect(a,u,s,s)}},particle:function(t){this.position=t.create(0,0);this.direction=t.create(0,0);this.size=0;this.sizeSmall=0;this.timeToLive=0;this.colour=[];this.drawColour="";this.deltaColour=[];this.sharpness=0},vectorHelpers:{create:function(t,e){return{x:t,y:e}},multiply:function(t,e){t.x*=e;t.y*=e;return t},add:function(t,e){t.x+=e.x;t.y+=e.y;return t}}}})},{"../core/core.js":41}],65:[function(t,e,i){var n=t("../core/core.js");n.c("SpriteAnimation",{_reels:null,_currentReelId:null,_currentReel:null,_isPlaying:false,animationSpeed:1,init:function(){this._reels={}},reel:function(t,e,i,r,s){if(arguments.length===0)return this._currentReelId;if(arguments.length===1&&typeof t==="string"){if(typeof this._reels[t]==="undefined")throw"The specified reel "+t+" is undefined.";this.pauseAnimation();if(this._currentReelId!==t){this._currentReelId=t;this._currentReel=this._reels[t];this._updateSprite();this.trigger("ReelChange",this._currentReel)}return this}var o,a,u;o={id:t,frames:[],currentFrame:0,easing:new n.easing(e),defaultLoops:1};o.duration=o.easing.duration;if(typeof i==="number"){a=i;u=r;if(s>=0){for(;a<i+s;a++){o.frames.push([a,u])}}else{for(;a>i+s;a--){o.frames.push([a,u])}}}else if(arguments.length===3&&typeof i==="object"){o.frames=i}else{throw"Urecognized arguments. Please see the documentation for 'reel(...)'."}this._reels[t]=o;return this},animate:function(t,e){var i;if(typeof t==="string")this.reel(t);var n=this._currentReel;if(typeof n==="undefined"||n===null)throw"No reel is specified, and there is no currently active reel.";this.pauseAnimation();if(typeof e==="undefined")if(typeof t==="number")e=t;else e=1;n.easing.reset();this.loops(e);this._setFrame(0);this.bind("EnterFrame",this._animationTick);this._isPlaying=true;this.trigger("StartAnimation",n);return this},resumeAnimation:function(){if(this._isPlaying===false&&this._currentReel!==null){this.bind("EnterFrame",this._animationTick);this._isPlaying=true;this._currentReel.easing.resume();this.trigger("StartAnimation",this._currentReel)}return this},pauseAnimation:function(){if(this._isPlaying===true){this.unbind("EnterFrame",this._animationTick);this._isPlaying=false;this._reels[this._currentReelId].easing.pause()}return this},resetAnimation:function(){var t=this._currentReel;if(t===null)throw"No active reel to reset.";this.reelPosition(0);t.easing.repeat(t.defaultLoops);return this},loops:function(t){if(arguments.length===0){if(this._currentReel!==null)return this._currentReel.easing.loops;else return 0}if(this._currentReel!==null){if(t<0)t=Infinity;this._currentReel.easing.repeat(t);this._currentReel.defaultLoops=t}return this},reelPosition:function(t){if(this._currentReel===null)throw"No active reel.";if(arguments.length===0)return this._currentReel.currentFrame;var e,i=this._currentReel.frames.length;if(t==="end")t=i-1;if(t<1&&t>0){e=t;t=Math.floor(i*e)}else{if(t!==Math.floor(t))throw"Position "+t+" is invalid.";if(t<0)t=i-1+t;e=t/i}t=Math.min(t,i-1);t=Math.max(t,0);this._setProgress(e);this._setFrame(t);return this},_animationTick:function(t){var e=this._reels[this._currentReelId];e.easing.tick(t.dt*this.animationSpeed);var i=e.easing.value();var n=Math.min(Math.floor(e.frames.length*i),e.frames.length-1);this._setFrame(n);if(e.easing.complete===true){this.pauseAnimation();this.trigger("AnimationEnd",this._currentReel)}},_setFrame:function(t){var e=this._currentReel;if(t===e.currentFrame)return;e.currentFrame=t;this._updateSprite();this.trigger("FrameChange",e)},_updateSprite:function(){var t=this._currentReel;var e=t.frames[t.currentFrame];this.sprite(e[0],e[1])},_setProgress:function(t,e){this._currentReel.easing.setProgress(t,e)},isPlaying:function(t){if(!this._isPlaying)return false;if(!t)return!!this._currentReelId;return this._currentReelId===t},getReel:function(t){if(arguments.length===0){if(!this._currentReelId)return null;t=this._currentReelId}return this._reels[t]}})},{"../core/core.js":41}],66:[function(t,e,i){var n=t("../core/core.js");var r=t("fs");var s="attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\n\nvarying mediump vec3 vTextureCoord;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n  \n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n}";var o="varying mediump vec3 vTextureCoord;\n  \nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 base_color = texture2D(uSampler, coord);\n  gl_FragColor = vec4(base_color.rgb*base_color.a*vTextureCoord.z, base_color.a*vTextureCoord.z);\n}";var a=[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2}];n.extend({sprite:function(t,e,i,r,u,h,c){var f,l,d,p,g,v,_;if(typeof t==="string"){h=u;u=r;r=e;i=t;t=1;e=1}if(typeof e=="string"){h=u;u=r;r=i;i=e;e=t}if(!h&&u)h=u;u=parseInt(u||0,10);h=parseInt(h||0,10);var y=function(){this.ready=true;this.trigger("Invalidate")};_=n.asset(i);if(!_){_=new Image;_.src=i;n.asset(i,_);_.onload=function(){for(var t in r){n(t).each(y)}}}var m=function(){this.requires("2D, Sprite");this.__trim=[0,0,0,0];this.__image=i;this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]];this.__tile=t;this.__tileh=e;this.__padding=[u,h];this.__padBorder=c;this.sprite(this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]);this.img=_;if(this.img.complete&&this.img.width>0){this.ready=true;this.trigger("Invalidate")}this.w=this.__coord[2];this.h=this.__coord[3];if(this.has("WebGL")){this._establishShader(this.__image,o,s,a);this.program.setTexture(this.webgl.makeTexture(this.__image,this.img,false))}};for(f in r){if(!r.hasOwnProperty(f))continue;l=r[f];n.c(f,{ready:false,__coord:[l[0],l[1],l[2]||1,l[3]||1],init:m})}return this}});n.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:false,init:function(){this.__trim=[0,0,0,0];this.bind("Draw",this._drawSprite)},remove:function(){this.unbind("Draw",this._drawSprite)},_drawSprite:function(t){var e=t.co,i=t.pos,n=t.ctx;if(t.type==="canvas"){n.drawImage(this.img,e.x,e.y,e.w,e.h,i._x,i._y,i._w,i._h)}else if(t.type==="DOM"){var r=this._h/e.h,s=this._w/e.w,o=this._element.style,a=o.backgroundColor;if(a==="initial")a="";var u=a+" url('"+this.__image+"') no-repeat";if(u!==o.background){o.background=u}o.backgroundPosition="-"+e.x*s+"px -"+e.y*r+"px";if(r!=1||s!=1){o.backgroundSize=this.img.width*s+"px"+" "+this.img.height*r+"px"}}else if(t.type==="webgl"){t.program.writeVector("aTextureCoord",e.x,e.y,e.x,e.y+e.h,e.x+e.w,e.y,e.x+e.w,e.y+e.h)}},sprite:function(t,e,i,n){this.__coord=this.__coord||[0,0,0,0];this.__coord[0]=t*(this.__tile+this.__padding[0])+(this.__padBorder?this.__padding[0]:0)+this.__trim[0];this.__coord[1]=e*(this.__tileh+this.__padding[1])+(this.__padBorder?this.__padding[1]:0)+this.__trim[1];if(typeof i!=="undefined"&&typeof n!=="undefined"){this.__coord[2]=this.__trim[2]||i*this.__tile||this.__tile;this.__coord[3]=this.__trim[3]||n*this.__tileh||this.__tileh}this.trigger("Invalidate");return this},crop:function(t,e,i,n){var r=this._mbr||this.pos();this.__trim=[];this.__trim[0]=t;this.__trim[1]=e;this.__trim[2]=i;this.__trim[3]=n;this.__coord[0]+=t;this.__coord[1]+=e;this.__coord[2]=i;this.__coord[3]=n;this._w=i;this._h=n;this.trigger("Invalidate",r);return this}})},{"../core/core.js":41,fs:5}],67:[function(t,e,i){var n=t("../core/core.js");n.c("Text",{_text:"",defaultSize:"10px",defaultFamily:"sans-serif",defaultVariant:"normal",defaultLineHeight:"normal",ready:true,init:function(){this.requires("2D");this._textFont={type:"",weight:"",size:this.defaultSize,lineHeight:this.defaultLineHeight,family:this.defaultFamily,variant:this.defaultVariant};this.bind("Draw",function(t){var e=this._fontString();if(t.type==="DOM"){var i=this._element,n=i.style;n.color=this._textColor;n.font=e;i.innerHTML=this._text}else if(t.type==="canvas"){var r=t.ctx;r.save();r.textBaseline="top";r.fillStyle=this._textColor||"rgb(0,0,0)";r.font=e;r.fillText(this._text,t.pos._x,t.pos._y);r.restore()}})},_getFontHeight:function(){var t=/([a-zA-Z]+)\b/;var e={px:1,pt:4/3,pc:16,cm:96/2.54,mm:96/25.4,"in":96,em:undefined,ex:undefined};return function(i){var n=parseFloat(i);var r=t.exec(i);var s=r?r[1]:"px";if(e[s]!==undefined)return Math.ceil(n*e[s]);else return Math.ceil(n)}}(),text:function(t){if(!(typeof t!=="undefined"&&t!==null))return this._text;if(typeof t=="function")this._text=t.call(this);else this._text=t;if(this.has("Canvas"))this._resizeForCanvas();this.trigger("Invalidate");return this},_resizeForCanvas:function(){var t=this._drawContext;t.font=this._fontString();this.w=t.measureText(this._text).width;var e=this._textFont.size||this.defaultSize;this.h=1.1*this._getFontHeight(e)},_fontString:function(){return this._textFont.type+" "+this._textFont.variant+" "+this._textFont.weight+" "+this._textFont.size+" / "+this._textFont.lineHeight+" "+this._textFont.family},textColor:function(t){n.assignColor(t,this);this._textColor="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")";this.trigger("Invalidate");return this},textFont:function(t,e){if(arguments.length===1){if(typeof t==="string"){return this._textFont[t]}if(typeof t==="object"){for(var i in t){if(i=="family"){this._textFont[i]="'"+t[i]+"'"}else{this._textFont[i]=t[i]}}}}else{this._textFont[t]=e}if(this.has("Canvas"))this._resizeForCanvas();this.trigger("Invalidate");return this},unselectable:function(){if(this.has("DOM")){this.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"default"});this.trigger("Invalidate")}return this}})},{"../core/core.js":41}],68:[function(t,e,i){var n=t("../core/core.js"),r=window.document;n.extend({viewport:{clampToEntities:true,_width:0,_height:0,_x:0,_y:0,_scale:1,bounds:null,scroll:function(t,e){this[t]=e;n.trigger("ViewportScroll");n.trigger("InvalidateViewport")},rect_object:{_x:0,_y:0,_w:0,_h:0},rect:function(){this.rect_object._x=-this._x;this.rect_object._y=-this._y;this.rect_object._w=this._width/this._scale;this.rect_object._h=this._height/this._scale;return this.rect_object},pan:function(){var t={},e,i=false;var r,s,o,a,u;function h(t){u.tick(t.dt);var e=u.value();n.viewport.x=(1-e)*o+e*r;n.viewport.y=(1-e)*a+e*s;n.viewport._clamp();if(u.complete){c();n.trigger("CameraAnimationDone")}}function c(){n.unbind("EnterFrame",h)}n._preBind("StopCamera",c);return function(t,e,i,c){n.trigger("StopCamera");if(t=="reset"){return}o=n.viewport._x;a=n.viewport._y;r=o-t;s=a-e;u=new n.easing(i,c);n.uniqueBind("EnterFrame",h)}}(),follow:function(){var t,e,i;function r(){var t=n.viewport._scale;n.viewport.scroll("_x",-(this.x+this.w/2-n.viewport.width/2/t-e*t));n.viewport.scroll("_y",-(this.y+this.h/2-n.viewport.height/2/t-i*t));n.viewport._clamp()}function s(){if(t){t.unbind("Move",r);t.unbind("ViewportScale",r);t.unbind("ViewportResize",r)}}n._preBind("StopCamera",s);return function(s,o,a){if(!s||!s.has("2D"))return;n.trigger("StopCamera");t=s;e=typeof o!="undefined"?o:0;i=typeof a!="undefined"?a:0;s.bind("Move",r);s.bind("ViewportScale",r);s.bind("ViewportResize",r);r.call(s)}}(),centerOn:function(t,e){var i=t.x+n.viewport.x,r=t.y+n.viewport.y,s=t.w/2,o=t.h/2,a=n.viewport.width/2/n.viewport._scale,u=n.viewport.height/2/n.viewport._scale,h=i+s-a,c=r+o-u;n.viewport.pan(h,c,e)},zoom:function(){function t(){n.unbind("EnterFrame",c)}n._preBind("StopCamera",t);var e,i,r,s,o,a,u,h;function c(i){var c,f;h.tick(i.dt);c=Math.pow(r,h.value());if(r===1)f=h.value();else f=(1/c-1)/(1/r-1);n.viewport.scale(c*e);n.viewport.scroll("_x",s*(1-f)+o*f);n.viewport.scroll("_y",a*(1-f)+u*f);n.viewport._clamp();if(h.complete){t();n.trigger("CameraAnimationDone")}}return function(t,f,l,d,p){if(!t){n.viewport.scale(1);return}if(arguments.length<=2){d=f;f=n.viewport.x-n.viewport.width;l=n.viewport.y-n.viewport.height}n.trigger("StopCamera");e=n.viewport._scale;r=t;i=e*r;s=n.viewport.x;a=n.viewport.y;o=-(f-n.viewport.width/(2*i));u=-(l-n.viewport.height/(2*i));h=new n.easing(d,p);n.uniqueBind("EnterFrame",c)}}(),scale:function(){return function(t){this._scale=t?t:1;n.trigger("InvalidateViewport");n.trigger("ViewportScale")}}(),mouselook:function(){var t=false,e=false,i={};old={};function r(){e=false}return function(r,s){if(typeof r=="boolean"){t=r;if(t){n.mouseObjs++}else{n.mouseObjs=Math.max(0,n.mouseObjs-1)}return}if(!t)return;switch(r){case"move":case"drag":if(!e)return;diff={x:s.clientX-i.x,y:s.clientY-i.y};i.x=s.clientX;i.y=s.clientY;n.viewport.x+=diff.x;n.viewport.y+=diff.y;n.viewport._clamp();break;case"start":n.trigger("StopCamera");i.x=s.clientX;i.y=s.clientY;e=true;break;case"stop":e=false;break}}}(),_clamp:function(){if(!this.clampToEntities)return;var t=n.clone(this.bounds)||n.map.boundaries();t.max.x*=this._scale;t.min.x*=this._scale;t.max.y*=this._scale;t.min.y*=this._scale;if(t.max.x-t.min.x>n.viewport.width){if(n.viewport.x<(-t.max.x+n.viewport.width)/this._scale){n.viewport.x=(-t.max.x+n.viewport.width)/this._scale}else if(n.viewport.x>-t.min.x){n.viewport.x=-t.min.x}}else{n.viewport.x=-1*(t.min.x+(t.max.x-t.min.x)/2-n.viewport.width/2)}if(t.max.y-t.min.y>n.viewport.height){if(n.viewport.y<(-t.max.y+n.viewport.height)/this._scale){n.viewport.y=(-t.max.y+n.viewport.height)/this._scale}else if(n.viewport.y>-t.min.y){n.viewport.y=-t.min.y}}else{n.viewport.y=-1*(t.min.y+(t.max.y-t.min.y)/2-n.viewport.height/2)}},init:function(t,e,i){this._defineViewportProperties();this._x=0;this._y=0;this._scale=1;this.bounds=null;this._width=t||window.innerWidth;this._height=e||window.innerHeight;if(typeof i==="undefined")i="cr-stage";var s;if(typeof i==="string")s=r.getElementById(i);else if(typeof HTMLElement!=="undefined"?i instanceof HTMLElement:i instanceof Element)s=i;else throw new TypeError("stage_elem must be a string or an HTMLElement");n.stage={x:0,y:0,fullscreen:false,elem:s?s:r.createElement("div")};if(!t&&!e){r.body.style.overflow="hidden";n.stage.fullscreen=true}n.addEvent(this,window,"resize",n.viewport.reload);n.addEvent(this,window,"blur",function(){if(n.settings.get("autoPause")){if(!n._paused)n.pause()}});n.addEvent(this,window,"focus",function(){if(n._paused&&n.settings.get("autoPause")){n.pause()}});n.settings.register("stageSelectable",function(t){n.stage.elem.onselectstart=t?function(){return true}:function(){return false}});n.settings.modify("stageSelectable",false);n.settings.register("stageContextMenu",function(t){n.stage.elem.oncontextmenu=t?function(){return true}:function(){return false}});n.settings.modify("stageContextMenu",false);n.settings.register("autoPause",function(){});n.settings.modify("autoPause",false);if(!s){r.body.appendChild(n.stage.elem);n.stage.elem.id=i}var o=n.stage.elem.style,a;o.width=this.width+"px";o.height=this.height+"px";o.overflow="hidden";n.bind("ViewportResize",function(){n.trigger("InvalidateViewport")});if(n.mobile){if(typeof o.webkitTapHighlightColor!==undefined){o.webkitTapHighlightColor="rgba(0,0,0,0)"}var u=r.createElement("meta"),h=r.getElementsByTagName("head")[0];u=r.createElement("meta");u.setAttribute("name","apple-mobile-web-app-capable");u.setAttribute("content","yes");h.appendChild(u);n.addEvent(this,n.stage.elem,"touchmove",function(t){t.preventDefault()})}o.position="relative";a=n.domHelper.innerPosition(n.stage.elem);n.stage.x=a.x;n.stage.y=a.y;n.uniqueBind("ViewportResize",this._resize)},_resize:function(){n.stage.elem.style.width=n.viewport.width+"px";n.stage.elem.style.height=n.viewport.height+"px"},_defineViewportProperties:function(){Object.defineProperty(this,"x",{set:function(t){this.scroll("_x",t)},get:function(){return this._x},configurable:true});Object.defineProperty(this,"y",{set:function(t){this.scroll("_y",t)},get:function(){return this._y},configurable:true});Object.defineProperty(this,"width",{set:function(t){this._width=t;n.trigger("ViewportResize")},get:function(){return this._width},configurable:true});Object.defineProperty(this,"height",{set:function(t){this._height=t;n.trigger("ViewportResize")},get:function(){return this._height},configurable:true})},reload:function(){var t=window.innerWidth,e=window.innerHeight,i;if(n.stage.fullscreen){this._width=t;this._height=e;n.trigger("ViewportResize")}i=n.domHelper.innerPosition(n.stage.elem);n.stage.x=i.x;n.stage.y=i.y},reset:function(){n.viewport.mouselook("stop");n.trigger("StopCamera");n.viewport.scroll("_x",0);n.viewport.scroll("_y",0);n.viewport.scale(1)},onScreen:function(t){return n.viewport._x+t._x+t._w>0&&n.viewport._y+t._y+t._h>0&&n.viewport._x+t._x<n.viewport.width&&n.viewport._y+t._y<n.viewport.height}}})},{"../core/core.js":41}],69:[function(t,e,i){var n=t("../core/core.js"),r=window.document;RenderProgramWrapper=function(t,e){this.shader=e;this.context=t;this.array_size=16;this.max_size=1024;this._indexArray=new Uint16Array(6*this.array_size);this._indexBuffer=t.createBuffer()};RenderProgramWrapper.prototype={initAttributes:function(t){this.attributes=t;this._attribute_table={};var e=0;for(var i=0;i<t.length;i++){var n=t[i];this._attribute_table[n.name]=n;n.bytes=n.bytes||Float32Array.BYTES_PER_ELEMENT;n.type=n.type||this.context.FLOAT;n.offset=e;n.location=this.context.getAttribLocation(this.shader,n.name);this.context.enableVertexAttribArray(n.location);e+=n.width}this.stride=e;this._attributeArray=new Float32Array(this.array_size*4*this.stride);this._attributeBuffer=this.context.createBuffer();this._registryHoles=[];this._registrySize=0},growArrays:function(t){if(this.array_size>=this.max_size)return;var e=Math.min(t,this.max_size);var i=new Float32Array(e*4*this.stride);var n=new Uint16Array(6*e);i.set(this._attributeArray);n.set(this._indexArray);this._attributeArray=i;this._indexArray=n;this.array_size=e},registerEntity:function(t){if(this._registryHoles.length===0){if(this._registrySize>=this.max_size){throw"Number of entities exceeds maximum limit."}else if(this._registrySize>=this.array_size){this.growArrays(2*this.array_size)}t._glBufferIndex=this._registrySize;this._registrySize++}else{t._glBufferIndex=this._registryHoles.pop()}},unregisterEntity:function(t){if(typeof t._glBufferIndex==="number")this._registryHoles.push(t._glBufferIndex);t._glBufferIndex=null},resetRegistry:function(){this._maxElement=0;this._registryHoles.length=0},setCurrentEntity:function(t){this.ent_offset=t._glBufferIndex*4;this.ent=t},switchTo:function(){var t=this.context;t.useProgram(this.shader);t.bindBuffer(t.ARRAY_BUFFER,this._attributeBuffer);var e,i=this.attributes;for(var r=0;r<i.length;r++){e=i[r];t.vertexAttribPointer(e.location,e.width,e.type,false,this.stride*e.bytes,e.offset*e.bytes)}var s=this.texture_obj;if(s&&s.unit===null){n.webgl.texture_manager.bindTexture(s)}this.index_pointer=0},setTexture:function(t){if(this.texture_obj!==undefined)return;t.setToProgram(this.shader,"uSampler","uTextureDimensions");this.texture_obj=t},addIndices:function(t){var e=this._indexArray,i=this.index_pointer;e[0+i]=0+t;e[1+i]=1+t;e[2+i]=2+t;e[3+i]=1+t;e[4+i]=2+t;e[5+i]=3+t;this.index_pointer+=6},renderBatch:function(){var t=this.context;t.bindBuffer(t.ARRAY_BUFFER,this._attributeBuffer);t.bufferData(t.ARRAY_BUFFER,this._attributeArray,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indexArray,t.STATIC_DRAW);t.drawElements(t.TRIANGLES,this.index_pointer,t.UNSIGNED_SHORT,0)},setViewportUniforms:function(t){var e=this.context;e.useProgram(this.shader);e.uniform4f(this.shader.viewport,t._x,t._y,t._width/t._scale,t._height/t._scale)},writeVector:function(t,e,i){var n=this._attribute_table[t];var r=this.stride,s=n.offset+this.ent_offset*r,o=n.width;var a=arguments.length-1;var u=this._attributeArray;for(var h=0;h<4;h++)for(var c=0;c<o;c++){u[s+r*h+c]=arguments[(o*h+c)%a+1]}}};n.c("WebGL",{init:function(){if(!n.webgl.context){n.webgl.init()}var t=this.webgl=n.webgl;var e=t.context;this._changed=true;this.bind("Change",this._glChange)},remove:function(){this._changed=true;this.unbind(this._glChange);if(this.program){this.program.unregisterEntity(this)}},_glChange:function(){if(this._changed===false){this._changed=true}},drawVars:{type:"webgl",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(t,e,i,n,r){if(!this.ready)return;if(arguments.length===4){r=n;n=i;i=e;e=t;t=this.webgl.context}var s=this.drawVars.pos;s._x=this._x+(e||0);s._y=this._y+(i||0);s._w=n||this._w;s._h=r||this._h;var o=this.__coord||[0,0,0,0];var a=this.drawVars.co;a.x=o[0]+(e||0);a.y=o[1]+(i||0);a.w=n||o[2];a.h=r||o[3];if(this._flipX){a.x=a.x+a.w;a.w=-a.w}if(this._flipY){a.y=a.y+a.h;a.h=-a.h}var u=this.webgl.context;this.drawVars.gl=u;var h=this.drawVars.program=this.program;h.setCurrentEntity(this);h.writeVector("aPosition",this._x,this._y,this._x,this._y+this._h,this._x+this._w,this._y,this._x+this._w,this._y+this._h);h.writeVector("aOrientation",this._origin.x+this._x,this._origin.y+this._y,this._rotation*Math.PI/180);h.writeVector("aLayer",this._globalZ,this._alpha);this.trigger("Draw",this.drawVars);h.addIndices(h.ent_offset);return this},_establishShader:function(t,e,i,n){this.program=this.webgl.getProgramWrapper(t,e,i,n);this.program.registerEntity(this);this.ready=true}});n.extend({webgl:{context:null,changed_objects:[],_compileShader:function(t,e){var i=this.context;var n=i.createShader(e);i.shaderSource(n,t);i.compileShader(n);if(!i.getShaderParameter(n,i.COMPILE_STATUS)){throw i.getShaderInfoLog(n)}return n},_makeProgram:function(t,e){var i=this.context;var n=this._compileShader(t,i.FRAGMENT_SHADER);var r=this._compileShader(e,i.VERTEX_SHADER);var s=i.createProgram();i.attachShader(s,r);i.attachShader(s,n);i.linkProgram(s);if(!i.getProgramParameter(s,i.LINK_STATUS)){throw"Could not initialise shaders"}s.viewport=i.getUniformLocation(s,"uViewport");return s},programs:{},getProgramWrapper:function(t,e,i,r){if(this.programs[t]===undefined){var s=this._makeProgram(e,i);var o=new RenderProgramWrapper(this.context,s);o.name=t;o.initAttributes(r);o.setViewportUniforms(n.viewport);this.programs[t]=o}return this.programs[t]},makeTexture:function(t,e,i){var n=this;return n.texture_manager.makeTexture(t,e,i)},init:function(){if(!n.support.webgl){n.trigger("NoWebGL");n.stop();return}this.changed_objects=[];var t;t=r.createElement("canvas");t.width=n.viewport.width;t.height=n.viewport.height;t.style.position="absolute";t.style.left="0px";t.style.top="0px";n.stage.elem.appendChild(t);var e;try{e=t.getContext("webgl",{premultipliedalpha:true})||t.getContext("experimental-webgl",{premultipliedalpha:true});e.viewportWidth=t.width;e.viewportHeight=t.height}catch(i){n.trigger("NoWebGL");n.stop();return}this.context=e;this._canvas=t;e.clearColor(0,0,0,0);e.disable(e.DEPTH_TEST);e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);e.enable(e.BLEND);var s=this;n.uniqueBind("RenderScene",s.render);n.uniqueBind("ViewportResize",s._resize);n.uniqueBind("InvalidateViewport",function(){s.dirtyViewport=true});n.uniqueBind("PixelartSet",s._setPixelart);s._setPixelart(n._pixelartEnabled);this.dirtyViewport=true;this.texture_manager=new n.TextureManager(e,this)},_resize:function(){var t=n.webgl._canvas;t.width=n.viewport.width;t.height=n.viewport.height;var e=n.webgl.context;e.viewportWidth=t.width;e.viewportHeight=t.height},_setPixelart:function(t){var e=n.webgl.context;if(t){n.webgl.texture_filter=e.NEAREST}else{n.webgl.texture_filter=e.LINEAR}},zsort:function(t,e){return t._globalZ-e._globalZ},visible_gl:[],render:function(t){t=t||n.viewport.rect();var e=n.webgl,i=e.context;i.viewport(0,0,i.viewportWidth,i.viewportHeight);i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);var r=e.programs;if(e.dirtyViewport){for(var s in r){r[s].setViewportUniforms(n.viewport)}e.dirtyViewport=false}var o=n.map.search(t),a=0,u=o.length,h;var c=e.visible_gl;

c.length=0;for(a=0;a<u;a++){h=o[a];if(h._visible&&h.__c.WebGL&&h.program){c.push(h)}}c.sort(e.zsort);u=c.length;var f=0;var l=null;for(a=0;a<u;a++){h=c[a];if(l!==h.program){if(l!==null){l.renderBatch()}l=h.program;l.index_pointer=0;l.switchTo()}h.draw();h._changed=false}if(l!==null){l.renderBatch()}}}})},{"../core/core.js":41}],70:[function(t,e,i){var n=t("../core/core.js");n.extend({diamondIso:{_tile:{width:0,height:0},getTileDimensions:function(){return{w:this._tile.width,h:this._tile.height}},_map:{width:0,height:0},_origin:{x:0,y:0},_tiles:[],getTile:function(t,e,i){return this._tiles[t][e][i]},init:function(t,e,i,n,r,s){this._tile.width=parseInt(t,10);this._tile.height=parseInt(e,10)||parseInt(t,10)/2;this._tile.r=this._tile.width/this._tile.height;this._map.width=parseInt(i,10);this._map.height=parseInt(n,10)||parseInt(i,10);for(var o=0;o<i;o++){this._tiles[o]=Array();for(var a=0;a<n;a++){this._tiles[o][a]=Array()}}this.x=parseInt(r,10)||0;this.y=parseInt(s,10)||0;this.layerZLevel=i+n+1;return this},place:function(t,e,i,n){var r=this.pos2px(e,i);var s=t.tileHeight;var o=t.h/this._tile.height;t.x=r.x;t.y=r.y-(o-2)*this._tile.height-this._tile.height*n;t.z=this.getZAtLoc(e,i,n);for(var a=0;a<=o-2;a++){var u=this._tiles[e][i][n+a];if(u&&u!==t){u.destroy()}this._tiles[e][i][n+a]=t}return this},detachTile:function(t){for(var e=0;e<this._map.width;e++){for(var i=0;i<this._map.height;i++){var n=this._tiles[e][i].length;for(var r=0;r<n;r++){if(this._tiles[e][i][r]&&t===this._tiles[e][i][r]){tHeight=t.h/this._tile.height;for(var s=0;s<tHeight;s++){this._tiles[e][i][r+s]=undefined}return{x:e,y:i,z:r}}}}}return false},centerAt:function(t,e){var i=this.pos2px(t,e);n.viewport.x=-i.x+n.viewport.width/2-this._tile.width;n.viewport.y=-i.y+n.viewport.height/2},getZAtLoc:function(t,e,i){return this.layerZLevel*i+t+e},pos2px:function(t,e){return{x:this.x+(t-e-1)*this._tile.width/2,y:this.y+(t+e)*this._tile.height/2}},px2pos:function(t,e){var i=(e-this.y)/this._tile.height;var n=(t-this.x)/this._tile.width;var r=i+n;var s=i-n;inX=r>0&&r<this._map.width;inY=s>0&&s<this._map.height;if(!inX||!inY){return undefined}return{x:~~r,y:~~s}},getOverlappingTiles:function(t,e){var i=this.px2pos(t,e);var n=[];var r=~~i.x;var s=~~i.y;var o=this._map.width-r;var a=this._map.height-s;var u=Math.min(o,a);var h=this._tiles[r][s][1];if(h){n.push(h)}for(var c=1;c<u;c++){var f=this._tiles[r+c][s+c][c];if(f){n.push(f)}}return n},polygon:function(t){t.requires("Collision");var e=0,i=0;var r=[e-0,t.h-i-this._tile.height/2,e-this._tile.width/2,t.h-i-0,e-this._tile.width,t.h-i-this._tile.height/2,e-this._tile.width/2,t.h-i-this._tile.height];var s=new n.polygon(r);return s}}})},{"../core/core.js":41}],71:[function(t,e,i){var n=t("../core/core.js");n.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(t,e){this._tile.width=t;this._tile.height=e>0?e:t/2;return this},place:function(t,e,i,r){var s=this.pos2px(t,e);s.top-=i*(this._tile.height/2);r.attr({x:s.left+n.viewport._x,y:s.top+n.viewport._y}).z+=i;return this},pos2px:function(t,e){return{left:t*this._tile.width+(e&1)*(this._tile.width/2),top:e*this._tile.height/2}},px2pos:function(t,e){return{x:-Math.ceil(-t/this._tile.width-(e&1)*.5),y:e/this._tile.height*2}},centerAt:function(t,e){if(typeof t=="number"&&typeof e=="number"){var i=this.pos2px(t,e);n.viewport._x=-i.left+n.viewport.width/2-this._tile.width/2;n.viewport._y=-i.top+n.viewport.height/2-this._tile.height/2;return this}else{return{top:-n.viewport._y+n.viewport.height/2-this._tile.height/2,left:-n.viewport._x+n.viewport.width/2-this._tile.width/2}}},area:function(){var t=this.centerAt();var e=this.px2pos(-t.left+n.viewport.width/2,-t.top+n.viewport.height/2);var i=this.px2pos(-t.left-n.viewport.width/2,-t.top-n.viewport.height/2);return{x:{start:e.x,end:i.x},y:{start:e.y,end:i.y}}}}})},{"../core/core.js":41}],72:[function(t,e,i){var n=t("../core/core.js"),r=window.document;n.extend({audio:{sounds:{},supported:null,codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:false,paused:false,playCheck:null,_canPlay:function(){this.supported={};if(!n.support.audio)return;var t=this.audioElement(),e;for(var i in this.codecs){e=t.canPlayType(this.codecs[i]);if(e!==""&&e!=="no"){this.supported[i]=true}else{this.supported[i]=false}}},supports:function(t){if(this.supported===null)this._canPlay();if(this.supported[t])return true;else return false},audioElement:function(){return typeof Audio!=="undefined"?new Audio(""):r.createElement("audio")},create:function(t,e){var i=e.substr(e.lastIndexOf(".")+1).toLowerCase();if(!this.supports(i))return false;var r=this.audioElement();r.id=t;r.preload="auto";r.volume=n.audio.volume;r.src=e;n.asset(e,r);this.sounds[t]={obj:r,played:0,volume:n.audio.volume};return this.sounds[t]},add:function(t,e){if(!n.support.audio)return;var i,r;if(arguments.length===1&&typeof t==="object"){for(var s in t){for(i in t[s]){r=n.audio.create(s,t[s][i]);if(r){break}}}}if(typeof t==="string"){if(typeof e==="string"){r=n.audio.create(t,e)}if(typeof e==="object"){for(i in e){r=n.audio.create(t,e[i]);if(r)break}}}return r},play:function(t,e,i){if(e===0||!n.support.audio||!this.sounds[t])return;var r=this.sounds[t];var s=this.getOpenChannel();if(!s)return null;s.id=t;s.repeat=e;var o=s.obj;s.volume=r.volume=r.obj.volume=i||n.audio.volume;o.volume=r.volume;o.src=r.obj.src;if(this.muted)o.volume=0;o.play();r.played++;s.onEnd=function(){if(r.played<s.repeat||e==-1){if(this.currentTime)this.currentTime=0;this.play();r.played++}else{s.active=false;this.pause();this.removeEventListener("ended",s.onEnd,true);this.currentTime=0;n.trigger("SoundComplete",{id:s.id})}};o.addEventListener("ended",s.onEnd,true);return o},maxChannels:7,setChannels:function(t){this.maxChannels=t;if(t<this.channels.length)this.channels.length=t},channels:[],getOpenChannel:function(){for(var t=0;t<this.channels.length;t++){var e=this.channels[t];if(e.active===false||e.obj.ended&&e.repeat<=this.sounds[e.id].played){e.active=true;return e}}if(t<this.maxChannels){var i={obj:this.audioElement(),active:true,_is:function(t){return this.id===t&&this.active}};this.channels.push(i);return i}return null},remove:function(t){if(!n.support.audio)return;var e,i,r=n.paths().audio;if(!t){for(var s in this.sounds){e=this.sounds[s];i=e.obj.src.split("/").pop();n.audio.stop(t);delete n.assets[r+i];delete n.assets[e.obj.src];delete n.audio.sounds[t]}return}if(!this.sounds[t])return;e=this.sounds[t];i=e.obj.src.split("/").pop();n.audio.stop(t);delete n.assets[r+i];delete n.assets[e.obj.src];delete n.audio.sounds[t]},stop:function(t){if(!n.support.audio)return;for(var e in this.channels){c=this.channels[e];if(!t&&c.active||c._is(t)){c.active=false;c.obj.pause()}}return},_mute:function(t){if(!n.support.audio)return;var e;for(var i in this.channels){e=this.channels[i];e.obj.volume=t?0:e.volume}this.muted=t},toggleMute:function(){if(!this.muted){this._mute(true)}else{this._mute(false)}},mute:function(){this._mute(true)},unmute:function(){this._mute(false)},pause:function(t){if(!n.support.audio||!t||!this.sounds[t])return;var e;for(var i in this.channels){e=this.channels[i];if(e._is(t)&&!e.obj.paused)e.obj.pause()}},unpause:function(t){if(!n.support.audio||!t||!this.sounds[t])return;var e;for(var i in this.channels){e=this.channels[i];if(e._is(t)&&e.obj.paused)e.obj.play()}},togglePause:function(t){if(!n.support.audio||!t||!this.sounds[t])return;var e;for(var i in this.channels){e=this.channels[i];if(e._is(t)){if(e.obj.paused){e.obj.play()}else{e.obj.pause()}}}},isPlaying:function(t){if(!n.support.audio)return false;for(var e in this.channels){if(this.channels[e]._is(t))return true}return false}}})},{"../core/core.js":41}],73:[function(t,e,i){var n=t("../core/core.js"),r=t("./spatial-grid.js");n.map=new r;var s=Math,o=s.cos,a=s.sin,u=s.PI,h=u/180;n.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1,_visible:true,_globalZ:null,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,_changed:false,_2D_property_definitions:{x:{set:function(t){this._attr("_x",t)},get:function(){return this._x},configurable:true,enumerable:true},_x:{enumerable:false},y:{set:function(t){this._attr("_y",t)},get:function(){return this._y},configurable:true,enumerable:true},_y:{enumerable:false},w:{set:function(t){this._attr("_w",t)},get:function(){return this._w},configurable:true,enumerable:true},_w:{enumerable:false},h:{set:function(t){this._attr("_h",t)},get:function(){return this._h},configurable:true,enumerable:true},_h:{enumerable:false},z:{set:function(t){this._attr("_z",t)},get:function(){return this._z},configurable:true,enumerable:true},_z:{enumerable:false},rotation:{set:function(t){this._attr("_rotation",t)},get:function(){return this._rotation},configurable:true,enumerable:true},_rotation:{enumerable:false},alpha:{set:function(t){this._attr("_alpha",t)},get:function(){return this._alpha},configurable:true,enumerable:true},_alpha:{enumerable:false},visible:{set:function(t){this._attr("_visible",t)},get:function(){return this._visible},configurable:true,enumerable:true},_visible:{enumerable:false}},_define2DProperties:function(){for(var t in this._2D_property_definitions){Object.defineProperty(this,t,this._2D_property_definitions[t])}},init:function(){this._globalZ=this[0];this._origin={x:0,y:0};this._bx1=0;this._bx2=0;this._by1=0;this._by2=0;this._children=[];this._define2DProperties();this._entry=n.map.insert(this);this.bind("Move",function(t){var e=this._cbr||this._mbr||this;this._entry.update(e);if(this._children.length>0){this._cascade(t)}});this.bind("Rotate",function(t){var e=this._cbr||this._mbr||this;this._entry.update(e);if(this._children.length>0){this._cascade(t)}});this.bind("Remove",function(){if(this._children){for(var t=0;t<this._children.length;t++){delete this._children[t]._parent;if(this._children[t].destroy){this._children[t].destroy()}}this._children=[]}if(this._parent){this._parent.detach(this)}n.map.remove(this);this.detach()})},offsetBoundary:function(t,e,i,n){if(arguments.length===1)e=i=n=t;this._bx1=t;this._bx2=i;this._by1=e;this._by2=n;this.trigger("BoundaryOffset");this._calculateMBR();return this},_calculateMBR:function(){var t=this._origin.x+this._x,e=this._origin.y+this._y,i=-this._rotation*h;var n=this._x-this._bx1-t,r=this._x+this._w+this._bx2-t,s=this._y-this._by1-e,o=this._y+this._h+this._by2-e;var a=Math.cos(i),u=Math.sin(i);a=a<1e-10&&a>-1e-10?0:a;u=u<1e-10&&u>-1e-10?0:u;var c=n*a+s*u,f=-n*u+s*a,l=r*a+s*u,d=-r*u+s*a,p=r*a+o*u,g=-r*u+o*a,v=n*a+o*u,_=-n*u+o*a,y=Math.floor(Math.min(c,l,p,v)+t),m=Math.floor(Math.min(f,d,g,_)+e),w=Math.ceil(Math.max(c,l,p,v)+t),b=Math.ceil(Math.max(f,d,g,_)+e);if(!this._mbr){this._mbr={_x:y,_y:m,_w:w-y,_h:b-m}}else{this._mbr._x=y;this._mbr._y=m;this._mbr._w=w-y;this._mbr._h=b-m}if(this._cbr){var x=this._cbr;var E=x.cx,M=x.cy,D=x.r;var T=t+(E+this._x-t)*a+(M+this._y-e)*u;var S=e-(E+this._x-t)*u+(M+this._y-e)*a;x._x=Math.min(T-D,y);x._y=Math.min(S-D,m);x._w=Math.max(T+D,w)-x._x;x._h=Math.max(S+D,b)-x._y}},_rotate:function(t){var e=-1*(t%360);var i=this._rotation-t;if(i===0)return;else this._rotation=t;var n=e*h,r={x:this._origin.x+this._x,y:this._origin.y+this._y};this._calculateMBR();var s=i*h,o=Math.cos(s),a=Math.sin(s);this.trigger("Rotate",{cos:-1e-10<o&&o<1e-10?0:o,sin:-1e-10<a&&a<1e-10?0:a,deg:i,rad:s,o:r})},area:function(){return this._w*this._h},intersect:function(t,e,i,n){var r,s=this._mbr||this;if(typeof t==="object"){r=t}else{r={_x:t,_y:e,_w:i,_h:n}}return s._x<r._x+r._w&&s._x+s._w>r._x&&s._y<r._y+r._h&&s._y+s._h>r._y},within:function(t,e,i,n){var r,s=this._mbr||this;if(typeof t==="object"){r=t}else{r={_x:t,_y:e,_w:i,_h:n}}return r._x<=s._x&&r._x+r._w>=s._x+s._w&&r._y<=s._y&&r._y+r._h>=s._y+s._h},contains:function(t,e,i,n){var r,s=this._mbr||this;if(typeof t==="object"){r=t}else{r={_x:t,_y:e,_w:i,_h:n}}return r._x>=s._x&&r._x+r._w<=s._x+s._w&&r._y>=s._y&&r._y+r._h<=s._y+s._h},pos:function(t){t=t||{};t._x=this._x;t._y=this._y;t._w=this._w;t._h=this._h;return t},mbr:function(t){t=t||{};if(!this._mbr){return this.pos(t)}else{t._x=this._mbr._x;t._y=this._mbr._y;t._w=this._mbr._w;t._h=this._mbr._h;return t}},isAt:function(t,e){if(this.mapArea){return this.mapArea.containsPoint(t,e)}else if(this.map){return this.map.containsPoint(t,e)}var i=this._mbr||this;return i._x<=t&&i._x+i._w>=t&&i._y<=e&&i._y+i._h>=e},move:function(t,e){if(t.charAt(0)==="n")this.y-=e;if(t.charAt(0)==="s")this.y+=e;if(t==="e"||t.charAt(1)==="e")this.x+=e;if(t==="w"||t.charAt(1)==="w")this.x-=e;return this},shift:function(t,e,i,n){if(t)this.x+=t;if(e)this.y+=e;if(i)this.w+=i;if(n)this.h+=n;return this},_cascade:function(t){if(!t)return;var e=0,i=this._children,n=i.length,r;if("cos"in t||"sin"in t){for(;e<n;++e){r=i[e];if("rotate"in r)r.rotate(t)}}else{var s=this._x-t._x,o=this._y-t._y,a=this._w-t._w,u=this._h-t._h;for(;e<n;++e){r=i[e];r.shift(s,o,a,u)}}},attach:function(){var t=0,e=arguments,i=arguments.length,n;for(;t<i;++t){n=e[t];if(n._parent){n._parent.detach(n)}n._parent=this;this._children.push(n)}return this},detach:function(t){var e;if(!t){for(e=0;e<this._children.length;e++){this._children[e]._parent=null}this._children=[];return this}for(e=0;e<this._children.length;e++){if(this._children[e]==t){this._children.splice(e,1)}}t._parent=null;return this},origin:function(t,e){if(typeof t==="string"){if(t==="centre"||t==="center"||t.indexOf(" ")===-1){t=this._w/2;e=this._h/2}else{var i=t.split(" ");if(i[0]==="top")e=0;else if(i[0]==="bottom")e=this._h;else if(i[0]==="middle"||i[1]==="center"||i[1]==="centre")e=this._h/2;if(i[1]==="center"||i[1]==="centre"||i[1]==="middle")t=this._w/2;else if(i[1]==="left")t=0;else if(i[1]==="right")t=this._w}}this._origin.x=t;this._origin.y=e;return this},flip:function(t){t=t||"X";if(!this["_flip"+t]){this["_flip"+t]=true;this.trigger("Invalidate")}return this},unflip:function(t){t=t||"X";if(this["_flip"+t]){this["_flip"+t]=false;this.trigger("Invalidate")}return this},rotate:function(t){var e,i;e=(this._x+this._origin.x-t.o.x)*t.cos+(this._y+this._origin.y-t.o.y)*t.sin+(t.o.x-this._origin.x);i=(this._y+this._origin.y-t.o.y)*t.cos-(this._x+this._origin.x-t.o.x)*t.sin+(t.o.y-this._origin.y);this._attr("_rotation",this._rotation-t.deg);this._attr("_x",e);this._attr("_y",i)},_attr:function(t,e){if(this[t]===e){return}var i=n.rectManager._pool.copy(this);var r;if(t==="_rotation"){this._rotate(e)}else if(t==="_z"){var s=e<<0;e=e==s?s:s+1;this._globalZ=e*1e5+this[0];this[t]=e;this.trigger("Reorder")}else if(t==="_x"||t==="_y"){r=this._mbr;if(r){r[t]-=this[t]-e;if(this._cbr){this._cbr[t]-=this[t]-e}}this[t]=e;this.trigger("Move",i)}else if(t==="_h"||t==="_w"){r=this._mbr;var o=this[t];this[t]=e;if(r){this._calculateMBR()}if(t==="_w"){this.trigger("Resize",{axis:"w",amount:e-o})}else if(t==="_h"){this.trigger("Resize",{axis:"h",amount:e-o})}this.trigger("Move",i)}this[t]=e;this.trigger("Invalidate");n.rectManager._pool.recycle(i)}});n.c("Supportable",{_ground:null,_groundComp:null,canLand:true,init:function(){this.requires("2D");this.__area={_x:0,_y:0,_w:0,_h:0};this.defineField("ground",function(){return this._ground},function(t){})},remove:function(t){this.unbind("EnterFrame",this._detectGroundTick)},startGroundDetection:function(t){if(t)this._groundComp=t;this.uniqueBind("EnterFrame",this._detectGroundTick);return this},stopGroundDetection:function(){this.unbind("EnterFrame",this._detectGroundTick);return this},_detectGroundTick:function(){var t=this._groundComp,e=this._ground,i=n.rectManager.overlap;var r=this._cbr||this._mbr||this,s=this.__area;s._x=r._x;s._y=r._y+1;s._w=r._w;s._h=r._h;if(e){var o=e._cbr||e._mbr||e;if(!(e.__c[t]&&i(o,s))){this._ground=null;this.trigger("LiftedOffGround",e);e=null}}if(!e){var a,u,h=n.map.search(s,false),c=0,f=h.length;for(;c<f;++c){a=h[c];u=a._cbr||a._mbr||a;if(a!==this&&a.__c[t]&&i(u,s)){this.canLand=true;this.trigger("CheckLanding",a);if(this.canLand){this._ground=e=a;this.y=a._y-this._h;this.trigger("LandedOnGround",e);break}}}}}});n.c("GroundAttacher",{_groundAttach:function(t){t.attach(this)},_groundDetach:function(t){t.detach(this)},init:function(){this.requires("Supportable");this.bind("LandedOnGround",this._groundAttach);this.bind("LiftedOffGround",this._groundDetach)},remove:function(t){this.unbind("LandedOnGround",this._groundAttach);this.unbind("LiftedOffGround",this._groundDetach)}});n.c("Gravity",{_gravityConst:500,init:function(){this.requires("2D, Supportable, Motion");this.bind("LiftedOffGround",this._startGravity);this.bind("LandedOnGround",this._stopGravity)},remove:function(t){this.unbind("LiftedOffGround",this._startGravity);this.unbind("LandedOnGround",this._stopGravity)},_gravityCheckLanding:function(t){if(this._dy<0)this.canLand=false},gravity:function(t){this.bind("CheckLanding",this._gravityCheckLanding);this.startGroundDetection(t);this._startGravity();return this},antigravity:function(){this._stopGravity();this.stopGroundDetection();this.unbind("CheckLanding",this._gravityCheckLanding);return this},gravityConst:function(t){if(this._gravityActive){this.ay-=this._gravityConst;this.ay+=t}this._gravityConst=t;return this},_startGravity:function(){this._gravityActive=true;this.ay+=this._gravityConst},_stopGravity:function(){this.ay=0;this.vy=0;this._gravityActive=false}});var c=function(t,e,i,r){var s=e+i;var o="_"+s;var a={key:"",oldValue:0};if(r){n.defineField(t,s,function(){return this[o]},function(t){var e=this[o];if(t!==e){this[o]=t;a.key=s;a.oldValue=e;this.trigger("MotionChange",a)}})}else{n.defineField(t,s,function(){return this[o]},function(t){})}Object.defineProperty(t,o,{value:0,writable:true,enumerable:false,configurable:false})};var f=function(t,e,i,r){var s=e+"x",o=e+"y",a="_"+s,u="_"+o;if(i){n.defineField(r,"x",function(){return t[a]},function(e){t[s]=e});n.defineField(r,"y",function(){return t[u]},function(e){t[o]=e})}else{n.defineField(r,"x",function(){return t[a]},function(t){});n.defineField(r,"y",function(){return t[u]},function(t){})}if(Object.seal){Object.seal(r)}return r};n.c("AngularMotion",{_vrotation:0,_arotation:0,_drotation:0,init:function(){this.requires("2D");c(this,"v","rotation",true);c(this,"a","rotation",true);c(this,"d","rotation",false);this.__oldRotationDirection=0;this.bind("EnterFrame",this._angularMotionTick)},remove:function(t){this.unbind("EnterFrame",this._angularMotionTick)},resetAngularMotion:function(){this._drotation=0;this.vrotation=0;this.arotation=0;return this},_angularMotionTick:function(t){var e=t.dt/1e3;var i=this._rotation,n=this._vrotation,r=this._arotation;var s=i+n*e+.5*r*e*e;this.vrotation=n+r*e;var o=this._vrotation,a=o?o<0?-1:1:0;if(this.__oldRotationDirection!==a){this.__oldRotationDirection=a;this.trigger("NewRotationDirection",a)}this._drotation=s-i;if(this._drotation!==0){this.rotation=s;this.trigger("Rotated",i)}}});n.c("Motion",{_vx:0,_vy:0,_ax:0,_ay:0,_dx:0,_dy:0,init:function(){this.requires("2D");c(this,"v","x",true);c(this,"v","y",true);this._velocity=f(this,"v",true,new n.math.Vector2D);c(this,"a","x",true);c(this,"a","y",true);this._acceleration=f(this,"a",true,new n.math.Vector2D);c(this,"d","x",false);c(this,"d","y",false);this._motionDelta=f(this,"d",false,new n.math.Vector2D);this.__movedEvent={axis:"",oldValue:0};this.__oldDirection={x:0,y:0};this.bind("EnterFrame",this._linearMotionTick)},remove:function(t){this.unbind("EnterFrame",this._linearMotionTick)},resetMotion:function(){this.vx=0;this.vy=0;this.ax=0;this.ay=0;this._dx=0;this._dy=0;return this},motionDelta:function(){return this._motionDelta},velocity:function(){return this._velocity},acceleration:function(){return this._acceleration},_linearMotionTick:function(t){var e=t.dt/1e3;var i=this._x,n=this._vx,r=this._ax,s=this._y,o=this._vy,a=this._ay;var u=i+n*e+.5*r*e*e;var h=s+o*e+.5*a*e*e;this.vx=n+r*e;this.vy=o+a*e;var c=this.__oldDirection,f=this._vx,l=f?f<0?-1:1:0,d=this._vy,p=d?d<0?-1:1:0;if(c.x!==l||c.y!==p){c.x=l;c.y=p;this.trigger("NewDirection",c)}var g=this.__movedEvent;this._dx=u-i;this._dy=h-s;if(this._dx!==0){this.x=u;g.axis="x";g.oldValue=i;this.trigger("Moved",g)}if(this._dy!==0){this.y=h;g.axis="y";g.oldValue=s;this.trigger("Moved",g)}}});n.polygon=function(t){if(arguments.length>1){t=Array.prototype.slice.call(arguments,0)}this.points=t};n.polygon.prototype={containsPoint:function(t,e){var i=this.points,n=i.length/2,r,s,o=false;for(r=0,s=n-1;r<n;s=r++){if(i[2*r+1]>e!=i[2*s+1]>e&&t<(i[2*s]-i[2*r])*(e-i[2*r+1])/(i[2*s+1]-i[2*r+1])+i[2*r]){o=!o}}return o},shift:function(t,e){var i=0,n=this.points,r=n.length;for(;i<r;i+=2){n[i]+=t;n[i+1]+=e}},clone:function(){return new n.polygon(this.points.slice(0))},rotate:function(t){var e=0,i=this.points,n=i.length,r,s;for(;e<n;e+=2){r=t.o.x+(i[e]-t.o.x)*t.cos+(i[e+1]-t.o.y)*t.sin;s=t.o.y-(i[e]-t.o.x)*t.sin+(i[e+1]-t.o.y)*t.cos;i[e]=r;i[e+1]=s}}};n.circle=function(t,e,i){this.x=t;this.y=e;this.radius=i;this.points=[];var n;for(var r=0;r<16;r+=2){n=r*Math.PI/8;this.points[r]=this.x+Math.sin(n)*i;this.points[r+1]=this.y+Math.cos(n)*i}};n.circle.prototype={containsPoint:function(t,e){var i=this.radius,n=Math.sqrt,r=this.x-t,s=this.y-e;return r*r+s*s<i*i},shift:function(t,e){this.x+=t;this.y+=e;var i=0,n=this.points,r=n.length,s;for(;i<r;i+=2){n[i]+=t;n[i+1]+=e}},rotate:function(){}};n.matrix=function(t){this.mtx=t;this.width=t[0].length;this.height=t.length};n.matrix.prototype={x:function(t){if(this.width!=t.height){return}var e=[];for(var i=0;i<this.height;i++){e[i]=[];for(var r=0;r<t.width;r++){var s=0;for(var o=0;o<this.width;o++){s+=this.mtx[i][o]*t.mtx[o][r]}e[i][r]=s}}return new n.matrix(e)},e:function(t,e){if(t<1||t>this.mtx.length||e<1||e>this.mtx[0].length)return null;return this.mtx[t-1][e-1]}}},{"../core/core.js":41,"./spatial-grid.js":77}],74:[function(t,e,i){var n=t("../core/core.js"),r=Math.PI/180;n.c("Collision",{init:function(){this.requires("2D");this._collisionData={};this.collision()},remove:function(){this._cbr=null;this.unbind("Resize",this._resizeMap);this.unbind("Resize",this._checkBounds)},collision:function(t){this.unbind("Resize",this._resizeMap);this.unbind("Resize",this._checkBounds);if(!t){t=new n.polygon([0,0,this._w,0,this._w,this._h,0,this._h]);this.bind("Resize",this._resizeMap);this._cbr=null}else{if(arguments.length>1){var e=Array.prototype.slice.call(arguments,0);t=new n.polygon(e)}else if(t.constructor===Array){t=new n.polygon(t.slice())}else{t=t.clone()}this._findBounds(t.points)}if(this.rotation){t.rotate({cos:Math.cos(-this.rotation*r),sin:Math.sin(-this.rotation*r),o:{x:this._origin.x,y:this._origin.y}})}this.map=t;this.attach(this.map);this.map.shift(this._x,this._y);this.trigger("NewHitbox",t);return this},_findBounds:function(t){var e=Infinity,i=-Infinity,n=Infinity,r=-Infinity;var s=t.length;for(var o=0;o<s;o+=2){if(t[o]<e)e=t[o];if(t[o]>i)i=t[o];if(t[o+1]<n)n=t[o+1];if(t[o+1]>r)r=t[o+1]}var a={cx:(e+i)/2,cy:(n+r)/2,r:Math.sqrt((i-e)*(i-e)+(r-n)*(r-n))/2};if(e>=0&&n>=0){this._checkBounds=function(){if(this._cbr===null&&this._w<i||this._h<r){this._cbr=a;this._calculateMBR()}else if(this._cbr){this._cbr=null;this._calculateMBR()}};this.bind("Resize",this._checkBounds)}if(e>=0&&n>=0&&i<=this._w&&r<=this._h){this._cbr=null;return false}else{this._cbr=a;this._calculateMBR();return true}},_resizeMap:function(t){var e,i,n=this.rotation*r,s=this.map.points;if(t.axis==="w"){if(n){e=t.amount*Math.cos(n);i=t.amount*Math.sin(n)}else{e=t.amount;i=0}s[2]+=e;s[3]+=i}else{if(n){i=t.amount*Math.cos(n);e=-t.amount*Math.sin(n)}else{e=0;i=t.amount}s[6]+=e;s[7]+=i}s[4]+=e;s[5]+=i},hit:function(t){var e=this._cbr||this._mbr||this,i=n.map.search(e,false),r=0,s=i.length,o={},a,u,h,c,f=n.rectManager.overlap,l="map"in this&&"containsPoint"in this.map,d=[];if(!s){return false}for(;r<s;++r){u=i[r];h=u._cbr||u._mbr||u;if(!u)continue;a=u[0];if(!o[a]&&this[0]!==a&&u.__c[t]&&f(h,e))o[a]=u}for(c in o){u=o[c];if(l&&"map"in u){var p=this._SAT(this.map,u.map);p.obj=u;p.type="SAT";if(p)d.push(p)}else{d.push({obj:u,type:"MBR"})}}if(!d.length){return false}return d},onHit:function(t,e,i){var n=false;this.bind("EnterFrame",function(){var r=this.hit(t);if(r){n=true;e.call(this,r)}else if(n){if(typeof i=="function"){i.call(this)}n=false}});return this},_createCollisionHandler:function(t,e){return function(){var i=this.hit(t);if(e.occurring===true){if(i!==false){return}e.occurring=false;this.trigger("HitOff",t)}else if(i!==false){e.occurring=true;this.trigger("HitOn",i)}}},checkHits:function(){var t=arguments;var e=0;if(t.length===1){t=t[0].split(/\s*,\s*/)}for(;e<t.length;++e){var i=t[e];var n=this._collisionData[i];if(n!==undefined){continue}this._collisionData[i]=n={occurring:false,handler:null};n.handler=this._createCollisionHandler(i,n);this.bind("EnterFrame",n.handler)}return this},ignoreHits:function(){var t=arguments;var e=0;var i;if(t.length===0){for(i in this._collisionData){this.unbind("EnterFrame",i.handler)}this._collisionData={}}if(t.length===1){t=t[0].split(/\s*,\s*/)}for(;e<t.length;++e){var n=t[e];i=this._collisionData[n];if(i===undefined){continue}this.unbind("EnterFrame",i.handler);delete this._collisionData[n]}return this},resetHitChecks:function(){var t=arguments;var e=0;var i;if(t.length===0){for(i in this._collisionData){this._collisionData[i].occurring=false}}if(t.length===1){t=t[0].split(/\s*,\s*/)}for(;e<t.length;++e){var n=t[e];i=this._collisionData[n];if(i===undefined){continue}i.occurring=false}return this},_SAT:function(t,e){var i=0,n=t.points,r=e.points,s=n.length/2,o,a=r.length/2,u=0,h=0,c,f,l,d,p,g,v=-Infinity,_=null,y=null,m,w;for(;i<s;i++){w=i==s-1?0:i+1;u=-(n[2*i+1]-n[2*w+1]);h=n[2*i]-n[2*w];c=Math.sqrt(u*u+h*h);u/=c;h/=c;f=l=Infinity;d=p=-Infinity;for(o=0;o<s;++o){m=n[2*o]*u+n[2*o+1]*h;if(m>d)d=m;if(m<f)f=m}for(o=0;o<a;++o){m=r[2*o]*u+r[2*o+1]*h;if(m>p)p=m;if(m<l)l=m}if(f<l){g=l-d;u=-u;h=-h}else{g=f-p}if(g>=0){return false}if(g>v){v=g;_=u;y=h}}for(i=0;i<a;i++){w=i==a-1?0:i+1;u=-(r[2*i+1]-r[2*w+1]);h=r[2*i]-r[2*w];c=Math.sqrt(u*u+h*h);u/=c;h/=c;f=l=Infinity;d=p=-Infinity;for(o=0;o<s;++o){m=n[2*o]*u+n[2*o+1]*h;if(m>d)d=m;if(m<f)f=m}for(o=0;o<a;++o){m=r[2*o]*u+r[2*o+1]*h;if(m>p)p=m;if(m<l)l=m}if(f<l){g=l-d;u=-u;h=-h}else{g=f-p}if(g>=0){return false}if(g>v){v=g;_=u;y=h}}return{overlap:v,normal:{x:_,y:y}}}})},{"../core/core.js":41}],75:[function(t,e,i){var n=t("../core/core.js");n.math={abs:function(t){return t<0?-t:t},amountOf:function(t,e,i){if(e<i)return(t-e)/(i-e);else return(t-i)/(e-i)},clamp:function(t,e,i){if(t>i)return i;else if(t<e)return e;else return t},degToRad:function(t){return t*Math.PI/180},distance:function(t,e,i,r){var s=n.math.squaredDistance(t,e,i,r);return Math.sqrt(parseFloat(s))},lerp:function(t,e,i){return t+(e-t)*i},negate:function(t){if(Math.random()<t)return-1;else return 1},radToDeg:function(t){return t*180/Math.PI},randomElementOfArray:function(t){return t[Math.floor(t.length*Math.random())]},randomInt:function(t,e){return t+Math.floor((1+e-t)*Math.random())},randomNumber:function(t,e){return t+(e-t)*Math.random()},squaredDistance:function(t,e,i,n){return(t-i)*(t-i)+(e-n)*(e-n)},withinRange:function(t,e,i){return t>=e&&t<=i}};n.math.Vector2D=function(){function t(e,i){if(e instanceof t){this.x=e.x;this.y=e.y}else if(arguments.length===2){this.x=e;this.y=i}else if(arguments.length>0)throw"Unexpected number of arguments for Vector2D()"}t.prototype.x=0;t.prototype.y=0;t.prototype.add=function(t){this.x+=t.x;this.y+=t.y;return this};t.prototype.angleBetween=function(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)};t.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)};t.prototype.clone=function(){return new t(this)};t.prototype.distance=function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))};t.prototype.distanceSq=function(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)};t.prototype.divide=function(t){this.x/=t.x;this.y/=t.y;return this};t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y};t.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x};t.prototype.equals=function(e){return e instanceof t&&this.x==e.x&&this.y==e.y};t.prototype.perpendicular=function(e){e=e||new t;return e.setValues(-this.y,this.x)};t.prototype.getNormal=function(e,i){i=i||new t;return i.setValues(e.y-this.y,this.x-e.x).normalize()};t.prototype.isZero=function(){return this.x===0&&this.y===0};t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};t.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y};t.prototype.multiply=function(t){this.x*=t.x;this.y*=t.y;return this};t.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t===0){this.x=1;this.y=0}else{this.x/=t;this.y/=t}return this};t.prototype.scale=function(t,e){if(e===undefined)e=t;this.x*=t;this.y*=e;return this};t.prototype.scaleToMagnitude=function(t){var e=t/this.magnitude();this.x*=e;this.y*=e;return this};t.prototype.setValues=function(e,i){if(e instanceof t){this.x=e.x;this.y=e.y}else{this.x=e;this.y=i}return this};t.prototype.subtract=function(t){this.x-=t.x;this.y-=t.y;return this};t.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"};t.prototype.translate=function(t,e){if(e===undefined)e=t;this.x+=t;this.y+=e;return this};t.tripleProduct=function(t,e,i,r){r=r||new n.math.Vector2D;var s=t.dotProduct(i);var o=e.dotProduct(i);return r.setValues(e.x*s-t.x*o,e.y*s-t.y*o)};return t}();n.math.Matrix2D=function(){Matrix2D=function(t,e,i,n,r,s){if(t instanceof Matrix2D){this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d;this.e=t.e;this.f=t.f}else if(arguments.length===6){this.a=t;this.b=e;this.c=i;this.d=n;this.e=r;this.f=s}else if(arguments.length>0)throw"Unexpected number of arguments for Matrix2D()"};Matrix2D.prototype.a=1;Matrix2D.prototype.b=0;Matrix2D.prototype.c=0;Matrix2D.prototype.d=1;Matrix2D.prototype.e=0;Matrix2D.prototype.f=0;Matrix2D.prototype.apply=function(t){var e=t.x;t.x=e*this.a+t.y*this.c+this.e;t.y=e*this.b+t.y*this.d+this.f;return t};Matrix2D.prototype.clone=function(){return new Matrix2D(this)};Matrix2D.prototype.combine=function(t){var e=this.a;this.a=e*t.a+this.b*t.c;this.b=e*t.b+this.b*t.d;e=this.c;this.c=e*t.a+this.d*t.c;this.d=e*t.b+this.d*t.d;e=this.e;this.e=e*t.a+this.f*t.c+t.e;this.f=e*t.b+this.f*t.d+t.f;return this};Matrix2D.prototype.equals=function(t){return t instanceof Matrix2D&&this.a==t.a&&this.b==t.b&&this.c==t.c&&this.d==t.d&&this.e==t.e&&this.f==t.f};Matrix2D.prototype.determinant=function(){return this.a*this.d-this.b*this.c};Matrix2D.prototype.invert=function(){var t=this.determinant();if(t!==0){var e={a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f};this.a=e.d/t;this.b=-e.b/t;this.c=-e.c/t;this.d=e.a/t;this.e=(e.c*e.f-e.e*e.d)/t;this.f=(e.e*e.b-e.a*e.f)/t}return this};Matrix2D.prototype.isIdentity=function(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.e===0&&this.f===0};Matrix2D.prototype.isInvertible=function(){return this.determinant()!==0};Matrix2D.prototype.preRotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var n=this.a;this.a=e*n-i*this.b;this.b=i*n+e*this.b;n=this.c;this.c=e*n-i*this.d;this.d=i*n+e*this.d;return this};Matrix2D.prototype.preScale=function(t,e){if(e===undefined)e=t;this.a*=t;this.b*=e;this.c*=t;this.d*=e;return this};Matrix2D.prototype.preTranslate=function(t,e){if(typeof t==="number"){this.e+=t;this.f+=e}else{this.e+=t.x;this.f+=t.y}return this};Matrix2D.prototype.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var n=this.a;this.a=e*n-i*this.b;this.b=i*n+e*this.b;n=this.c;this.c=e*n-i*this.d;this.d=i*n+e*this.d;n=this.e;this.e=e*n-i*this.f;this.f=i*n+e*this.f;return this};Matrix2D.prototype.scale=function(t,e){if(e===undefined)e=t;this.a*=t;this.b*=e;this.c*=t;this.d*=e;this.e*=t;this.f*=e;return this};Matrix2D.prototype.setValues=function(t,e,i,n,r,s){if(t instanceof Matrix2D){
this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d;this.e=t.e;this.f=t.f}else{this.a=t;this.b=e;this.c=i;this.d=n;this.e=r;this.f=s}return this};Matrix2D.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"};Matrix2D.prototype.translate=function(t,e){if(typeof t==="number"){this.e+=this.a*t+this.c*e;this.f+=this.b*t+this.d*e}else{this.e+=this.a*t.x+this.c*t.y;this.f+=this.b*t.x+this.d*t.y}return this};return Matrix2D}()},{"../core/core.js":41}],76:[function(t,e,i){var n=t("../core/core.js");n.extend({rectManager:{merge:function(t,e,i){if(typeof i==="undefined")i={};i._h=Math.max(t._y+t._h,e._y+e._h);i._w=Math.max(t._x+t._w,e._x+e._w);i._x=Math.min(t._x,e._x);i._y=Math.min(t._y,e._y);i._w-=i._x;i._h-=i._y;return i},overlap:function(t,e){return t._x<e._x+e._w&&t._x+t._w>e._x&&t._y<e._y+e._h&&t._y+t._h>e._y},mergeSet:function(t){var e=0;while(e<t.length-1){if(this.overlap(t[e],t[e+1])){this.merge(t[e],t[e+1],t[e]);t.splice(e+1,1);if(e>0){e--}}else{e++}}return t},boundingRect:function(t){if(!t||!t.length)return;var e=[],i=1,n=t.length,r,s=t[0],o;s=[s._x,s._y,s._x+s._w,s._y+s._h];while(i<n){r=t[i];o=[r._x,r._y,r._x+r._w,r._y+r._h];if(o[0]<s[0])s[0]=o[0];if(o[1]<s[1])s[1]=o[1];if(o[2]>s[2])s[2]=o[2];if(o[3]>s[3])s[3]=o[3];i++}o=s;s={_x:o[0],_y:o[1],_w:o[2]-o[0],_h:o[3]-o[1]};return s},_pool:function(){var t=[],e=0;return{get:function(i,n,r,s){if(t.length<=e)t.push({});var o=t[e++];o._x=i;o._y=n;o._w=r;o._h=s;return o},copy:function(i){if(t.length<=e)t.push({});var n=t[e++];n._x=i._x;n._y=i._y;n._w=i._w;n._h=i._h;return n},recycle:function(t){e--}}}()}})},{"../core/core.js":41}],77:[function(t,e,i){var n=t("../core/core.js");var r,s=function(t){r=t||64;this.map={}},o=" ",a={};s.prototype={insert:function(t){var e=s.key(t),i=new u(e,t,this),n=0,r,o;for(n=e.x1;n<=e.x2;n++){for(r=e.y1;r<=e.y2;r++){o=n<<16^r;if(!this.map[o])this.map[o]=[];this.map[o].push(t)}}return i},search:function(t,e){var i=s.key(t,a),n,r,o,u,h,c=[];if(e===undefined)e=true;for(n=i.x1;n<=i.x2;n++){for(r=i.y1;r<=i.y2;r++){h=this.map[n<<16^r];if(h){for(o=0;o<h.length;o++)c.push(h[o])}}}if(e){var f,l,d=[],p={};for(n=0,u=c.length;n<u;n++){f=c[n];if(!f)continue;l=f[0];f=f._mbr||f;if(!p[l]&&f._x<t._x+t._w&&f._x+f._w>t._x&&f._y<t._y+t._h&&f._y+f._h>t._y)p[l]=c[n]}for(f in p)d.push(p[f]);return d}else{return c}},remove:function(t,e){var i=0,n,r;if(arguments.length==1){e=t;t=s.key(e,a)}for(i=t.x1;i<=t.x2;i++){for(n=t.y1;n<=t.y2;n++){r=i<<16^n;if(this.map[r]){var o=this.map[r],u,h=o.length;for(u=0;u<h;u++)if(o[u]&&o[u][0]===e[0])o.splice(u,1)}}}},refresh:function(t){var e=t.keys;var i=t.obj;var n,r,o,a,u;for(r=e.x1;r<=e.x2;r++){for(o=e.y1;o<=e.y2;o++){n=this.map[r<<16^o];if(n){u=n.length;for(a=0;a<u;a++)if(n[a]&&n[a][0]===i[0])n.splice(a,1)}}}s.key(i,e);for(r=e.x1;r<=e.x2;r++){for(o=e.y1;o<=e.y2;o++){n=this.map[r<<16^o];if(!n)n=this.map[r<<16^o]=[];n.push(i)}}return t},boundaries:function(){var t,e,i={max:{x:-Infinity,y:-Infinity},min:{x:Infinity,y:Infinity}},n={max:{x:-Infinity,y:-Infinity},min:{x:Infinity,y:Infinity}};for(var r in this.map){if(!this.map[r].length)continue;var s=r>>16,o=r<<16>>16;if(o<0){s=s^-1}if(s>=i.max.x){i.max.x=s;for(t in this.map[r]){e=this.map[r][t];if(typeof e=="object"&&"requires"in e){n.max.x=Math.max(n.max.x,e.x+e.w)}}}if(s<=i.min.x){i.min.x=s;for(t in this.map[r]){e=this.map[r][t];if(typeof e=="object"&&"requires"in e){n.min.x=Math.min(n.min.x,e.x)}}}if(o>=i.max.y){i.max.y=o;for(t in this.map[r]){e=this.map[r][t];if(typeof e=="object"&&"requires"in e){n.max.y=Math.max(n.max.y,e.y+e.h)}}}if(o<=i.min.y){i.min.y=o;for(t in this.map[r]){e=this.map[r][t];if(typeof e=="object"&&"requires"in e){n.min.y=Math.min(n.min.y,e.y)}}}}return n}};s.key=function(t,e){if(t._mbr){t=t._mbr}if(!e){e={}}e.x1=Math.floor(t._x/r);e.y1=Math.floor(t._y/r);e.x2=Math.floor((t._w+t._x)/r);e.y2=Math.floor((t._h+t._y)/r);return e};s.hash=function(t){return t.x1+o+t.y1+o+t.x2+o+t.y2};function u(t,e,i){this.keys=t;this.map=i;this.obj=e}u.prototype={update:function(t){if(s.hash(s.key(t,a))!=s.hash(this.keys)){this.map.refresh(this)}}};e.exports=s},{"../core/core.js":41}],78:[function(t,e,i){e.exports=t("./lib/eql")},{"./lib/eql":79}],79:[function(t,e,i){var n=t("type-detect");var r;try{r=t("buffer").Buffer}catch(s){r={};r.isBuffer=function(){return false}}e.exports=o;function o(t,e,i){if(a(t,e)){return true}else if("date"===n(t)){return h(t,e)}else if("regexp"===n(t)){return c(t,e)}else if(r.isBuffer(t)){return p(t,e)}else if("arguments"===n(t)){return f(t,e,i)}else if(!u(t,e)){return false}else if("object"!==n(t)&&"object"!==n(e)&&("array"!==n(t)&&"array"!==n(e))){return a(t,e)}else{return v(t,e,i)}}function a(t,e){if(t===e)return t!==0||1/t===1/e;return t!==t&&e!==e}function u(t,e){return n(t)===n(e)}function h(t,e){if("date"!==n(e))return false;return a(t.getTime(),e.getTime())}function c(t,e){if("regexp"!==n(e))return false;return a(t.toString(),e.toString())}function f(t,e,i){if("arguments"!==n(e))return false;t=[].slice.call(t);e=[].slice.call(e);return o(t,e,i)}function l(t){var e=[];for(var i in t)e.push(i);return e}function d(t,e){if(t.length!==e.length)return false;var i=0;var n=true;for(;i<t.length;i++){if(t[i]!==e[i]){n=false;break}}return n}function p(t,e){if(!r.isBuffer(e))return false;return d(t,e)}function g(t){return t!==null&&t!==undefined}function v(t,e,i){if(!g(t)||!g(e)){return false}if(t.prototype!==e.prototype){return false}var n;if(i){for(n=0;n<i.length;n++){if(i[n][0]===t&&i[n][1]===e||i[n][0]===e&&i[n][1]===t){return true}}}else{i=[]}try{var r=l(t);var s=l(e)}catch(a){return false}r.sort();s.sort();if(!d(r,s)){return false}i.push([t,e]);var u;for(n=r.length-1;n>=0;n--){u=r[n];if(!o(t[u],e[u],i)){return false}}return true}},{buffer:6,"type-detect":80}],80:[function(t,e,i){e.exports=t("./lib/type")},{"./lib/type":81}],81:[function(t,e,i){var i=e.exports=r;var n={"[object Array]":"array","[object RegExp]":"regexp","[object Function]":"function","[object Arguments]":"arguments","[object Date]":"date"};function r(t){var e=Object.prototype.toString.call(t);if(n[e])return n[e];if(t===null)return"null";if(t===undefined)return"undefined";if(t===Object(t))return"object";return typeof t}i.Library=s;function s(){this.tests={}}s.prototype.of=r;s.prototype.define=function(t,e){if(arguments.length===1)return this.tests[t];this.tests[t]=e;return this};s.prototype.test=function(t,e){if(e===r(t))return true;var i=this.tests[e];if(i&&"regexp"===r(i)){return i.test(t)}else if(i&&"function"===r(i)){return i(t)}else{throw new ReferenceError('Type test "'+e+'" not defined or invalid.')}}},{}],82:[function(t,e,i){i.read=function(t,e,i,n,r){var s,o;var a=r*8-n-1;var u=(1<<a)-1;var h=u>>1;var c=-7;var f=i?r-1:0;var l=i?-1:1;var d=t[e+f];f+=l;s=d&(1<<-c)-1;d>>=-c;c+=a;for(;c>0;s=s*256+t[e+f],f+=l,c-=8){}o=s&(1<<-c)-1;s>>=-c;c+=n;for(;c>0;o=o*256+t[e+f],f+=l,c-=8){}if(s===0){s=1-h}else if(s===u){return o?NaN:(d?-1:1)*Infinity}else{o=o+Math.pow(2,n);s=s-h}return(d?-1:1)*o*Math.pow(2,s-n)};i.write=function(t,e,i,n,r,s){var o,a,u;var h=s*8-r-1;var c=(1<<h)-1;var f=c>>1;var l=r===23?Math.pow(2,-24)-Math.pow(2,-77):0;var d=n?0:s-1;var p=n?1:-1;var g=e<0||e===0&&1/e<0?1:0;e=Math.abs(e);if(isNaN(e)||e===Infinity){a=isNaN(e)?1:0;o=c}else{o=Math.floor(Math.log(e)/Math.LN2);if(e*(u=Math.pow(2,-o))<1){o--;u*=2}if(o+f>=1){e+=l/u}else{e+=l*Math.pow(2,1-f)}if(e*u>=2){o++;u/=2}if(o+f>=c){a=0;o=c}else if(o+f>=1){a=(e*u-1)*Math.pow(2,r);o=o+f}else{a=e*Math.pow(2,f-1)*Math.pow(2,r);o=0}}for(;r>=8;t[i+d]=a&255,d+=p,a/=256,r-=8){}o=o<<r|a;h+=r;for(;h>0;t[i+d]=o&255,d+=p,o/=256,h-=8){}t[i+d-p]|=g*128}},{}],83:[function(t,e,i){var n={}.toString;e.exports=Array.isArray||function(t){return n.call(t)=="[object Array]"}},{}],84:[function(t,e,i){var n=e.exports={};var r;var s;function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){r=setTimeout}else{r=o}}catch(t){r=o}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=a}}catch(t){s=a}})();function u(t){if(r===setTimeout){return setTimeout(t,0)}if((r===o||!r)&&setTimeout){r=setTimeout;return setTimeout(t,0)}try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}function h(t){if(s===clearTimeout){return clearTimeout(t)}if((s===a||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(t)}try{return s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}var c=[];var f=false;var l;var d=-1;function p(){if(!f||!l){return}f=false;if(l.length){c=l.concat(c)}else{d=-1}if(c.length){g()}}function g(){if(f){return}var t=u(p);f=true;var e=c.length;while(e){l=c;c=[];while(++d<e){if(l){l[d].run()}}d=-1;e=c.length}l=null;f=false;h(t)}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}}c.push(new v(t,e));if(c.length===1&&!f){u(g)}};function v(t,e){this.fun=t;this.array=e}v.prototype.run=function(){this.fun.apply(null,this.array)};n.title="browser";n.browser=true;n.env={};n.argv=[];n.version="";n.versions={};function _(){}n.on=_;n.addListener=_;n.once=_;n.off=_;n.removeListener=_;n.removeAllListeners=_;n.emit=_;n.binding=function(t){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(t){throw new Error("process.chdir is not supported")};n.umask=function(){return 0}},{}],85:[function(t,e,i){arguments[4][80][0].apply(i,arguments)},{"./lib/type":86,dup:80}],86:[function(t,e,i){var i=e.exports=r;var n=/^\[object (.*)\]$/;function r(t){var e=Object.prototype.toString.call(t).match(n)[1].toLowerCase();if(typeof Promise==="function"&&t instanceof Promise)return"promise";if(t===null)return"null";if(t===undefined)return"undefined";return e}i.Library=s;function s(){if(!(this instanceof s))return new s;this.tests={}}s.prototype.of=r;s.prototype.define=function(t,e){if(arguments.length===1)return this.tests[t];this.tests[t]=e;return this};s.prototype.test=function(t,e){if(e===r(t))return true;var i=this.tests[e];if(i&&"regexp"===r(i)){return i.test(t)}else if(i&&"function"===r(i)){return i(t)}else{throw new ReferenceError('Type test "'+e+'" not defined or invalid.')}}},{}],87:[function(t,e,i){(function(){var t=this;var n=t._;var r=Array.prototype,s=Object.prototype,o=Function.prototype;var a=r.push,u=r.slice,h=s.toString,c=s.hasOwnProperty;var f=Array.isArray,l=Object.keys,d=o.bind,p=Object.create;var g=function(){};var v=function(t){if(t instanceof v)return t;if(!(this instanceof v))return new v(t);this._wrapped=t};if(typeof i!=="undefined"){if(typeof e!=="undefined"&&e.exports){i=e.exports=v}i._=v}else{t._=v}v.VERSION="1.8.3";var _=function(t,e,i){if(e===void 0)return t;switch(i==null?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,s){return t.call(e,i,n,r,s)}}return function(){return t.apply(e,arguments)}};var y=function(t,e,i){if(t==null)return v.identity;if(v.isFunction(t))return _(t,e,i);if(v.isObject(t))return v.matcher(t);return v.property(t)};v.iteratee=function(t,e){return y(t,e,Infinity)};var m=function(t,e){return function(i){var n=arguments.length;if(n<2||i==null)return i;for(var r=1;r<n;r++){var s=arguments[r],o=t(s),a=o.length;for(var u=0;u<a;u++){var h=o[u];if(!e||i[h]===void 0)i[h]=s[h]}}return i}};var w=function(t){if(!v.isObject(t))return{};if(p)return p(t);g.prototype=t;var e=new g;g.prototype=null;return e};var b=function(t){return function(e){return e==null?void 0:e[t]}};var x=Math.pow(2,53)-1;var E=b("length");var M=function(t){var e=E(t);return typeof e=="number"&&e>=0&&e<=x};v.each=v.forEach=function(t,e,i){e=_(e,i);var n,r;if(M(t)){for(n=0,r=t.length;n<r;n++){e(t[n],n,t)}}else{var s=v.keys(t);for(n=0,r=s.length;n<r;n++){e(t[s[n]],s[n],t)}}return t};v.map=v.collect=function(t,e,i){e=y(e,i);var n=!M(t)&&v.keys(t),r=(n||t).length,s=Array(r);for(var o=0;o<r;o++){var a=n?n[o]:o;s[o]=e(t[a],a,t)}return s};function D(t){function e(e,i,n,r,s,o){for(;s>=0&&s<o;s+=t){var a=r?r[s]:s;n=i(n,e[a],a,e)}return n}return function(i,n,r,s){n=_(n,s,4);var o=!M(i)&&v.keys(i),a=(o||i).length,u=t>0?0:a-1;if(arguments.length<3){r=i[o?o[u]:u];u+=t}return e(i,n,r,o,u,a)}}v.reduce=v.foldl=v.inject=D(1);v.reduceRight=v.foldr=D(-1);v.find=v.detect=function(t,e,i){var n;if(M(t)){n=v.findIndex(t,e,i)}else{n=v.findKey(t,e,i)}if(n!==void 0&&n!==-1)return t[n]};v.filter=v.select=function(t,e,i){var n=[];e=y(e,i);v.each(t,function(t,i,r){if(e(t,i,r))n.push(t)});return n};v.reject=function(t,e,i){return v.filter(t,v.negate(y(e)),i)};v.every=v.all=function(t,e,i){e=y(e,i);var n=!M(t)&&v.keys(t),r=(n||t).length;for(var s=0;s<r;s++){var o=n?n[s]:s;if(!e(t[o],o,t))return false}return true};v.some=v.any=function(t,e,i){e=y(e,i);var n=!M(t)&&v.keys(t),r=(n||t).length;for(var s=0;s<r;s++){var o=n?n[s]:s;if(e(t[o],o,t))return true}return false};v.contains=v.includes=v.include=function(t,e,i,n){if(!M(t))t=v.values(t);if(typeof i!="number"||n)i=0;return v.indexOf(t,e,i)>=0};v.invoke=function(t,e){var i=u.call(arguments,2);var n=v.isFunction(e);return v.map(t,function(t){var r=n?e:t[e];return r==null?r:r.apply(t,i)})};v.pluck=function(t,e){return v.map(t,v.property(e))};v.where=function(t,e){return v.filter(t,v.matcher(e))};v.findWhere=function(t,e){return v.find(t,v.matcher(e))};v.max=function(t,e,i){var n=-Infinity,r=-Infinity,s,o;if(e==null&&t!=null){t=M(t)?t:v.values(t);for(var a=0,u=t.length;a<u;a++){s=t[a];if(s>n){n=s}}}else{e=y(e,i);v.each(t,function(t,i,s){o=e(t,i,s);if(o>r||o===-Infinity&&n===-Infinity){n=t;r=o}})}return n};v.min=function(t,e,i){var n=Infinity,r=Infinity,s,o;if(e==null&&t!=null){t=M(t)?t:v.values(t);for(var a=0,u=t.length;a<u;a++){s=t[a];if(s<n){n=s}}}else{e=y(e,i);v.each(t,function(t,i,s){o=e(t,i,s);if(o<r||o===Infinity&&n===Infinity){n=t;r=o}})}return n};v.shuffle=function(t){var e=M(t)?t:v.values(t);var i=e.length;var n=Array(i);for(var r=0,s;r<i;r++){s=v.random(0,r);if(s!==r)n[r]=n[s];n[s]=e[r]}return n};v.sample=function(t,e,i){if(e==null||i){if(!M(t))t=v.values(t);return t[v.random(t.length-1)]}return v.shuffle(t).slice(0,Math.max(0,e))};v.sortBy=function(t,e,i){e=y(e,i);return v.pluck(v.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria;var n=e.criteria;if(i!==n){if(i>n||i===void 0)return 1;if(i<n||n===void 0)return-1}return t.index-e.index}),"value")};var T=function(t){return function(e,i,n){var r={};i=y(i,n);v.each(e,function(n,s){var o=i(n,s,e);t(r,n,o)});return r}};v.groupBy=T(function(t,e,i){if(v.has(t,i))t[i].push(e);else t[i]=[e]});v.indexBy=T(function(t,e,i){t[i]=e});v.countBy=T(function(t,e,i){if(v.has(t,i))t[i]++;else t[i]=1});v.toArray=function(t){if(!t)return[];if(v.isArray(t))return u.call(t);if(M(t))return v.map(t,v.identity);return v.values(t)};v.size=function(t){if(t==null)return 0;return M(t)?t.length:v.keys(t).length};v.partition=function(t,e,i){e=y(e,i);var n=[],r=[];v.each(t,function(t,i,s){(e(t,i,s)?n:r).push(t)});return[n,r]};v.first=v.head=v.take=function(t,e,i){if(t==null)return void 0;if(e==null||i)return t[0];return v.initial(t,t.length-e)};v.initial=function(t,e,i){return u.call(t,0,Math.max(0,t.length-(e==null||i?1:e)))};v.last=function(t,e,i){if(t==null)return void 0;if(e==null||i)return t[t.length-1];return v.rest(t,Math.max(0,t.length-e))};v.rest=v.tail=v.drop=function(t,e,i){return u.call(t,e==null||i?1:e)};v.compact=function(t){return v.filter(t,v.identity)};var S=function(t,e,i,n){var r=[],s=0;for(var o=n||0,a=E(t);o<a;o++){var u=t[o];if(M(u)&&(v.isArray(u)||v.isArguments(u))){if(!e)u=S(u,e,i);var h=0,c=u.length;r.length+=c;while(h<c){r[s++]=u[h++]}}else if(!i){r[s++]=u}}return r};v.flatten=function(t,e){return S(t,e,false)};v.without=function(t){return v.difference(t,u.call(arguments,1))};v.uniq=v.unique=function(t,e,i,n){if(!v.isBoolean(e)){n=i;i=e;e=false}if(i!=null)i=y(i,n);var r=[];var s=[];for(var o=0,a=E(t);o<a;o++){var u=t[o],h=i?i(u,o,t):u;if(e){if(!o||s!==h)r.push(u);s=h}else if(i){if(!v.contains(s,h)){s.push(h);r.push(u)}}else if(!v.contains(r,u)){r.push(u)}}return r};v.union=function(){return v.uniq(S(arguments,true,true))};v.intersection=function(t){var e=[];var i=arguments.length;for(var n=0,r=E(t);n<r;n++){var s=t[n];if(v.contains(e,s))continue;for(var o=1;o<i;o++){if(!v.contains(arguments[o],s))break}if(o===i)e.push(s)}return e};v.difference=function(t){var e=S(arguments,true,true,1);return v.filter(t,function(t){return!v.contains(e,t)})};v.zip=function(){return v.unzip(arguments)};v.unzip=function(t){var e=t&&v.max(t,E).length||0;var i=Array(e);for(var n=0;n<e;n++){i[n]=v.pluck(t,n)}return i};v.object=function(t,e){var i={};for(var n=0,r=E(t);n<r;n++){if(e){i[t[n]]=e[n]}else{i[t[n][0]]=t[n][1]}}return i};function C(t){return function(e,i,n){i=y(i,n);var r=E(e);var s=t>0?0:r-1;for(;s>=0&&s<r;s+=t){if(i(e[s],s,e))return s}return-1}}v.findIndex=C(1);v.findLastIndex=C(-1);v.sortedIndex=function(t,e,i,n){i=y(i,n,1);var r=i(e);var s=0,o=E(t);while(s<o){var a=Math.floor((s+o)/2);if(i(t[a])<r)s=a+1;else o=a}return s};function A(t,e,i){return function(n,r,s){var o=0,a=E(n);if(typeof s=="number"){if(t>0){o=s>=0?s:Math.max(s+a,o)}else{a=s>=0?Math.min(s+1,a):s+a+1}}else if(i&&s&&a){s=i(n,r);return n[s]===r?s:-1}if(r!==r){s=e(u.call(n,o,a),v.isNaN);return s>=0?s+o:-1}for(s=t>0?o:a-1;s>=0&&s<a;s+=t){if(n[s]===r)return s}return-1}}v.indexOf=A(1,v.findIndex,v.sortedIndex);v.lastIndexOf=A(-1,v.findLastIndex);v.range=function(t,e,i){if(e==null){e=t||0;t=0}i=i||1;var n=Math.max(Math.ceil((e-t)/i),0);var r=Array(n);for(var s=0;s<n;s++,t+=i){r[s]=t}return r};var j=function(t,e,i,n,r){if(!(n instanceof e))return t.apply(i,r);var s=w(t.prototype);var o=t.apply(s,r);if(v.isObject(o))return o;return s};v.bind=function(t,e){if(d&&t.bind===d)return d.apply(t,u.call(arguments,1));if(!v.isFunction(t))throw new TypeError("Bind must be called on a function");var i=u.call(arguments,2);var n=function(){return j(t,n,e,this,i.concat(u.call(arguments)))};return n};v.partial=function(t){var e=u.call(arguments,1);var i=function(){var n=0,r=e.length;var s=Array(r);for(var o=0;o<r;o++){s[o]=e[o]===v?arguments[n++]:e[o]}while(n<arguments.length)s.push(arguments[n++]);return j(t,i,this,this,s)};return i};v.bindAll=function(t){var e,i=arguments.length,n;if(i<=1)throw new Error("bindAll must be passed function names");for(e=1;e<i;e++){n=arguments[e];t[n]=v.bind(t[n],t)}return t};v.memoize=function(t,e){var i=function(n){var r=i.cache;var s=""+(e?e.apply(this,arguments):n);if(!v.has(r,s))r[s]=t.apply(this,arguments);return r[s]};i.cache={};return i};v.delay=function(t,e){var i=u.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)};v.defer=v.partial(v.delay,v,1);v.throttle=function(t,e,i){var n,r,s;var o=null;var a=0;if(!i)i={};var u=function(){a=i.leading===false?0:v.now();o=null;s=t.apply(n,r);if(!o)n=r=null};return function(){var h=v.now();if(!a&&i.leading===false)a=h;var c=e-(h-a);n=this;r=arguments;if(c<=0||c>e){if(o){clearTimeout(o);o=null}a=h;s=t.apply(n,r);if(!o)n=r=null}else if(!o&&i.trailing!==false){o=setTimeout(u,c)}return s}};v.debounce=function(t,e,i){var n,r,s,o,a;var u=function(){var h=v.now()-o;if(h<e&&h>=0){n=setTimeout(u,e-h)}else{n=null;if(!i){a=t.apply(s,r);if(!n)s=r=null}}};return function(){s=this;r=arguments;o=v.now();var h=i&&!n;if(!n)n=setTimeout(u,e);if(h){a=t.apply(s,r);s=r=null}return a}};v.wrap=function(t,e){return v.partial(e,t)};v.negate=function(t){return function(){return!t.apply(this,arguments)}};v.compose=function(){var t=arguments;var e=t.length-1;return function(){var i=e;var n=t[e].apply(this,arguments);while(i--)n=t[i].call(this,n);return n}};v.after=function(t,e){return function(){if(--t<1){return e.apply(this,arguments)}}};v.before=function(t,e){var i;return function(){if(--t>0){i=e.apply(this,arguments)}if(t<=1)e=null;return i}};v.once=v.partial(v.before,2);var O=!{toString:null}.propertyIsEnumerable("toString");var R=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function P(t,e){var i=R.length;var n=t.constructor;var r=v.isFunction(n)&&n.prototype||s;var o="constructor";if(v.has(t,o)&&!v.contains(e,o))e.push(o);while(i--){o=R[i];if(o in t&&t[o]!==r[o]&&!v.contains(e,o)){e.push(o)}}}v.keys=function(t){if(!v.isObject(t))return[];if(l)return l(t);var e=[];for(var i in t)if(v.has(t,i))e.push(i);if(O)P(t,e);return e};v.allKeys=function(t){if(!v.isObject(t))return[];var e=[];for(var i in t)e.push(i);if(O)P(t,e);return e};v.values=function(t){var e=v.keys(t);var i=e.length;var n=Array(i);for(var r=0;r<i;r++){n[r]=t[e[r]]}return n};v.mapObject=function(t,e,i){e=y(e,i);var n=v.keys(t),r=n.length,s={},o;for(var a=0;a<r;a++){o=n[a];s[o]=e(t[o],o,t)}return s};v.pairs=function(t){var e=v.keys(t);var i=e.length;var n=Array(i);for(var r=0;r<i;r++){n[r]=[e[r],t[e[r]]]}return n};v.invert=function(t){var e={};var i=v.keys(t);for(var n=0,r=i.length;n<r;n++){e[t[i[n]]]=i[n]}return e};v.functions=v.methods=function(t){var e=[];for(var i in t){if(v.isFunction(t[i]))e.push(i)}return e.sort()};v.extend=m(v.allKeys);v.extendOwn=v.assign=m(v.keys);v.findKey=function(t,e,i){e=y(e,i);var n=v.keys(t),r;for(var s=0,o=n.length;s<o;s++){r=n[s];if(e(t[r],r,t))return r}};v.pick=function(t,e,i){var n={},r=t,s,o;if(r==null)return n;if(v.isFunction(e)){o=v.allKeys(r);s=_(e,i)}else{o=S(arguments,false,false,1);s=function(t,e,i){return e in i};r=Object(r)}for(var a=0,u=o.length;a<u;a++){var h=o[a];var c=r[h];if(s(c,h,r))n[h]=c}return n};v.omit=function(t,e,i){if(v.isFunction(e)){e=v.negate(e)}else{var n=v.map(S(arguments,false,false,1),String);e=function(t,e){return!v.contains(n,e)}}return v.pick(t,e,i)};v.defaults=m(v.allKeys,true);v.create=function(t,e){var i=w(t);if(e)v.extendOwn(i,e);return i};v.clone=function(t){if(!v.isObject(t))return t;return v.isArray(t)?t.slice():v.extend({},t)};v.tap=function(t,e){e(t);return t};v.isMatch=function(t,e){var i=v.keys(e),n=i.length;if(t==null)return!n;var r=Object(t);for(var s=0;s<n;s++){var o=i[s];if(e[o]!==r[o]||!(o in r))return false}return true};var k=function(t,e,i,n){if(t===e)return t!==0||1/t===1/e;if(t==null||e==null)return t===e;if(t instanceof v)t=t._wrapped;if(e instanceof v)e=e._wrapped;var r=h.call(t);if(r!==h.call(e))return false;switch(r){case"[object RegExp]":case"[object String]":return""+t===""+e;case"[object Number]":if(+t!==+t)return+e!==+e;return+t===0?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var s=r==="[object Array]";if(!s){if(typeof t!="object"||typeof e!="object")return false;var o=t.constructor,a=e.constructor;if(o!==a&&!(v.isFunction(o)&&o instanceof o&&v.isFunction(a)&&a instanceof a)&&("constructor"in t&&"constructor"in e)){return false}}i=i||[];n=n||[];var u=i.length;while(u--){if(i[u]===t)return n[u]===e}i.push(t);n.push(e);if(s){u=t.length;if(u!==e.length)return false;while(u--){if(!k(t[u],e[u],i,n))return false}}else{var c=v.keys(t),f;u=c.length;if(v.keys(e).length!==u)return false;while(u--){f=c[u];if(!(v.has(e,f)&&k(t[f],e[f],i,n)))return false}}i.pop();n.pop();return true};v.isEqual=function(t,e){return k(t,e)};v.isEmpty=function(t){if(t==null)return true;if(M(t)&&(v.isArray(t)||v.isString(t)||v.isArguments(t)))return t.length===0;return v.keys(t).length===0};v.isElement=function(t){return!!(t&&t.nodeType===1)};v.isArray=f||function(t){return h.call(t)==="[object Array]"};v.isObject=function(t){var e=typeof t;return e==="function"||e==="object"&&!!t};v.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){v["is"+t]=function(e){return h.call(e)==="[object "+t+"]"}});if(!v.isArguments(arguments)){v.isArguments=function(t){return v.has(t,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){v.isFunction=function(t){return typeof t=="function"||false}}v.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))};v.isNaN=function(t){return v.isNumber(t)&&t!==+t};v.isBoolean=function(t){return t===true||t===false||h.call(t)==="[object Boolean]"};v.isNull=function(t){return t===null};v.isUndefined=function(t){return t===void 0};v.has=function(t,e){return t!=null&&c.call(t,e)};v.noConflict=function(){t._=n;return this};v.identity=function(t){return t};v.constant=function(t){return function(){return t}};v.noop=function(){};v.property=b;v.propertyOf=function(t){return t==null?function(){}:function(e){return t[e]}};v.matcher=v.matches=function(t){t=v.extendOwn({},t);return function(e){return v.isMatch(e,t)}};v.times=function(t,e,i){var n=Array(Math.max(0,t));e=_(e,i,1);for(var r=0;r<t;r++)n[r]=e(r);return n};v.random=function(t,e){if(e==null){e=t;t=0}return t+Math.floor(Math.random()*(e-t+1))};v.now=Date.now||function(){return(new Date).getTime()};var I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var z=v.invert(I);var N=function(t){var e=function(e){return t[e]};var i="(?:"+v.keys(t).join("|")+")";var n=RegExp(i);var r=RegExp(i,"g");return function(t){t=t==null?"":""+t;return n.test(t)?t.replace(r,e):t}};v.escape=N(I);v.unescape=N(z);v.result=function(t,e,i){var n=t==null?void 0:t[e];if(n===void 0){n=i}return v.isFunction(n)?n.call(t):n};var L=0;v.uniqueId=function(t){var e=++L+"";return t?t+e:e};v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/;var B={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var q=/\\|'|\r|\n|\u2028|\u2029/g;var U=function(t){return"\\"+B[t]};v.template=function(t,e,i){if(!e&&i)e=i;e=v.defaults({},e,v.templateSettings);var n=RegExp([(e.escape||F).source,(e.interpolate||F).source,(e.evaluate||F).source].join("|")+"|$","g");var r=0;var s="__p+='";t.replace(n,function(e,i,n,o,a){s+=t.slice(r,a).replace(q,U);r=a+e.length;if(i){s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"}else if(n){s+="'+\n((__t=("+n+"))==null?'':__t)+\n'"}else if(o){s+="';\n"+o+"\n__p+='"}return e});s+="';\n";if(!e.variable)s="with(obj||{}){\n"+s+"}\n";s="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(e.variable||"obj","_",s)}catch(a){a.source=s;throw a}var u=function(t){return o.call(this,t,v)};var h=e.variable||"obj";u.source="function("+h+"){\n"+s+"}";return u};v.chain=function(t){var e=v(t);e._chain=true;return e};var G=function(t,e){return t._chain?v(e).chain():e};v.mixin=function(t){v.each(v.functions(t),function(e){var i=v[e]=t[e];v.prototype[e]=function(){var t=[this._wrapped];a.apply(t,arguments);return G(this,i.apply(v,t))}})};v.mixin(v);v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=r[t];v.prototype[t]=function(){var i=this._wrapped;e.apply(i,arguments);if((t==="shift"||t==="splice")&&i.length===0)delete i[0];return G(this,i)}});v.each(["concat","join","slice"],function(t){var e=r[t];v.prototype[t]=function(){return G(this,e.apply(this._wrapped,arguments))}});v.prototype.value=function(){return this._wrapped};v.prototype.valueOf=v.prototype.toJSON=v.prototype.value;v.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return v})}}).call(this)},{}],88:[function(t,e,i){if(typeof Object.create==="function"){e.exports=function n(t,e){t.super_=e;t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}})}}else{e.exports=function r(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype;t.prototype=new i;t.prototype.constructor=t}}},{}],89:[function(t,e,i){e.exports=function n(t){return t&&typeof t==="object"&&typeof t.copy==="function"&&typeof t.fill==="function"&&typeof t.readUInt8==="function"}},{}],90:[function(t,e,i){(function(e,n){var r=/%[sdj%]/g;i.format=function(t){if(!x(t)){var e=[];for(var i=0;i<arguments.length;i++){e.push(a(arguments[i]))}return e.join(" ")}var i=1;var n=arguments;var s=n.length;var o=String(t).replace(r,function(t){if(t==="%%")return"%";if(i>=s)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}default:return t}});for(var u=n[i];i<s;u=n[++i]){if(m(u)||!T(u)){o+=" "+u}else{o+=" "+a(u)}}return o};i.deprecate=function(t,r){if(M(n.process)){return function(){return i.deprecate(t,r).apply(this,arguments)}}if(e.noDeprecation===true){return t}var s=false;function o(){if(!s){if(e.throwDeprecation){throw new Error(r)}else if(e.traceDeprecation){console.trace(r)}else{console.error(r)}s=true}return t.apply(this,arguments)}return o};var s={};var o;i.debuglog=function(t){if(M(o))o=e.env.NODE_DEBUG||"";t=t.toUpperCase();if(!s[t]){if(new RegExp("\\b"+t+"\\b","i").test(o)){var n=e.pid;s[t]=function(){var e=i.format.apply(i,arguments);console.error("%s %d: %s",t,n,e)}}else{s[t]=function(){}}}return s[t]};function a(t,e){var n={seen:[],stylize:h};if(arguments.length>=3)n.depth=arguments[2];if(arguments.length>=4)n.colors=arguments[3];if(y(e)){n.showHidden=e}else if(e){i._extend(n,e)}if(M(n.showHidden))n.showHidden=false;if(M(n.depth))n.depth=2;if(M(n.colors))n.colors=false;if(M(n.customInspect))n.customInspect=true;if(n.colors)n.stylize=u;return f(n,t,n.depth)}i.inspect=a;a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};a.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function u(t,e){var i=a.styles[e];if(i){return"["+a.colors[i][0]+"m"+t+"["+a.colors[i][1]+"m"}else{return t}}function h(t,e){return t}function c(t){var e={};t.forEach(function(t,i){e[t]=true});return e}function f(t,e,n){if(t.customInspect&&e&&A(e.inspect)&&e.inspect!==i.inspect&&!(e.constructor&&e.constructor.prototype===e)){var r=e.inspect(n,t);if(!x(r)){r=f(t,r,n)}return r}var s=l(t,e);if(s){return s}var o=Object.keys(e);var a=c(o);if(t.showHidden){o=Object.getOwnPropertyNames(e)}if(C(e)&&(o.indexOf("message")>=0||o.indexOf("description")>=0)){return d(e)}if(o.length===0){if(A(e)){var u=e.name?": "+e.name:"";return t.stylize("[Function"+u+"]","special")}if(D(e)){return t.stylize(RegExp.prototype.toString.call(e),"regexp")}if(S(e)){return t.stylize(Date.prototype.toString.call(e),"date")}if(C(e)){return d(e)}}var h="",y=false,m=["{","}"];if(_(e)){y=true;m=["[","]"]}if(A(e)){var w=e.name?": "+e.name:"";h=" [Function"+w+"]"}if(D(e)){h=" "+RegExp.prototype.toString.call(e)}if(S(e)){h=" "+Date.prototype.toUTCString.call(e)}if(C(e)){h=" "+d(e)}if(o.length===0&&(!y||e.length==0)){return m[0]+h+m[1]}if(n<0){if(D(e)){return t.stylize(RegExp.prototype.toString.call(e),"regexp")}else{return t.stylize("[Object]","special")}}t.seen.push(e);var b;if(y){b=p(t,e,n,a,o)}else{b=o.map(function(i){return g(t,e,n,a,i,y)})}t.seen.pop();return v(b,h,m)}function l(t,e){if(M(e))return t.stylize("undefined","undefined");if(x(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(b(e))return t.stylize(""+e,"number");if(y(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}function d(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,i,n,r){var s=[];for(var o=0,a=e.length;o<a;++o){if(I(e,String(o))){s.push(g(t,e,i,n,String(o),true))}else{s.push("")}}r.forEach(function(r){if(!r.match(/^\d+$/)){s.push(g(t,e,i,n,r,true))}});return s}function g(t,e,i,n,r,s){var o,a,u;u=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]};if(u.get){if(u.set){a=t.stylize("[Getter/Setter]","special")}else{a=t.stylize("[Getter]","special")}}else{if(u.set){a=t.stylize("[Setter]","special")}}if(!I(n,r)){o="["+r+"]"}if(!a){if(t.seen.indexOf(u.value)<0){if(m(i)){a=f(t,u.value,null)}else{a=f(t,u.value,i-1)}if(a.indexOf("\n")>-1){
if(s){a=a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2)}else{a="\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")}}}else{a=t.stylize("[Circular]","special")}}if(M(o)){if(s&&r.match(/^\d+$/)){return a}o=JSON.stringify(""+r);if(o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){o=o.substr(1,o.length-2);o=t.stylize(o,"name")}else{o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");o=t.stylize(o,"string")}}return o+": "+a}function v(t,e,i){var n=0;var r=t.reduce(function(t,e){n++;if(e.indexOf("\n")>=0)n++;return t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(r>60){return i[0]+(e===""?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]}return i[0]+e+" "+t.join(", ")+" "+i[1]}function _(t){return Array.isArray(t)}i.isArray=_;function y(t){return typeof t==="boolean"}i.isBoolean=y;function m(t){return t===null}i.isNull=m;function w(t){return t==null}i.isNullOrUndefined=w;function b(t){return typeof t==="number"}i.isNumber=b;function x(t){return typeof t==="string"}i.isString=x;function E(t){return typeof t==="symbol"}i.isSymbol=E;function M(t){return t===void 0}i.isUndefined=M;function D(t){return T(t)&&O(t)==="[object RegExp]"}i.isRegExp=D;function T(t){return typeof t==="object"&&t!==null}i.isObject=T;function S(t){return T(t)&&O(t)==="[object Date]"}i.isDate=S;function C(t){return T(t)&&(O(t)==="[object Error]"||t instanceof Error)}i.isError=C;function A(t){return typeof t==="function"}i.isFunction=A;function j(t){return t===null||typeof t==="boolean"||typeof t==="number"||typeof t==="string"||typeof t==="symbol"||typeof t==="undefined"}i.isPrimitive=j;i.isBuffer=t("./support/isBuffer");function O(t){return Object.prototype.toString.call(t)}function R(t){return t<10?"0"+t.toString(10):t.toString(10)}var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function k(){var t=new Date;var e=[R(t.getHours()),R(t.getMinutes()),R(t.getSeconds())].join(":");return[t.getDate(),P[t.getMonth()],e].join(" ")}i.log=function(){console.log("%s - %s",k(),i.format.apply(i,arguments))};i.inherits=t("inherits");i._extend=function(t,e){if(!e||!T(e))return t;var i=Object.keys(e);var n=i.length;while(n--){t[i[n]]=e[i[n]]}return t};function I(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}).call(this,t("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":89,_process:84,inherits:88}],91:[function(t,e,i){"use strict";var n=function(){function t(t,e){var i=[];var n=true;var r=false;var s=undefined;try{for(var o=t[Symbol.iterator](),a;!(n=(a=o.next()).done);n=true){i.push(a.value);if(e&&i.length===e)break}}catch(u){r=true;s=u}finally{try{if(!n&&o["return"])o["return"]()}finally{if(r)throw s}}return i}return function(e,i){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return t(e,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var r=t("underscore");var s=t("craftyjs");var o=t("assert");var a=t("./util");t("./shapes");var u=t("chai").expect;var h=t("./util").vec2;var c=function g(t,e){var i=t.node,n=t.next,r=t.offset;u(i).to.be.not.undefined;u(n).to.be.not.undefined;u(r).to.be.not.undefined;var s=h.lengthTo(i,n);if(r+e>=s){if(n.nextNode()===undefined){return{node:n,next:undefined,offset:0}}return g({node:n,next:n.nextNode(),offset:0},e+r-s)}else{return{node:i,next:n,offset:r+e}}};s.c("Node",{required:"2D, Delay, Keyboard",_activePath:"#000000",_inactivePath:"#666666",init:function v(){this._nextNodes=[];this._nextPtr=0;this._pathEntities=[];this._nodeGraphic=s.e("NodeGraphic").attr({x:0,y:0,w:50,h:50});this.attach(this._nodeGraphic);this._updateGraphics();this.bind("SwitchPath",this.switchPath)},node:function _(){var t=this;var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{type:"manual"},i=e.type,n=e.interval,r=n===undefined?2e3:n;if(i==="manual"){this._nodeGraphic.color("#937ded");this.bind("KeyDown",function(e){if(e.key===s.keys.S){t.switchPath()}})}else if(i==="periodical"){this.delay(function(){t.switchPath()},r,-1)}else{o(false)}return this},connect:function y(t){u(t).to.be.not.equal(this);var e=this._nextNodes.length?this._inactivePath:this._activePath;this._nextNodes.push(t);this._pathEntities.push(s.e("PathGraphic").path(this._nodeGraphic,t._nodeGraphic).color(e))},nextNode:function m(){return this._nextNodes[this._nextPtr]},switchPath:function w(){if(this._nextNodes.length>0){this._nextPtr=(this._nextPtr+1)%this._nextNodes.length;this._updateGraphics()}},vec2:function b(){return[this.x,this.y]},_updateGraphics:function x(){var t=this;this._nodeGraphic.attr({x:this.x-25,y:this.y-25,w:50,h:50});r.each(this._pathEntities,function(e,i){e.path(t._nodeGraphic,t._nextNodes[i]._nodeGraphic).color(i===t._nextPtr?t._activePath:t._inactivePath)})},events:{Move:function E(){this._updateGraphics()}}});var f=function M(){var t=-28;var e=0;var i=30;var n=18;return[t,-n,e,-n,i,0,e,n,t,n]};s.c("Ship",{required:"2D, Keyboard, Collision",init:function D(){this._accelerator=60;this._brake=-150;this._speedLimit=200;this.collision(f());this._a=0;this._v=0;this._position={node:undefined,next:undefined,offset:0};this._shipGraphic=s.e("ShipGraphic").attr({x:this.x-50,y:this.y-25,w:100,h:50});this.origin("center");this.attach(this._shipGraphic)},ship:function T(t){var e=t.accelerator,i=t.brake,n=t.speedLimit;this._accelerator=e;this._brake=i;this._speedLimit=n;return this},startAt:function S(t){this._position={node:t,next:t.nextNode(),offset:0};this.advance(0);return this},_move:function C(t){if(this._hasStopped())return;var e=this._position=c(this._position,t),i=e.node,r=e.next,s=e.offset;if(r===undefined)return;var o=h.add(i,h.valueLerp(i,r,s)),a=n(o,2),u=a[0],f=a[1];this.attr({x:u,y:f})},_alignTrack:function A(){if(!this._hasStopped()){var t=h.valueLerp(this._position.node,this._position.next,1),e=n(t,2),i=e[0],r=e[1];this.rotation=a.rad(Math.atan2(r,i));u(this.rotation).to.be.not.NaN}},_hasStopped:function j(){return this._position.next===undefined},advance:function O(t){this._move(t);this._alignTrack();if(this._hasStopped()){s.trigger("ReachEndNode")}},events:{EnterFrame:function R(t){var e=t.frame,i=t.dt;this._a=this.isDown("SPACE")?this._accelerator:this._brake;this._v+=i/1e3*this._a;this._v=Math.max(0,Math.min(this._speedLimit,this._v));this.advance(this._v*i/1e3)}}});var l=function P(t){return r.map([0,-.3,.35,-.3,.35,.3,0,.3],function(t){return t*50})};s.c("Hook",{required:"2D, Mouse, Collision",init:function k(){var t=this;this._launchSpeed=150;this._reachLimit=150;this._depth=0;this._hookState=0;this._oreGrabbed=null;this.collision(l(this));this._mouseHandler=s.e("2D, Mouse").attr({x:this.x-300,y:this.y-300,w:600,h:600}).bind("MouseMove",function(e){return t._updateRotation()}).bind("Click",function(e){if(t._hookState===0){t._hookState=1}});this.attach(this._mouseHandler);this._hookGraphic=s.e("HookGraphic").attr({x:this.x-25,y:this.y-25,w:50,h:50});this.attach(this._hookGraphic)},hook:function I(t){var e=t.launchSpeed,i=t.reachLimit;this._launchSpeed=e;this._reachLimit=i;return this},_setHookPosition:function z(t){var e=a.deg2rad(this.rotation);this._depth=t;this.attr({x:this._ship.x+t*Math.cos(e),y:this._ship.y+t*Math.sin(e)});this._pathGraphic.recalculate()},_updateRotation:function N(){if(!s.lastEvent)return;var t=[s.lastEvent.realX,s.lastEvent.realY],e=t[0],i=t[1];if(this._depth===0){var r=h.sub([e,i],[this.x,this.y]),o=n(r,2),u=o[0],c=o[1];this.rotation=a.rad(Math.atan2(c,u))}},attachTo:function L(t){var e=this;this._pathGraphic=s.e("PathGraphic").attr("z",30).path(t,this);this._ship=t;this.attr({x:t.x,y:t.y});t.bind("Move",function(t){e._updateRotation();e._setHookPosition(e._depth)})},events:{EnterFrame:function F(t){var e=t.dt;var i=this._launchSpeed;if(this._oreGrabbed){i*=this._oreGrabbed._weight}var n=this._depth+i*this._hookState*e/1e3;if(n>=this._reachLimit){this._setHookPosition(this._reachLimit);this._hookState=-1}else if(n<0){this._setHookPosition(0);this._hookState=0;this.trigger("HookReturn")}else{this._setHookPosition(n)}}}});var d=function B(t){var e=t.w/2;return r.flatten(r.times(3,function(t){return h.add([e,e],a.rotate([e/2,0],a.deg2rad(120*t)))}),true)};s.c("Ore",{required:"AngularMotion, OreGraphic, Collision",init:function q(){},ore:function U(t){var e=t.size,i=t.weight,n=t.value,r=t.color,s=t.type;this._size=e;this._weight=i;this._value=n;this._type=s;this.attr({w:50*e,h:50*e});this.origin("center");this.color(r);this.vrotation=40*this._weight;this.collision(d(this));this.checkHits("Hook");return this},centerAt:function G(t){var e=t.x,i=t.y;return this.attr({x:e-this.w/2,y:i-this.h/2})},events:{HitOn:function H(t){var e=this;var i=t[0].obj;if(i._oreGrabbed||i._hookState===-1)return;i.attach(this);i._hookState=-1;i._oreGrabbed=this;this.centerAt({x:i.x,y:i.y});this.vrotation=0;i.one("HookReturn",function(){s.trigger("GetOre",{type:e._type});s.trigger("GetCoins",{value:e._value});i._oreGrabbed=null;i.detach(e);e.destroy()})}}});var p=function V(){return r.flatten(r.times(4,function(t){return h.add([25,25],a.rotate([10,0],a.deg2rad(90*t)))}))};s.c("Sentinel",{required:"Motion, AngularMotion, SentinelGraphic, Collision",init:function Y(){},sentinel:function X(t){var e=t.detectRange,i=t.speed;this.attr({w:50,h:50});this._detectRange=e;this._speed=i;this.collision(p());this.checkHits("Ship, Hook");this.origin("center");return this},centerAt:function W(t){var e=t.x,i=t.y;return this.attr({x:e-this.w/2,y:i-this.h/2})},events:{EnterFrame:function K(){var t=s("Ship");var e=[t.x,t.y];var i=[this.x+this.w/2,this.y+this.h/2];if(h.lengthTo(i,e)<=this._detectRange){var r=h.valueLerp(i,e,1);var o=h.mul(r,this._speed);var a=n(o,2);this.vx=a[0];this.vy=a[1];this.vrotation=360}else{this.vx=this.vy=this.vrotation=0}},HitOn:function J(t){var e=t[0].obj;if(e.has("Ship")){s.trigger("LevelFail");this.destroy()}else if(e.has("Hook")){if(e._hookState!=1)return;this.destroy()}else{o(false)}}}})},{"./shapes":95,"./util":97,assert:2,chai:7,craftyjs:51,underscore:87}],92:[function(t,e,i){"use strict";var n=t("underscore");var r=t("craftyjs");r.c("Grid",{required:"2D, Canvas, Mouse",init:function s(){this._gridWidth=50;this._gridHeight=50;this._radius=3;this._color="#bfbfbf";this._lineWidth=1;this._lineDash=5;this._lineDashEmpty=5;this.ready=true;this.bind("Draw",this._drawGrid);this.trigger("Invalidate")},grid:function o(t,e){this._gridWidth=t;this._gridHeight=e;this.trigger("Invalidate");return this},_drawGrid:function a(t){var e=this;var i=t.ctx,r=t.pos,s=t.co;var o=~~(r._w/this._gridWidth)+1;var a=~~(r._h/this._gridHeight)+1;i.save();i.translate(r._x,r._y);i.lineWidth=this._lineWidth;i.setLineDash([this._lineDash,this._lineDashEmpty]);i.strokeStyle=this._color;i.fillStyle=this._color;i.beginPath();n.times(o,function(t){i.moveTo(t*e._gridWidth,0);i.lineTo(t*e._gridWidth,r._h)});n.times(a,function(t){i.moveTo(0,t*e._gridHeight);i.lineTo(r._w,t*e._gridHeight)});i.stroke();i.beginPath();n.times(o,function(t){n.times(a,function(n){i.moveTo(t*e._gridWidth,n*e._gridHeight);i.arc(t*e._gridWidth,n*e._gridHeight,e._radius,0,2*Math.PI)})});i.fill();i.restore()}})},{craftyjs:51,underscore:87}],93:[function(t,e,i){"use strict";e.exports=[t("../assets/levels/level1")]},{"../assets/levels/level1":1}],94:[function(t,e,i){"use strict";var n=function(){function t(t,e){var i=[];var n=true;var r=false;var s=undefined;try{for(var o=t[Symbol.iterator](),a;!(n=(a=o.next()).done);n=true){i.push(a.value);if(e&&i.length===e)break}}catch(u){r=true;s=u}finally{try{if(!n&&o["return"])o["return"]()}finally{if(r)throw s}}return i}return function(e,i){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return t(e,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var r=t("underscore");var s=t("craftyjs");var o=t("./util");var a=t("./levels");t("./grid");t("./shapes");t("./ui");t("./entities");var u=false;var h=void 0;var c=function l(t){var e=o.clone(t.map.nodes);r.each(e,function(i,o){var a=n(i,2),u=a[0],h=a[1];e[o]=s.e("Node").node(t.map.switchs[o]).attr({x:u,y:h});if(r.contains(t.map.start,o)){e[o]._nodeGraphic.color("#57d69d")}else if(r.contains(t.map.end,o)){e[o]._nodeGraphic.color("#ff8144")}});var i=t.map.paths;r.each(i,function(t,i){r.each(t,function(t){e[i].connect(e[t])})});var a=t.map.ores;r.each(a,function(t){s.e("Ore").ore(t).centerAt(t.at)});var h=t.map.sentinels;r.each(h,function(t){s.e("Sentinel").sentinel(t).centerAt(t.at)});var c=s.e("Ship").ship(t.player.ship).startAt(e[r.sample(t.map.start)]);var f=s.e("Hook").hook(t.player.hook).attachTo(c);s.viewport.follow(c);var l=s.e("Static");var d=0;r.each(t.goal,function(t,e){var i=o.capitalize(e)+"Goal";l.attach(s.e(i).goal(t).attr({y:d}));d+=50});l.fixedAt({x:0,y:0});s.one("ReachEndNode",function(){var t=[];s("Goal").each(function(){t.push(this.fulfilled())});if(r.all(t)){s.trigger("LevelComplete")}else{s.trigger("LevelFail")}});s.one("LevelComplete",function(){s.scene("complete",t)});s.one("LevelFail",function(){s.scene("fail",t)});var p=400;var g=[r.min(e,function(t){return t.x}).x,r.min(e,function(t){return t.y}).y],v=g[0],_=g[1];var y=[r.max(e,function(t){return t.x}).x,r.max(e,function(t){return t.y}).y],m=y[0],w=y[1];var b=s.e("Grid").attr({x:v-p,y:_-p,w:m-v+p*2,h:w-_+p*2,z:-20}).grid(50,50);if(u){console.log("DEBUG MODE");s.viewport.scale(.5);b.requires("Mouse").attr({z:1}).bind("Click",function(t){console.log("clicked on",t.realX,t.realY)})}};var f=function d(){s.e("Grid").attr({x:0,y:0,w:3e3,h:1e3}).grid(50,50)};s.scene("title",function(){f();s.e("2D, DOM, Text").attr({x:100,y:100,w:300,h:100}).textColor("#525252").textFont({family:"XoloniumBold",size:"50px"}).text("RAILMINE");s.e("2D, DOM, Text").attr({x:95,y:110,w:300,h:100}).textColor("#525252").textFont({family:"XoloniumBold",size:"50px"}).text("_________");r.times(Math.min(h,a.length),function(t){s.e("2D, DOM, Text, Mouse").attr({x:175,y:235+50*t,w:300,h:50}).textColor("#525252").textFont({family:"XoloniumBold",size:"30px"}).text("[Level "+(t+1)+"]").bind("Click",function(){s.scene("game",a[t])})})});s.scene("game",function(t){c(t)});s.scene("fail",function(t){f();s.e("2D, DOM, Text").attr({x:100,y:100,w:400,h:100}).textColor("#525252").textFont({family:"XoloniumBold",size:"50px"}).text("Game over!");s.e("2D, DOM, Text").attr({x:150,y:200,w:500,h:100}).textColor("#525252").textFont({family:"XoloniumBold",size:"30px"}).text("Level "+t.meta.level+" failed");s.e("2D, DOM, Text, Mouse").attr({x:200,y:350,w:500,h:100}).textColor("#525252").textFont({family:"XoloniumBold",size:"30px"}).text("[retry]").bind("Click",function(){s.scene("game",t)});s.e("2D, DOM, Text, Mouse").attr({x:195,y:400,w:500,h:100}).textColor("#525252").textFont({family:"XoloniumBold",size:"30px"}).text("[menu]").bind("Click",function(){s.scene("title")})});s.scene("complete",function(t){f();s.e("2D, DOM, Text").attr({x:100,y:100,w:300,h:100}).textColor("#525252").textFont({family:"XoloniumBold",size:"50px"}).text("Well done!");s.e("2D, DOM, Text").attr({x:100,y:200,w:500,h:100}).textColor("#525252").textFont({family:"XoloniumBold",size:"30px"}).text("Level "+t.meta.level+" completed");s.e("2D, DOM, Text, Mouse").attr({x:170,y:350,w:500,h:100}).textColor("#525252").textFont({family:"XoloniumBold",size:"30px"}).text("[continue]").bind("Click",function(){s.scene("title")});if(t.meta.level>=h){h+=1}});s.init(500,500,"stage");s.viewport.clampToEntities=false;s.background("#f1eded");h=1;s.scene("title")},{"./entities":91,"./grid":92,"./levels":93,"./shapes":95,"./ui":96,"./util":97,craftyjs:51,underscore:87}],95:[function(t,e,i){"use strict";var n=function(){function t(t,e){var i=[];var n=true;var r=false;var s=undefined;try{for(var o=t[Symbol.iterator](),a;!(n=(a=o.next()).done);n=true){i.push(a.value);if(e&&i.length===e)break}}catch(u){r=true;s=u}finally{try{if(!n&&o["return"])o["return"]()}finally{if(r)throw s}}return i}return function(e,i){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return t(e,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++){i[e]=t[e]}return i}else{return Array.from(t)}}var s=t("underscore");var o=t("craftyjs");var a=t("./util").scale;var u=t("./util").rotate;var h=t("./util").deg;var c=t("./util").deg;var f=t("./util").center;var l=t("./util").depth;o.c("Shape",{required:"2D, Canvas",init:function _(){this._borderColor="#000000";this._shapeColor="#FFFFFF";this._scale=.85;this._borderWidth=4;this._polygon=[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]];this.z=10;this.origin("center");this.ready=true;this.bind("Draw",this._drawShape);this.trigger("Invalidate")},shape:function y(t){this._polygon=t;this.trigger("Invalidate");return this},color:function m(t){this._shapeColor=t;this.trigger("Invalidate");return this},_drawShape:function w(t){var e=t.ctx,i=t.pos,r=t.co;var o=s.map(this._polygon,s.partial(a,s,this._scale*this._w,this._scale*this._h));e.save();e.translate(i._x+i._w/2,i._y+i._h/2);e.lineWidth=this._borderWidth;e.strokeStyle=this._borderColor;e.fillStyle=this._shapeColor;e.beginPath();var u=s.head(o),h=n(u,2),c=h[0],f=h[1];e.moveTo(c,f);s.each(o,function(t){var i=n(t,2),r=i[0],s=i[1];e.lineTo(r,s)});e.closePath();e.fill();e.stroke();e.restore()}});var d=function(){var t=.5,e=.15;return s.flatten(s.times(4,function(i){return[u([t,0],i*h(90)),u([e,e],i*h(90))]}),true)}();o.c("SentinelGraphic",{required:"Shape",init:function b(){this.shape(d);this.color("#eb78ed")}});o.c("OreGraphic",{required:"Shape",init:function x(){this.shape(s.times(3,function(t){return u([.5,0],h(120*t))}));this.color("#65d2e9")}});var p=function(){var t=-.3;var e=.1;var i=.35;var n=.35;return[[t,-n],[e,-n],[i,0],[e,n],[t,n]]}();o.c("ShipGraphic",{required:"Shape",init:function E(){this.shape(p);this.color("#f4735d")}});var g=function(){var t=.05;var e=.3;var i=-.4;var r=-.2;var o=.1;var a=[[0,o],[-e,r],[-e,i],[-e+t,i],[-e+t,r],[0,o-t],[e-t,r],[e-t,i],[e,i],[e,r]];return s.map(a,function(t){var e=n(t,2),i=e[0],r=e[1];return[-r,i]})}();o.c("HookGraphic",{required:"Shape",init:function M(){this.z=15;this.shape(g);this.color("#666666")}});o.c("NodeGraphic",{required:"Shape",init:function D(){var t=.3;this.shape([[-t,-t],[t,-t],[t,t],[-t,t]]);this.color("#1d63ff");this.z=10}});o.c("CoinGraphic",{required:"Shape",init:function T(){var t=16;this.shape(s.times(t,function(e){return u([.3,0],c(e/t*360))}));this.color("#eccf35");this.z=50}});o.c("ClockGraphic",{required:"Shape",init:function S(){var t=16;this.shape([[0,-.3],[0,-.4],[0,0],[0,-.3]].concat(s.times(t,function(e){return u([0,-.3],c(e/t*360))})));this.z=50}});var v=function C(t,e){var i=30;var r=f(t),s=n(r,2),o=s[0],a=s[1];var u=f(e),h=n(u,2),c=h[0],l=h[1];if(o>c){var d=[c,o];o=d[0];c=d[1]}if(a>l){var p=[l,a];a=p[0];l=p[1]}return{x:o-i,y:a-i,w:c-o+2*i,h:l-a+2*i}};o.c("PathGraphic",{required:"2D, Canvas",init:function A(){this._pathColor="#000000";this._pathWidth=5;this.ready=true;this.bind("Draw",this._drawPath);this.trigger("Invalidate")},path:function j(t,e){var i=this;this._fromNode=t;this._toNode=e;this._fromNode.requires("2D").bind("Move",function(t){return i.recalculate()});this._toNode.requires("2D").bind("Move",function(t){return i.recalculate()});this.recalculate();this.trigger("Invalidate");return this},color:function O(t){this._pathColor=t;this.trigger("Invalidate");return this},thickness:function R(t){this._pathWidth=t;return this},recalculate:function P(){this.attr(v(this._fromNode,this._toNode));this.trigger("Invalidate");return this},_drawPath:function k(t){var e=t.ctx,i=t.pos,n=t.co;e.save();e.beginPath();e.strokeStyle=this._pathColor;e.lineWidth=this._pathWidth;e.moveTo.apply(e,r(f(this._fromNode)));e.lineTo.apply(e,r(f(this._toNode)));e.stroke();e.restore()}})},{"./util":97,craftyjs:51,underscore:87}],96:[function(t,e,i){"use strict";var n=t("underscore");var r=t("craftyjs");r.c("Static",{required:"2D",fixedAt:function o(t){var e=this;var i=t.x,n=t.y;this.attr({__x:i,__y:n});this._reposition();r.bind("ViewportScroll",function(){return e._reposition()});return this},_reposition:function a(){this.attr({x:this.__x-r.viewport._x,y:this.__y-r.viewport._y})}});var s=function u(t,e){var i=r.e(e).attr({x:0,y:0,w:50,h:50});var n=r.e("2D, Canvas, Text").attr({x:55,y:10,w:100,h:50,z:50}).textColor("#525252").textFont({family:"XoloniumBold",size:"25px"}).text("");t._icon=i;t._text=n;t.attach(t._icon);t.attach(t._text)};r.c("Goal",{});r.c("TimerGoal",{required:"2D, Goal, Delay",init:function h(){this._timeout=false;s(this,"ClockGraphic")},goal:function c(t){var e=this;var i=t.minute,n=i===undefined?0:i,s=t.second,o=s===undefined?0:s;this.remaining=n*60+o;this._updateText();this.delay(function(){e._updateText();r.trigger("ClockTick",e.remaining);e.remaining-=1},1e3,this.remaining,function(){e._timeout=true;r.trigger("LevelFail")});return this},_updateText:function f(){this._text.text(""+this.remaining)},fulfilled:function l(){return!this._timeout}});r.c("CoinsGoal",{required:"2D, Goal",init:function d(){var t=this;this._amount=0;this._amountTarget=0;s(this,"CoinGraphic");r.bind("GetCoins",function(e){var i=e.value;t._amount+=i;t._updateText()})},goal:function p(t){var e=t.amount;this._amountTarget=e;this._updateText();return this},_updateText:function g(){this._text.text(this._amount+"/"+this._amountTarget)},fulfilled:function v(){return this._amount>=this._amountTarget}});r.c("ItemsGoal",{required:"2D",goal:function _(t){var e=this;n.each(t,function(t,i){e.attach(r.e("ItemGoal").goal(t).attr({y:i*50}))});return this}});r.c("ItemGoal",{required:"2D, Goal",init:function y(){var t=this;this._amount=0;this._amountTarget=0;this._targetType="";s(this,"OreGraphic");this._icon.origin("center").requires("AngularMotion").vrotation=5;r.bind("GetOre",function(e){var i=e.type;if(t._targetType===i){t._amount+=1;t._updateText()}})},goal:function m(t){var e=t.color,i=t.type,n=t.amount;this._icon.color(e);this._targetType=i;this._amountTarget=n;this._updateText();return this},_updateText:function w(){this._text.text(this._amount+"/"+this._amountTarget)},fulfilled:function b(){return this._amount>=this._amountTarget}})},{craftyjs:51,underscore:87}],97:[function(t,e,i){"use strict";var n=function(){function t(t,e){var i=[];var n=true;var r=false;var s=undefined;try{for(var o=t[Symbol.iterator](),a;!(n=(a=o.next()).done);n=true){i.push(a.value);if(e&&i.length===e)break}}catch(u){r=true;s=u}finally{try{if(!n&&o["return"])o["return"]()}finally{if(r)throw s}}return i}return function(e,i){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return t(e,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var r=t("chai").expect;var s=Math.sin;var o=Math.cos;i.deg=function(t){return t/360*2*Math.PI};i.rad=function(t){return t/(2*Math.PI)*360};i.deg2rad=i.deg;i.rad2deg=i.rad;i.rotate=function(t,e){var i=n(t,2),r=i[0],a=i[1];return[r*o(e)-a*s(e),r*s(e)+a*o(e)]};i.scale=function(t,e,i){var r=n(t,2),s=r[0],o=r[1];return[s*e,o*i]};i.center=function(t){return[t.x+t.w/2,t.y+t.h/2]};i.capitalize=function(t){return t[0].toUpperCase()+t.slice(1)};i.clone=function(t){return JSON.parse(JSON.stringify(t))};var a=i.vec2={add:function u(t,e){var i=a.coercion(t),r=n(i,2),s=r[0],o=r[1];var u=a.coercion(e),h=n(u,2),c=h[0],f=h[1];return[s+c,o+f]},sub:function h(t,e){var i=a.coercion(t),r=n(i,2),s=r[0],o=r[1];var u=a.coercion(e),h=n(u,2),c=h[0],f=h[1];return[s-c,o-f]},mul:function c(t,e){var i=a.coercion(t),r=n(i,2),s=r[0],o=r[1];return[s*e,o*e]},length:function f(t){var e=a.coercion(t),i=n(e,2),r=i[0],s=i[1];return Math.sqrt(r*r+s*s)},unit:function l(t){return a.mul(t,1/a.length(t))},lengthTo:function d(t,e){return a.length(a.sub(t,e))},valueLerp:function p(t,e,i){r(i).to.be.a("number");return a.mul(a.unit(a.sub(e,t)),i)},coercion:function g(t){r(t).to.be.not.undefined;var e=t.vec2?t.vec2():t,i=n(e,2),s=i[0],o=i[1];r(s).to.be.not.NaN;r(o).to.be.not.NaN;return[s,o]}}},{chai:7}]},{},[94]);